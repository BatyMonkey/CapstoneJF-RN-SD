import{a as ue}from"./chunk-DSYC522I.js";import{c as O}from"./chunk-SIZNMXVG.js";import{a as w}from"./chunk-BSJEIMOO.js";import"./chunk-CGH6KSUE.js";import{$ as Y,Ba as X,Ma as Z,O as W,Qa as ee,R as q,Ra as te,S as H,T as z,Ua as ne,Va as ie,W as $,Wa as oe,Xa as re,Y as K,Ya as ae,Z as M,_a as ce,aa as k,b as B,c as F,d as y,e as j,f as d,g as f,i as l,j as P,k as G,kb as se,l as b,lb as le,m as A,mb as me,n as m,o as r,p as a,q as p,sb as pe,t as g,u as h,ua as J,ub as I,v as u,va as Q,z as c}from"./chunk-JZTRD5FY.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as C}from"./chunk-VI73JOY6.js";var x=(()=>{let n=class n{constructor(i){this.router=i}canActivate(i){return C(this,null,function*(){let{data:{session:t}}=yield w.auth.getSession();if(!t)return this.router.navigate(["/auth/login"]),!1;let _=i.data?.roles??[];if(!_.length)return!0;let{data:v,error:s}=yield w.from("usuario").select("rol").eq("id_auth",t.user.id).maybeSingle();return s||!v?.rol?(console.error("Error al obtener perfil o rol no definido:",s),this.router.navigate(["/auth/login"]),!1):_.includes(v.rol)?!0:(console.warn(`\u26D4 Acceso denegado. Rol actual: ${v.rol}, Roles permitidos: ${_.join(", ")}`),this.router.navigate(["/home"]),!1)})}};n.\u0275fac=function(t){return new(t||n)(j(M))},n.\u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();var he=[{path:"",redirectTo:"auth/login",pathMatch:"full"},{path:"auth/login",loadComponent:()=>import("./chunk-P3ZR22NT.js").then(e=>e.LoginPage)},{path:"auth/register",loadComponent:()=>import("./chunk-FGSD3IPM.js").then(e=>e.RegisterPage)},{path:"solicitar",canActivate:[x],loadComponent:()=>import("./chunk-NJS7AHY5.js").then(e=>e.SolicitarCertificadoPage)},{path:"pago-retorno",loadComponent:()=>import("./chunk-EYR4PMV5.js").then(e=>e.PagoRetornoPage)},{path:"noticias",canActivate:[x],loadComponent:()=>import("./chunk-TMOZSMKQ.js").then(e=>e.NoticiasPage)},{path:"noticias/crear",loadComponent:()=>import("./chunk-62ZOM5BP.js").then(e=>e.CrearNoticiaPage)},{path:"noticias/:id",loadComponent:()=>import("./chunk-PMVPD6K7.js").then(e=>e.DetalleNoticiaPage)},{path:"votacion/:id",canActivate:[x],loadComponent:()=>import("./chunk-TL36V3IY.js").then(e=>e.VotacionPage)},{path:"votaciones",loadComponent:()=>import("./chunk-Y45AEXN6.js").then(e=>e.VotacionesListPage)},{path:"solicitud",loadComponent:()=>import("./chunk-O46QSB3J.js").then(e=>e.SolicitudPage)},{path:"perfil",canActivate:[x],loadComponent:()=>import("./chunk-VKKEIYYG.js").then(e=>e.PerfilPage)},{path:"generar/proyecto",canActivate:[x],data:{roles:["administrador"]},loadComponent:()=>import("./chunk-O7H5UHWF.js").then(e=>e.GenerarProyectoComponent)},{path:"espacios",loadComponent:()=>import("./chunk-T6REAN5B.js").then(e=>e.EspaciosPage)},{path:"espacio/crear",canActivate:[x],loadComponent:()=>import("./chunk-QPUSGHMC.js").then(e=>e.CrearEspacioPage)},{path:"espacios/:id",loadComponent:()=>import("./chunk-SKG4IBP4.js").then(e=>e.DetalleEspacioPage)},{path:"generar/votacion",canActivate:[x],data:{roles:["administrador"]},loadComponent:()=>import("./chunk-MOOLT5ME.js").then(e=>e.GenerarVotacionPage)},{path:"auth/recuperar-contrasena",loadComponent:()=>import("./chunk-LL6CUGMS.js").then(e=>e.UpdatePasswordPage)},{path:"inscripcion",children:[{path:"proyectos",loadComponent:()=>import("./chunk-RKKR7PLK.js").then(e=>e.ProyectosPage)},{path:"inscripcion-proyecto/:id",loadComponent:()=>import("./chunk-24DWJSCA.js").then(e=>e.InscripcionProyectoComponent)}]},{path:"home",canActivate:[x],loadComponent:()=>import("./chunk-JUHFK2KJ.js").then(e=>e.HomePage)},{path:"**",redirectTo:"auth/login"}],_e=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=b({type:n}),n.\u0275inj=y({imports:[k.forRoot(he,{preloadingStrategy:Y}),k]});let e=n;return e})();var T=(function(e){return e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT",e})(T||{});var S=O("StatusBar");var E=O("App",{web:()=>import("./chunk-5NLA6BLV.js").then(e=>new e.AppWeb)});function Ce(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){d(o);let t=u(2);return f(t.go("/home"))}),p(1,"ion-icon",15),r(2,"ion-label"),c(3,"Inicio"),a()()}}function xe(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){d(o);let t=u(2);return f(t.go("/solicitar"))}),p(1,"ion-icon",16),r(2,"ion-label"),c(3,"Solicitar certificado"),a()()}}function we(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){d(o);let t=u(2);return f(t.go("/votaciones"))}),p(1,"ion-icon",17),r(2,"ion-label"),c(3,"Votaciones"),a()()}}function ve(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){d(o);let t=u(2);return f(t.go("/inscripcion/proyectos"))}),p(1,"ion-icon",17),r(2,"ion-label"),c(3,"inscribirse a proyecto"),a()()}}function Pe(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){d(o);let t=u(2);return f(t.go("/solicitud"))}),p(1,"ion-icon",18),r(2,"ion-label"),c(3,"Arrendar espacio"),a()()}}function ye(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){d(o);let t=u(2);return f(t.go("/espacios"))}),p(1,"ion-icon",19),r(2,"ion-label"),c(3,"Espacios Comunitarios"),a()()}}function be(e,n){e&1&&(r(0,"ion-list-header"),c(1,"Administraci\xF3n"),a())}function Ae(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){d(o);let t=u(2);return f(t.go("/generar/proyecto"))}),p(1,"ion-icon",20),r(2,"ion-label"),c(3,"Generar proyecto"),a()()}}function Me(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){d(o);let t=u(2);return f(t.go("/generar/votacion"))}),p(1,"ion-icon",21),r(2,"ion-label"),c(3,"Generar votaci\xF3n"),a()()}}function Ie(e,n){if(e&1){let o=g();r(0,"ion-item",22),h("click",function(){d(o);let t=u(2);return f(t.go("/perfil"))}),p(1,"ion-icon",23),r(2,"ion-label"),c(3,"Mi perfil"),a()()}}function Oe(e,n){if(e&1){let o=g();r(0,"ion-menu",2)(1,"ion-header",3)(2,"ion-toolbar")(3,"ion-title"),c(4,"Men\xFA"),a()()(),r(5,"ion-content",4)(6,"ion-list",5)(7,"ion-menu-toggle",6),A(8,Ce,4,0,"ion-item",7)(9,xe,4,0,"ion-item",7)(10,we,4,0,"ion-item",7)(11,ve,4,0,"ion-item",7)(12,Pe,4,0,"ion-item",7)(13,ye,4,0,"ion-item",7)(14,be,2,0,"ion-list-header",8)(15,Ae,4,0,"ion-item",7)(16,Me,4,0,"ion-item",7),a()(),r(17,"div",9),A(18,Ie,4,0,"ion-item",10),a(),r(19,"div",11)(20,"ion-item",12),h("click",function(){d(o);let t=u();return f(t.salir())}),p(21,"ion-icon",13),r(22,"ion-label"),c(23,"Cerrar sesi\xF3n"),a()()()()()}if(e&2){let o=u();l(8),m("ngIf",!o.isActive("/home")),l(),m("ngIf",!o.isActive("/solicitar")),l(),m("ngIf",!o.isActive("/votaciones")),l(),m("ngIf",!o.isActive("/inscripcion/proyectos")),l(),m("ngIf",!o.isActive("/solicitud")),l(),m("ngIf",!o.isActive("/espacios")),l(),m("ngIf",o.isAdmin),l(),m("ngIf",o.isAdmin&&!o.isActive("/generar/proyecto")),l(),m("ngIf",o.isAdmin&&!o.isActive("/generar/votacion")),l(2),m("ngIf",!o.isActive("/perfil"))}}var U=(()=>{let n=class n{constructor(i,t,_,v){this.router=i,this.menu=t,this.auth=_,this.platform=v,this.currentUrl="",this.isAdmin=!1,this.currentUrl=this.router.url||"",this.refrescarRol(),this.platform.ready().then(()=>C(this,null,function*(){yield this.configurarStatusBar(),n._deepLinkInit||(this.setupDeepLinks(),n._deepLinkInit=!0)})),this.router.events.pipe(B(s=>s instanceof $)).subscribe(s=>C(this,null,function*(){this.currentUrl=s.urlAfterRedirects||s.url||"",yield this.refrescarRol()}))}get isAuth(){return this.currentUrl.startsWith("/auth")}isActive(i){return this.currentUrl?this.currentUrl===i||this.currentUrl.startsWith(i+"/"):!1}go(i){return C(this,null,function*(){try{(yield this.menu.isOpen("mainMenu"))&&(yield this.menu.close("mainMenu"))}catch{}yield this.router.navigateByUrl(i)})}salir(){return C(this,null,function*(){try{yield this.auth.signOut(),this.isAdmin=!1}finally{try{(yield this.menu.isOpen("mainMenu"))&&(yield this.menu.close("mainMenu"))}catch{}yield this.router.navigateByUrl("/auth/login",{replaceUrl:!0})}})}refrescarRol(){return C(this,null,function*(){try{if(this.isAuth){this.isAdmin=!1;return}let{data:{user:i}}=yield w.auth.getUser();if(!i){this.isAdmin=!1;return}let{data:t,error:_}=yield w.from("usuario").select("rol").eq("user_id",i.id).maybeSingle();if(_){this.isAdmin=!1;return}this.isAdmin=t?.rol==="administrador"}catch{this.isAdmin=!1}})}configurarStatusBar(){return C(this,null,function*(){try{yield S.setOverlaysWebView({overlay:!1}),yield S.setBackgroundColor({color:"#000000"}),yield S.setStyle({style:T.Dark})}catch{}})}setupDeepLinks(){E.getLaunchUrl().then(i=>{i?.url&&this.handleUrl(i.url)}),E.addListener("appUrlOpen",i=>{i?.url&&this.handleUrl(i.url)})}handleUrl(i){return C(this,null,function*(){try{let t=new URL(i);if(t.protocol!=="myapp:"||t.host!=="auth")return;let _=t.searchParams,v=new URLSearchParams(t.hash?.startsWith("#")?t.hash.slice(1):t.hash),s=N=>_.get(N)??v.get(N),fe=s("type"),R=s("access_token"),L=s("refresh_token"),D=s("code");fe==="recovery"&&R&&L?yield w.auth.setSession({access_token:R,refresh_token:L}):D?yield w.auth.exchangeCodeForSession(D):console.warn("Deep link sin tokens ni code. No se pudo establecer sesi\xF3n."),yield this.router.navigateByUrl("/auth/recuperar-contrasena",{replaceUrl:!0})}catch(t){console.error("Deep link parse error",t)}})}};n._deepLinkInit=!1,n.\u0275fac=function(t){return new(t||n)(P(M),P(pe),P(ue),P(J))},n.\u0275cmp=G({type:n,selectors:[["app-root"]],decls:3,vars:1,consts:[["side","start","menuId","mainMenu","contentId","main-content","type","reveal",4,"ngIf"],["id","main-content"],["side","start","menuId","mainMenu","contentId","main-content","type","reveal"],[1,"menu-header"],[1,"menu-content"],["lines","none",1,"menu-list"],["auto-hide","true"],["button","","detail","false",3,"click",4,"ngIf"],[4,"ngIf"],[1,"perfil-wrap"],["button","","detail","false","class","perfil",3,"click",4,"ngIf"],[1,"logout-wrap"],["button","","detail","false",1,"logout",3,"click"],["slot","start","name","log-out-outline"],["button","","detail","false",3,"click"],["slot","start","name","home-outline"],["slot","start","name","document-text-outline"],["slot","start","name","people-outline"],["slot","start","name","calendar-outline"],["slot","start","name","business-outline"],["slot","start","name","construct-outline"],["slot","start","name","list-circle-outline"],["button","","detail","false",1,"perfil",3,"click"],["slot","start","name","person-circle-outline"]],template:function(t,_){t&1&&(r(0,"ion-app"),A(1,Oe,24,10,"ion-menu",0),p(2,"ion-router-outlet",1),a()),t&2&&(l(),m("ngIf",!_.isAuth))},dependencies:[q,W,I,X,Z,ee,te,ne,ie,oe,re,ae,ce,se,le,me],styles:['@charset "UTF-8";ion-header[_ngcontent-%COMP%], ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{position:relative;z-index:1000;pointer-events:auto;--min-height: 56px}ion-menu[type=reveal][_ngcontent-%COMP%]::part(backdrop){opacity:0;pointer-events:none}ion-menu[_ngcontent-%COMP%]::part(container){box-shadow:0 8px 24px #0206173d;border-right:1px solid rgba(2,6,23,.06)}.menu-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #2563eb, #60a5fa);--color: #fff}.menu-content[_ngcontent-%COMP%]{--background: #f8fafc}.menu-content[_ngcontent-%COMP%]   .menu-list[_ngcontent-%COMP%]{background:transparent;padding:6px 0}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin:8px 6px;border-radius:14px;background:#fff;--background: #fff;border:1px solid rgba(37,99,235,.1);transition:transform .12s ease,box-shadow .12s ease,border-color .12s ease}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#2563eb;font-size:20px}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:600;color:#0f172a}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:active{transform:translateY(1px)}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:focus-within, .menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:hover{border-color:#2563eb33;box-shadow:0 8px 18px #2563eb1a}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]{margin-top:auto;padding-top:8px}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]{background:#fff5f5;border-color:#ef444433}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#ef4444}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:#b91c1c}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]:hover{box-shadow:0 8px 18px #ef44441f}']});let e=n;return e})();var de=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=b({type:n,bootstrap:[U]}),n.\u0275inj=y({providers:[{provide:K,useClass:Q}],imports:[z,I.forRoot(),_e,U]});let e=n;return e})();H().bootstrapModule(de).catch(e=>console.log(e));
