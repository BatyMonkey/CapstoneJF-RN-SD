import{a as ne}from"./chunk-CL4KBMSP.js";import{a as S}from"./chunk-TX5AFJTF.js";import"./chunk-66QFWZLQ.js";import{A as c,B as T,C,E as y,Ea as D,F as v,G as I,Ga as R,Ha as G,Ia as H,Ja as J,Ka as K,Na as Q,P as V,S as U,Sa as X,Ua as Y,Va as Z,_ as F,da as N,ea as E,f as g,g as m,ga as z,i,ia as A,ib as $,j as f,ja as L,jb as ee,k as O,m as h,o as p,p as o,pa as W,q as d,qa as B,r as b,ta as j,u as k,ub as te,v as _,vb as oe,w as M,x as P,za as q}from"./chunk-H7HGEQUX.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as u}from"./chunk-VI73JOY6.js";function ie(n,r){if(n&1&&(o(0,"ion-text",16)(1,"strong"),c(2),d()()),n&2){let w=M();i(2),T(w.successMsg)}}function re(n,r){if(n&1&&(o(0,"ion-text",17),c(1),d()),n&2){let w=M();i(),C(" ",w.errorMsg," ")}}function ae(n,r){n&1&&b(0,"ion-spinner",18)}var be=(()=>{let r=class r{constructor(a,t,e){this.auth=a,this.router=t,this.toastCtrl=e,this.newPassword="",this.confirmPassword="",this.loading=!1,this.errorMsg="",this.successMsg=""}ngOnInit(){return u(this,null,function*(){let{data:a}=yield S.auth.getSession();a.session||(this.errorMsg="No se detect\xF3 sesi\xF3n de recuperaci\xF3n. Abre nuevamente el enlace del correo desde este dispositivo.")})}updatePassword(a){return u(this,null,function*(){if(this.errorMsg="",this.successMsg="",a.invalid||this.newPassword!==this.confirmPassword){this.newPassword!==this.confirmPassword?this.errorMsg="Las contrase\xF1as no coinciden.":this.errorMsg="Por favor, completa la contrase\xF1a (m\xEDnimo 6 caracteres).";return}this.loading=!0;try{let{data:t}=yield S.auth.getSession();if(!t.session){this.errorMsg="No se detect\xF3 sesi\xF3n de recuperaci\xF3n. Abre nuevamente el enlace del correo desde este dispositivo.",yield this.mostrarToast(this.errorMsg,"danger"),this.loading=!1;return}yield this.auth.updateUser({password:this.newPassword}),this.successMsg="\xA1Contrase\xF1a actualizada con \xE9xito! Redirigiendo...",yield this.mostrarToast(this.successMsg,"success"),yield this.router.navigateByUrl("/auth/login",{replaceUrl:!0})}catch(t){console.error("Error al actualizar contrase\xF1a:",t),this.errorMsg=t?.message??"Ocurri\xF3 un error al intentar cambiar la contrase\xF1a.",yield this.mostrarToast(this.errorMsg,"danger")}finally{this.loading=!1}})}mostrarToast(a,t){return u(this,null,function*(){yield(yield this.toastCtrl.create({message:a,duration:3e3,position:"top",color:t})).present()})}goToLogin(){this.loading||this.router.navigateByUrl("/auth/login",{replaceUrl:!0})}};r.\u0275fac=function(t){return new(t||r)(f(ne),f(F),f(te))},r.\u0275cmp=O({type:r,selectors:[["app-update-password"]],decls:24,vars:8,consts:[["f","ngForm"],["fullscreen","",1,"ion-padding"],[2,"max-width","420px","margin","8vh auto 0"],[2,"border-radius","16px"],["color","primary"],["color","success","style","display:block; margin-bottom:12px;",4,"ngIf"],[3,"ngSubmit"],["lines","none"],["name","lock-closed-outline","slot","start","color","primary"],["type","password","placeholder","Nueva Contrase\xF1a (m\xEDnimo 6 caracteres)","name","newPassword","required","","minlength","6",3,"ngModelChange","ngModel"],["lines","none",2,"margin-top","10px"],["type","password","placeholder","Confirmar Nueva Contrase\xF1a","name","confirmPassword","required","",3,"ngModelChange","ngModel"],["color","danger","style","display:block; margin-top:12px;",4,"ngIf"],["type","submit","expand","block","size","large","color","primary",1,"cta",2,"margin-top","20px","border-radius","12px",3,"disabled"],["slot","start",4,"ngIf"],["type","button","expand","block","fill","clear","color","medium",2,"margin-top","10px","--padding-top","0","--padding-bottom","0",3,"click","disabled"],["color","success",2,"display","block","margin-bottom","12px"],["color","danger",2,"display","block","margin-top","12px"],["slot","start"]],template:function(t,e){if(t&1){let l=k();o(0,"ion-content",1)(1,"div",2)(2,"ion-card",3)(3,"ion-card-header")(4,"ion-card-title",4),c(5,"Actualizar Contrase\xF1a"),d(),o(6,"ion-card-subtitle"),c(7,"Ingresa tu nueva contrase\xF1a para acceder."),d()(),o(8,"ion-card-content"),h(9,ie,3,1,"ion-text",5),o(10,"form",6,0),_("ngSubmit",function(){g(l);let s=P(11);return m(e.updatePassword(s))}),o(12,"ion-item",7),b(13,"ion-icon",8),o(14,"ion-input",9),I("ngModelChange",function(s){return g(l),v(e.newPassword,s)||(e.newPassword=s),m(s)}),d()(),o(15,"ion-item",10),b(16,"ion-icon",8),o(17,"ion-input",11),I("ngModelChange",function(s){return g(l),v(e.confirmPassword,s)||(e.confirmPassword=s),m(s)}),d()(),h(18,re,2,1,"ion-text",12),o(19,"ion-button",13),h(20,ae,1,0,"ion-spinner",14),c(21),d(),o(22,"ion-button",15),_("click",function(){return g(l),m(e.goToLogin())}),c(23," Volver a Iniciar Sesi\xF3n "),d()()()()()()}if(t&2){let l=P(11);i(9),p("ngIf",e.successMsg),i(5),y("ngModel",e.newPassword),i(3),y("ngModel",e.confirmPassword),i(),p("ngIf",e.errorMsg),i(),p("disabled",e.loading||!l.valid),i(),p("ngIf",e.loading),i(),C(" ",e.loading?"Actualizando\u2026":"Cambiar Contrase\xF1a"," "),i(),p("disabled",e.loading)}},dependencies:[oe,D,R,G,H,J,K,Q,X,Y,Z,$,ee,q,U,V,j,L,N,E,W,B,A,z],styles:['@charset "UTF-8";[_nghost-%COMP%]{--bg1: #f7fbff;--bg2: #e8f0ff;--card-bg: #ffffff}ion-content[_ngcontent-%COMP%]{--background: linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 100%)}ion-toolbar[_ngcontent-%COMP%]{--background: transparent;--color: var(--ion-text-color);--border-color: transparent}ion-card[_ngcontent-%COMP%]{max-width:420px;margin:8vh auto 0;border-radius:16px;background:var(--card-bg);box-shadow:0 10px 30px #2b58761f}ion-card-title[_ngcontent-%COMP%]{font-weight:700}ion-card-subtitle[_ngcontent-%COMP%]{margin-top:4px;opacity:.7}ion-item[_ngcontent-%COMP%]{--background: transparent;--padding-start: 12px;--inner-padding-end: 12px;--min-height: 54px;border:1px solid rgba(25,71,170,.15);border-radius:12px;margin-top:12px;transition:border-color .16s ease,box-shadow .16s ease}ion-item.item-has-focus[_ngcontent-%COMP%]{border-color:var(--ion-color-primary);box-shadow:0 0 0 3px #3b82f626}ion-icon[slot=start][_ngcontent-%COMP%]{margin-right:6px;opacity:.9}ion-input[_ngcontent-%COMP%]{font-size:16px}ion-button[_ngcontent-%COMP%]{--border-radius: 12px;--box-shadow: 0 6px 18px rgba(59, 130, 246, .35)}ion-text[color=danger][_ngcontent-%COMP%]{display:block;font-size:.9rem}@media (prefers-color-scheme: dark){[_nghost-%COMP%]{--bg1: #0b1220;--bg2: #0f1630;--card-bg: #141a2a}ion-card[_ngcontent-%COMP%]{box-shadow:0 14px 34px #00000073}ion-item[_ngcontent-%COMP%]{border-color:#ffffff14}}.recovery-button[_ngcontent-%COMP%]{--box-shadow: none !important;border:none!important;font-weight:500}ion-button[fill=clear][_ngcontent-%COMP%]{--box-shadow: none !important}ion-button[fill=clear][color=medium][_ngcontent-%COMP%]{color:var(--ion-color-medium-shade, #737373)!important;--background-hover: transparent !important;--background-focused: transparent !important;--background-activated: transparent !important}']});let n=r;return n})();export{be as UpdatePasswordPage};
