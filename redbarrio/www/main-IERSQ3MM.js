import{a as at}from"./chunk-6C47DM3O.js";import{c as ct}from"./chunk-SIZNMXVG.js";import{a as v}from"./chunk-3ODY6JMO.js";import{$a as nt,Fa as $,Ia as K,Ja as Y,La as J,M as j,Ma as Q,Na as X,Oa as Z,P as B,Pa as tt,Q as F,R as D,Ra as et,S as L,U as G,V as A,X as H,Y as S,a as E,ab as it,b as R,bb as ot,c as b,d as N,e as _,f as d,fb as rt,h as s,hb as y,i as w,j as U,k as P,l as O,m as l,n as r,o as a,p as m,pa as q,qa as W,s as f,t as g,u as p,ua as z,y as c}from"./chunk-C6RY7PX2.js";import"./chunk-G4GOZ2R2.js";import"./chunk-3EH7DRQW.js";import"./chunk-QUJFQN2Y.js";import"./chunk-E24K4UEG.js";import"./chunk-LEIZBYT7.js";import"./chunk-UM2WNVGK.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-TVBC6MYV.js";import"./chunk-26CMJVF7.js";import"./chunk-QQBOPM2N.js";import"./chunk-IACAUHTZ.js";import"./chunk-6KZXCEZL.js";import"./chunk-C7E54FQN.js";import"./chunk-ATYZ3M5D.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-Z455EQLB.js";import"./chunk-CKP3SGE2.js";import"./chunk-CIXXGG5D.js";import{j as h}from"./chunk-VI73JOY6.js";var x=(()=>{let e=class e{constructor(o){this.router=o}canActivate(o){return h(this,null,function*(){let{data:{session:n}}=yield v.auth.getSession();if(!n)return this.router.navigate(["/auth/login"]),!1;let u=o.data?.roles??[];if(!u.length)return!0;let{data:M,error:C}=yield v.from("usuario").select("rol").eq("id_auth",n.user.id).maybeSingle();return C||!M?.rol?(console.error("Error al obtener perfil o rol no definido:",C),this.router.navigate(["/auth/login"]),!1):u.includes(M.rol)?!0:(console.warn(`\u26D4 Acceso denegado. Rol actual: ${M.rol}, Roles permitidos: ${u.join(", ")}`),this.router.navigate(["/home"]),!1)})}};e.\u0275fac=function(n){return new(n||e)(N(A))},e.\u0275prov=R({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var pt=[{path:"",redirectTo:"auth/login",pathMatch:"full"},{path:"auth/login",loadComponent:()=>import("./chunk-AH3RKYHZ.js").then(t=>t.LoginPage)},{path:"auth/register",loadComponent:()=>import("./chunk-WRERXGHV.js").then(t=>t.RegisterPage)},{path:"solicitar",canActivate:[x],loadComponent:()=>import("./chunk-5JGVVSSW.js").then(t=>t.SolicitarCertificadoPage)},{path:"noticias",canActivate:[x],loadComponent:()=>import("./chunk-WXYJC5PM.js").then(t=>t.NoticiasPage)},{path:"noticias/crear",loadComponent:()=>import("./chunk-RPENZW4Q.js").then(t=>t.CrearNoticiaPage)},{path:"noticias/:id",loadComponent:()=>import("./chunk-O34BG6VS.js").then(t=>t.DetalleNoticiaPage)},{path:"votacion/:id",canActivate:[x],loadComponent:()=>import("./chunk-3YP555NE.js").then(t=>t.VotacionPage)},{path:"votaciones",loadComponent:()=>import("./chunk-6UWVVNSI.js").then(t=>t.VotacionesListPage)},{path:"solicitud",loadComponent:()=>import("./chunk-BDWD2J4F.js").then(t=>t.SolicitudPage)},{path:"generar/proyecto",canActivate:[x],data:{roles:["administrador"]},loadComponent:()=>import("./chunk-HOI5GCG3.js").then(t=>t.GenerarProyectoComponent)},{path:"generar/votacion",canActivate:[x],data:{roles:["administrador"]},loadComponent:()=>import("./chunk-AHPNUSFR.js").then(t=>t.GenerarVotacionPage)},{path:"home",canActivate:[x],loadComponent:()=>import("./chunk-EGOADEUE.js").then(t=>t.HomePage)},{path:"**",redirectTo:"auth/login"}],st=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=P({type:e}),e.\u0275inj=b({imports:[S.forRoot(pt,{preloadingStrategy:H}),S]});let t=e;return t})();var V=(function(t){return t.Dark="DARK",t.Light="LIGHT",t.Default="DEFAULT",t})(V||{});var I=ct("StatusBar");function ut(t,e){if(t&1){let i=f();r(0,"ion-item",12),g("click",function(){_(i);let n=p(2);return d(n.go("/home"))}),m(1,"ion-icon",13),r(2,"ion-label"),c(3,"Inicio"),a()()}}function _t(t,e){if(t&1){let i=f();r(0,"ion-item",12),g("click",function(){_(i);let n=p(2);return d(n.go("/solicitar"))}),m(1,"ion-icon",14),r(2,"ion-label"),c(3,"Solicitar certificado"),a()()}}function dt(t,e){if(t&1){let i=f();r(0,"ion-item",12),g("click",function(){_(i);let n=p(2);return d(n.go("/noticias"))}),m(1,"ion-icon",15),r(2,"ion-label"),c(3,"Noticias"),a()()}}function ft(t,e){if(t&1){let i=f();r(0,"ion-item",12),g("click",function(){_(i);let n=p(2);return d(n.go("/votaciones"))}),m(1,"ion-icon",16),r(2,"ion-label"),c(3,"Votaciones"),a()()}}function gt(t,e){t&1&&(r(0,"ion-list-header"),c(1,"Administraci\xF3n"),a())}function ht(t,e){if(t&1){let i=f();r(0,"ion-item",12),g("click",function(){_(i);let n=p(2);return d(n.go("/noticias/crear"))}),m(1,"ion-icon",17),r(2,"ion-label"),c(3,"Generar noticia"),a()()}}function Ct(t,e){if(t&1){let i=f();r(0,"ion-item",12),g("click",function(){_(i);let n=p(2);return d(n.go("/generar/proyecto"))}),m(1,"ion-icon",18),r(2,"ion-label"),c(3,"Generar proyecto"),a()()}}function xt(t,e){if(t&1){let i=f();r(0,"ion-item",12),g("click",function(){_(i);let n=p(2);return d(n.go("/generar/votacion"))}),m(1,"ion-icon",19),r(2,"ion-label"),c(3,"Generar votaci\xF3n"),a()()}}function vt(t,e){if(t&1){let i=f();r(0,"ion-menu",2)(1,"ion-header",3)(2,"ion-toolbar")(3,"ion-title"),c(4,"Men\xFA"),a()()(),r(5,"ion-content",4)(6,"ion-list",5)(7,"ion-menu-toggle",6),O(8,ut,4,0,"ion-item",7)(9,_t,4,0,"ion-item",7)(10,dt,4,0,"ion-item",7)(11,ft,4,0,"ion-item",7)(12,gt,2,0,"ion-list-header",8)(13,ht,4,0,"ion-item",7)(14,Ct,4,0,"ion-item",7)(15,xt,4,0,"ion-item",7),a()(),r(16,"div",9)(17,"ion-item",10),g("click",function(){_(i);let n=p();return d(n.salir())}),m(18,"ion-icon",11),r(19,"ion-label"),c(20,"Cerrar sesi\xF3n"),a()()()()()}if(t&2){let i=p();s(8),l("ngIf",!i.isActive("/home")),s(),l("ngIf",!i.isActive("/solicitar")),s(),l("ngIf",!i.isActive("/noticias")),s(),l("ngIf",!i.isActive("/votaciones")),s(),l("ngIf",i.isAdmin),s(),l("ngIf",i.isAdmin&&!i.isActive("/noticias/crear")),s(),l("ngIf",i.isAdmin&&!i.isActive("/generar/proyecto")),s(),l("ngIf",i.isAdmin&&!i.isActive("/generar/votacion"))}}var T=(()=>{let e=class e{constructor(o,n,u,M){this.router=o,this.menu=n,this.auth=u,this.platform=M,this.currentUrl="",this.isAdmin=!1,this.currentUrl=this.router.url||"",this.refrescarRol(),this.platform.ready().then(()=>this.configurarStatusBar()),this.router.events.pipe(E(C=>C instanceof L)).subscribe(C=>h(this,null,function*(){this.currentUrl=C.urlAfterRedirects||C.url||"",yield this.refrescarRol()}))}get isAuth(){return this.currentUrl.startsWith("/auth")}isActive(o){return this.currentUrl?this.currentUrl===o||this.currentUrl.startsWith(o+"/"):!1}go(o){return h(this,null,function*(){try{(yield this.menu.isOpen("mainMenu"))&&(yield this.menu.close("mainMenu"))}catch{}yield this.router.navigateByUrl(o)})}salir(){return h(this,null,function*(){try{yield this.auth.signOut(),this.isAdmin=!1}finally{try{(yield this.menu.isOpen("mainMenu"))&&(yield this.menu.close("mainMenu"))}catch{}yield this.router.navigateByUrl("/auth/login",{replaceUrl:!0})}})}refrescarRol(){return h(this,null,function*(){try{if(this.isAuth){this.isAdmin=!1;return}let{data:{user:o}}=yield v.auth.getUser();if(!o){this.isAdmin=!1;return}let{data:n,error:u}=yield v.from("usuario").select("rol").eq("user_id",o.id).maybeSingle();if(u){this.isAdmin=!1;return}this.isAdmin=n?.rol==="administrador"}catch{this.isAdmin=!1}})}configurarStatusBar(){return h(this,null,function*(){try{yield I.setOverlaysWebView({overlay:!1}),yield I.setBackgroundColor({color:"#000000"}),yield I.setStyle({style:V.Dark})}catch{}})}};e.\u0275fac=function(n){return new(n||e)(w(A),w(rt),w(at),w(q))},e.\u0275cmp=U({type:e,selectors:[["app-root"]],decls:3,vars:1,consts:[["side","start","menuId","mainMenu","contentId","main-content","type","reveal",4,"ngIf"],["id","main-content"],["side","start","menuId","mainMenu","contentId","main-content","type","reveal"],[1,"menu-header"],[1,"menu-content"],["lines","none",1,"menu-list"],["auto-hide","true"],["button","","detail","false",3,"click",4,"ngIf"],[4,"ngIf"],[1,"logout-wrap"],["button","","detail","false",1,"logout",3,"click"],["slot","start","name","log-out-outline"],["button","","detail","false",3,"click"],["slot","start","name","home-outline"],["slot","start","name","document-text-outline"],["slot","start","name","newspaper-outline"],["slot","start","name","people-outline"],["slot","start","name","create-outline"],["slot","start","name","construct-outline"],["slot","start","name","list-circle-outline"]],template:function(n,u){n&1&&(r(0,"ion-app"),O(1,vt,21,8,"ion-menu",0),m(2,"ion-router-outlet",1),a()),n&2&&(s(),l("ngIf",!u.isAuth))},dependencies:[B,j,y,z,$,K,Y,J,Q,X,Z,tt,et,nt,it,ot],styles:['@charset "UTF-8";ion-header[_ngcontent-%COMP%], ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{position:relative;z-index:1000;pointer-events:auto;--min-height: 56px}ion-menu[type=reveal][_ngcontent-%COMP%]::part(backdrop){opacity:0;pointer-events:none}ion-menu[_ngcontent-%COMP%]::part(container){box-shadow:0 8px 24px #0206173d;border-right:1px solid rgba(2,6,23,.06)}.menu-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #2563eb, #60a5fa);--color: #fff}.menu-content[_ngcontent-%COMP%]{--background: #f8fafc}.menu-content[_ngcontent-%COMP%]   .menu-list[_ngcontent-%COMP%]{background:transparent;padding:6px 0}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin:8px 6px;border-radius:14px;background:#fff;--background: #fff;border:1px solid rgba(37,99,235,.1);transition:transform .12s ease,box-shadow .12s ease,border-color .12s ease}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#2563eb;font-size:20px}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:600;color:#0f172a}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:active{transform:translateY(1px)}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:focus-within, .menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:hover{border-color:#2563eb33;box-shadow:0 8px 18px #2563eb1a}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]{margin-top:auto;padding-top:8px}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]{background:#fff5f5;border-color:#ef444433}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#ef4444}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:#b91c1c}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]:hover{box-shadow:0 8px 18px #ef44441f}']});let t=e;return t})();var lt=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=P({type:e,bootstrap:[T]}),e.\u0275inj=b({providers:[{provide:G,useClass:W}],imports:[D,y.forRoot(),st,T]});let t=e;return t})();F().bootstrapModule(lt).catch(t=>console.log(t));
