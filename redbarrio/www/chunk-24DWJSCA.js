import{a as ht}from"./chunk-DSYC522I.js";import{a as _}from"./chunk-BSJEIMOO.js";import"./chunk-CGH6KSUE.js";import{$a as st,A as x,B as y,C as k,Da as K,Ea as Q,Fa as W,Ga as X,Ha as Z,Ia as $,J as w,Ja as tt,K as S,M as N,Ma as it,O as F,P as D,Qa as et,R as j,Ra as nt,Sa as ot,Ua as rt,Va as at,Wa as ct,X as H,Z as B,ba as R,ca as q,da as z,f as P,g as E,i as n,ia as V,j as f,jb as dt,k as M,ka as G,kb as lt,lb as pt,m as g,n as l,na as L,nb as mt,o,p as r,q as b,qb as ut,r as I,ra as Y,rb as ft,s as C,t as A,ta as U,u as O,ub as gt,v as h,w as T,ya as J,z as a}from"./chunk-JZTRD5FY.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as p}from"./chunk-VI73JOY6.js";function _t(e,s){if(e&1&&(I(0),a(1),C()),e&2){let d=h(2);n(),k(" \u2022 Cupos: ",d.cuposRestantes," / ",d.proyecto.cupos_total)}}function xt(e,s){if(e&1&&(o(0,"div",17),b(1,"ion-img",18),r()),e&2){let d=h(2);n(),l("src",d.proyecto.imagen_url)}}function vt(e,s){e&1&&(o(0,"div",19),b(1,"ion-icon",20),o(2,"p"),a(3,"Sin imagen disponible"),r()())}function bt(e,s){if(e&1&&(o(0,"ion-list")(1,"ion-item")(2,"ion-label")(3,"h3"),a(4,"Inicio"),r(),o(5,"p"),a(6),w(7,"date"),r()()(),o(8,"ion-item")(9,"ion-label")(10,"h3"),a(11,"T\xE9rmino"),r(),o(12,"p"),a(13),w(14,"date"),r()()()()),e&2){let d=h(2);n(6),x(S(7,2,d.proyecto.fecha_inicio,"dd/MM/yyyy HH:mm")),n(7),x(S(14,5,d.proyecto.fecha_fin,"dd/MM/yyyy HH:mm"))}}function yt(e,s){e&1&&(I(0),a(1,"Enviando..."),C())}function It(e,s){if(e&1&&(I(0),a(1),C()),e&2){let d=h(2);n(),y(" ",d.isActividad?d.yaInscrito?"Ya inscrito":d.sinCupos?"Sin cupos":"Inscribirse a la actividad":"Inscribirse"," ")}}function Ct(e,s){e&1&&(o(0,"ion-note",21),a(1,"No hay cupos disponibles."),r())}function wt(e,s){e&1&&(o(0,"ion-note",22),a(1,"Ya est\xE1s inscrito en esta actividad."),r())}function St(e,s){if(e&1){let d=A();o(0,"ion-content",5)(1,"div",6)(2,"ion-card",7)(3,"ion-card-header")(4,"ion-card-title"),a(5),r(),o(6,"ion-card-subtitle"),a(7),w(8,"date"),g(9,_t,2,2,"ng-container",8),r()(),o(10,"ion-card-content"),g(11,xt,2,1,"div",9)(12,vt,4,0,"ng-template",null,0,N),o(14,"p",10),a(15),r(),g(16,bt,15,8,"ion-list",8),r()(),o(17,"ion-card",7)(18,"ion-card-header")(19,"ion-card-title"),a(20,"Inscribirse"),r(),o(21,"ion-card-subtitle"),a(22),r()(),o(23,"ion-card-content")(24,"form",11),O("ngSubmit",function(){P(d);let i=h();return E(i.enviarPostulacion())}),o(25,"ion-item")(26,"ion-label",12),a(27),r(),b(28,"ion-textarea",13),r(),o(29,"ion-button",14),g(30,yt,2,0,"ng-container",8)(31,It,2,1,"ng-container",8),r(),g(32,Ct,2,0,"ion-note",15)(33,wt,2,0,"ion-note",16),r()()()()()}if(e&2){let d=T(13),t=h();l("fullscreen",!0),n(5),x(t.proyecto.titulo),n(2),y(" Publicado: ",S(8,17,t.proyecto.fecha,"dd/MM/yyyy HH:mm")," "),n(2),l("ngIf",t.isActividad),n(2),l("ngIf",t.proyecto.imagen_url)("ngIfElse",d),n(4),y(" ",t.proyecto.descripcion," "),n(),l("ngIf",t.isActividad),n(6),y(" ",t.isActividad?"Te sumaremos a la actividad si hay cupos disponibles":"Cu\xE9ntanos por qu\xE9 quieres participar"," "),n(2),l("formGroup",t.inscripcionForm),n(3),x(t.isActividad?"Comentario (opcional)":"Motivaci\xF3n"),n(),l("placeholder",t.isActividad?"Comentario breve":"Explica tu inter\xE9s en este proyecto"),n(),l("disabled",t.inscripcionForm.invalid||t.isSubmitting||t.isActividad&&(t.sinCupos||t.yaInscrito)),n(),l("ngIf",t.isSubmitting),n(),l("ngIf",!t.isSubmitting),n(),l("ngIf",t.isActividad&&t.sinCupos),n(),l("ngIf",t.isActividad&&t.yaInscrito)}}var jt=(()=>{let s=class s{constructor(t,i,c,m,v,u){this.fb=t,this.route=i,this.router=c,this.auth=m,this.alertCtrl=v,this.loadingCtrl=u,this.perfil=null,this.idProyecto=null,this.idActividad=null,this.isActividad=!1,this.proyecto=null,this.cuposRestantes=0,this.sinCupos=!1,this.yaInscrito=!1,this.isSubmitting=!1}ngOnInit(){return p(this,null,function*(){yield this.validarSesion(),this.inscripcionForm=this.fb.group({descripcion:["",[R.maxLength(250)]]}),this.route.params.subscribe(t=>p(this,null,function*(){let i=t.id;if(!i){console.warn("\u26A0\uFE0F Sin par\xE1metro ID en la ruta");return}this.idProyecto=i,this.idActividad=i,yield this.cargarDatos()}))})}validarSesion(){return p(this,null,function*(){try{let i=(yield this.auth.waitForActiveSession())?.user?.id;if(!i){console.warn("\u26A0\uFE0F No se encontr\xF3 usuario autenticado.");return}let c=yield this.auth.miPerfil();if(!c){let m=localStorage.getItem("rb_usuario_activo");m&&(c=JSON.parse(m))}c&&(this.perfil=c),console.log("\u2705 Sesi\xF3n activa con UID:",i)}catch(t){console.error("Error validando sesi\xF3n:",t)}})}cargarDatos(){return p(this,null,function*(){let t=yield this.loadingCtrl.create({message:"Cargando informaci\xF3n...",spinner:"crescent"});yield t.present();try{let{data:i}=yield _.from("actividad").select("*").eq("id_actividad",this.idActividad).maybeSingle();if(i)this.proyecto=i,this.isActividad=!0,yield this.verificarEstadoActividad(),console.log("\u2705 Actividad cargada:",i);else{let{data:c}=yield _.from("proyecto").select("*").eq("id_proyecto",this.idProyecto).maybeSingle();this.proyecto=c,this.isActividad=!1,console.log("\u2705 Proyecto cargado:",c)}}catch(i){console.error("Error al cargar datos:",i),yield this.mostrarAlerta("Error","No se pudo cargar la informaci\xF3n.")}finally{t.dismiss()}})}verificarEstadoActividad(){return p(this,null,function*(){if(!this.idActividad||!this.perfil)return;let{count:t}=yield _.from("actividad_inscripcion").select("*",{count:"exact",head:!0}).eq("id_actividad",this.idActividad),{data:i}=yield _.from("actividad_inscripcion").select("id_actividad").eq("id_actividad",this.idActividad).eq("id_auth",this.perfil.id_auth).maybeSingle();this.yaInscrito=!!i,this.cuposRestantes=(this.proyecto?.cupos_total||0)-(t||0),this.sinCupos=this.cuposRestantes<=0})}enviarPostulacion(){return p(this,null,function*(){this.isSubmitting=!0;let t=yield this.loadingCtrl.create({message:"Enviando...",spinner:"crescent"});yield t.present();try{let c=(yield this.auth.waitForActiveSession())?.user?.id;if(!c)throw new Error("No hay usuario autenticado.");let m=this.inscripcionForm.value.descripcion?.trim()||null,v=new Date().toISOString();if(this.isActividad&&this.idActividad){let{error:u}=yield _.from("actividad_inscripcion").insert([{id_actividad:this.idActividad,id_auth:c,estado:"pendiente",comentario:m??null,fecha:v}]);if(u)throw u}else if(this.idProyecto){let{error:u}=yield _.from("proyecto_postulacion").insert([{id_proyecto:this.idProyecto,id_auth:c,descripcion:m??null,estado:"pendiente",fecha:v,actualizado_en:v}]);if(u)throw u}yield this.mostrarAlerta("\xC9xito","Tu inscripci\xF3n se ha enviado correctamente."),this.router.navigate(["/inscripcion/proyectos"])}catch(i){console.error("Error al enviar inscripci\xF3n:",i),yield this.mostrarAlerta("Error","No se pudo enviar la inscripci\xF3n.")}finally{this.isSubmitting=!1,t.dismiss()}})}mostrarAlerta(t,i){return p(this,null,function*(){yield(yield this.alertCtrl.create({header:t,message:i,buttons:["Aceptar"]})).present()})}};s.\u0275fac=function(i){return new(i||s)(f(Y),f(H),f(B),f(ht),f(ut),f(ft))},s.\u0275cmp=M({type:s,selectors:[["app-inscripcion-proyecto"]],decls:7,vars:2,consts:[["noImagen",""],[1,"rb-header"],["slot","start"],["defaultHref","/inscripcion/proyectos"],[3,"fullscreen",4,"ngIf"],[3,"fullscreen"],[1,"page-wrap","ion-padding"],[1,"card"],[4,"ngIf"],["class","imagen-container",4,"ngIf","ngIfElse"],[1,"descripcion"],[3,"ngSubmit","formGroup"],["position","stacked"],["formControlName","descripcion","autoGrow","true",3,"placeholder"],["expand","block","type","submit","color","primary",3,"disabled"],["color","danger",4,"ngIf"],["color","medium",4,"ngIf"],[1,"imagen-container"],[1,"imagen-proyecto",3,"src"],[1,"placeholder"],["name","image-outline",1,"placeholder-icon"],["color","danger"],["color","medium"]],template:function(i,c){i&1&&(o(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),b(3,"ion-back-button",3),r(),o(4,"ion-title"),a(5),r()()(),g(6,St,34,20,"ion-content",4)),i&2&&(n(5),x(c.isActividad?"Detalle de la Actividad":"Detalle del Proyecto"),n(),l("ngIf",c.proyecto))},dependencies:[j,F,gt,K,Q,W,X,Z,$,tt,it,et,nt,ot,rt,at,ct,st,dt,lt,pt,J,mt,U,V,q,z,G,L,D],styles:['@charset "UTF-8";[_nghost-%COMP%], html[_nghost-%COMP%], html   [_nghost-%COMP%]{color-scheme:light!important;--rb-primary: #2563eb;--rb-bg: #f5f7fb;--rb-text: #0f172a;--rb-muted: #475569;--ion-text-color: var(--rb-text);--ion-background-color: var(--rb-bg);--ion-item-background: #ffffff;--ion-card-background: #ffffff}.rb-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #2563eb, #60a5fa);--color: #fff;--border-color: transparent}ion-content[_ngcontent-%COMP%]{--background: var(--rb-bg)}.page-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:16px;max-width:960px;margin:0 auto}.card[_ngcontent-%COMP%]{width:100%;max-width:720px;border-radius:18px;background:#fff;border:1px solid rgba(2,6,23,.08);box-shadow:0 12px 28px #0206171a;overflow:hidden;margin-bottom:20px;transition:transform .2s ease-in-out,box-shadow .2s ease-in-out}.card[_ngcontent-%COMP%]:hover{box-shadow:0 14px 30px #02061726}.card[_ngcontent-%COMP%]:active{transform:translateY(1px);box-shadow:0 8px 24px #02061714}.card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid rgba(2,6,23,.06);padding-bottom:8px}.card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{color:var(--rb-text);font-weight:800;font-size:1.3rem}.card[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#64748b;font-weight:600;margin-top:4px;font-size:.9rem}.imagen-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:16px 0}.imagen-proyecto[_ngcontent-%COMP%]{width:100%;max-width:360px;height:auto;border-radius:12px;object-fit:cover;box-shadow:0 3px 10px #00000026;transition:transform .2s ease-in-out}.imagen-proyecto[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;color:var(--rb-muted);margin:20px 0}.placeholder-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:6px}.descripcion[_ngcontent-%COMP%]{color:var(--rb-text);font-size:.95rem;line-height:1.5;margin-top:10px;text-align:justify}ion-item[_ngcontent-%COMP%]{--background: #fff;--border-color: var(--ion-color-medium);border-radius:10px;margin-bottom:14px}ion-textarea[_ngcontent-%COMP%]{--min-height: 120px;font-size:.95rem}ion-button[_ngcontent-%COMP%]{--border-radius: 10px;font-weight:700;margin-top:8px;box-shadow:0 6px 16px #2563eb40;transition:transform .2s ease-in-out,box-shadow .2s ease-in-out}ion-button[_ngcontent-%COMP%]:active{transform:translateY(1px);box-shadow:0 4px 12px #2563eb33}@media (prefers-color-scheme: dark){[_nghost-%COMP%]{--ion-background-color: var(--rb-bg);--ion-card-background: #ffffff;--ion-item-background: #ffffff;--ion-text-color: var(--rb-text)}}']});let e=s;return e})();export{jt as InscripcionProyectoComponent};
