import{a as it}from"./chunk-KPKAVJKI.js";import{$a as nt,A as _,Aa as L,Ba as j,Ca as A,Da as R,Fa as U,Ia as Y,Ja as G,L as E,La as J,M as k,Ma as K,Na as Q,P as $,Qa as W,Sa as X,T as F,Ya as Z,Za as tt,ab as ot,e as C,f as O,h as r,hb as et,i as M,j as I,l as m,m as p,n as c,na as D,o as a,p as f,q as P,r as y,s as w,t as V,u as g,va as B,w as S,wa as q,x as T,xa as N,y as d,ya as z,z as u,za as H}from"./chunk-C6RY7PX2.js";import"./chunk-G4GOZ2R2.js";import"./chunk-3EH7DRQW.js";import"./chunk-QUJFQN2Y.js";import"./chunk-E24K4UEG.js";import"./chunk-LEIZBYT7.js";import"./chunk-UM2WNVGK.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-TVBC6MYV.js";import"./chunk-26CMJVF7.js";import"./chunk-QQBOPM2N.js";import"./chunk-IACAUHTZ.js";import"./chunk-6KZXCEZL.js";import"./chunk-C7E54FQN.js";import"./chunk-ATYZ3M5D.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-Z455EQLB.js";import"./chunk-CKP3SGE2.js";import"./chunk-CIXXGG5D.js";import{a as b,b as v,j as x}from"./chunk-VI73JOY6.js";function rt(e,s){if(e&1&&(c(0,"ion-text",7),d(1),a()),e&2){let o=g();r(),u(o.errorMsg)}}function at(e,s){e&1&&(c(0,"div",8),f(1,"ion-spinner",9),a())}function ct(e,s){if(e&1&&(c(0,"ion-card-subtitle"),d(1),a()),e&2){let o=g(2);r(),_(" ",o.votacion.descripcion," ")}}function st(e,s){if(e&1&&(c(0,"ion-badge",18),d(1),a()),e&2){let o=g(2);r(),_(" Total: ",o.totalVotos," ")}}function lt(e,s){if(e&1){let o=w();c(0,"ion-item",19)(1,"ion-label",20)(2,"div",21)(3,"h2",22),d(4),a(),c(5,"span",23),d(6),a()(),c(7,"div",24),f(8,"div",25),a(),c(9,"p",26),d(10),a()(),c(11,"ion-button",27),V("click",function(){let n=C(o).$implicit,i=g(2);return O(i.votar(n))}),d(12),a()()}if(e&2){let o=s.$implicit,t=g(2);S("--pct",t.pct(o)),T("seleccionada",t.miOpcionId===o.id),r(4),u(o.titulo),r(2),_("",t.percent(o),"%"),r(4),_("Votos: ",o.total_votos),r(),p("disabled",!!t.miOpcionId||t.bloqueada),r(),_(" ",t.miOpcionId&&t.miOpcionId===o.id?"Votado":"Votar"," ")}}function dt(e,s){e&1&&(c(0,"ion-note",28),d(1,"\xA1Voto registrado!"),a())}function pt(e,s){if(e&1&&(P(0),c(1,"ion-card",10)(2,"ion-card-header")(3,"ion-card-title"),d(4),a(),m(5,ct,2,1,"ion-card-subtitle",6),a(),c(6,"ion-card-content")(7,"div",11)(8,"ion-chip",12),f(9,"ion-icon",13),c(10,"ion-label"),d(11),a()(),m(12,st,2,1,"ion-badge",14),a(),c(13,"ion-list",15),m(14,lt,13,9,"ion-item",16),a(),m(15,dt,2,0,"ion-note",17),a()(),y()),e&2){let o=g();r(4),u(o.votacion.titulo),r(),p("ngIf",o.votacion.descripcion),r(3),p("color",o.bloqueada?"medium":"primary")("outline",!0),r(3),u(o.etiquetaTiempo()),r(),p("ngIf",o.totalVotos),r(2),p("ngForOf",o.opciones)("ngForTrackBy",o.trackByOp),r(),p("ngIf",o.miOpcionId)}}var xt=(()=>{let s=class s{constructor(t,n){this.route=t,this.votosSvc=n,this.cargando=!0,this.errorMsg="",this.opciones=[],this.now=Date.now()}ngOnInit(){return x(this,null,function*(){this.id=this.route.snapshot.paramMap.get("id"),this.timer=setInterval(()=>this.now=Date.now(),1e3),yield this.cargar(),this.canalVotos=this.votosSvc.suscribirVotosInsertados(this.id,t=>{let i=t.new?.opcion_id;if(!i)return;let l=this.opciones.findIndex(h=>h.id===i);l>=0&&(this.opciones[l]=v(b({},this.opciones[l]),{total_votos:(this.opciones[l].total_votos??0)+1}))})})}ngOnDestroy(){this.canalVotos&&this.votosSvc.desuscribir(this.canalVotos),this.timer&&clearInterval(this.timer)}cargar(){return x(this,null,function*(){this.cargando=!0,this.errorMsg="";try{let t=yield this.votosSvc.obtenerVotacionConOpciones(this.id);this.votacion=t.votacion,this.opciones=t.opciones,this.miOpcionId=t.miOpcionId}catch(t){this.errorMsg=t?.message??"No se pudo cargar la votaci\xF3n"}finally{this.cargando=!1}})}get totalVotos(){return this.opciones.reduce((t,n)=>t+(n?.total_votos??0),0)}percent(t){let n=this.totalVotos;if(!n)return 0;let i=(t?.total_votos??0)*100/n;return Math.round(i)}pct(t){return`${this.percent(t)}%`}trackByOp(t,n){return n.id}get bloqueada(){if(!this.votacion)return!0;let t=this.now,n=new Date(this.votacion.fecha_inicio).getTime(),i=new Date(this.votacion.fecha_fin).getTime();return t<n||t>i}etiquetaTiempo(){if(!this.votacion)return"";let t=this.now,n=new Date(this.votacion.fecha_inicio).getTime(),i=new Date(this.votacion.fecha_fin).getTime();return t<n?`Inicia en: ${this.formatMs(n-t)}`:t>i?"Finalizada":`Termina en: ${this.formatMs(i-t)}`}formatMs(t){if(t<=0)return"0s";let n=Math.floor(t/1e3),i=Math.floor(n/86400);n%=86400;let l=Math.floor(n/3600);n%=3600;let h=Math.floor(n/60);return n%=60,i?`${i}d ${l}h ${h}m`:l?`${l}h ${h}m ${n}s`:`${h}m ${n}s`}votar(t){return x(this,null,function*(){if(!this.votacion)return;if(this.miOpcionId){this.errorMsg="Ya emitiste tu voto en esta votaci\xF3n";return}if(this.bloqueada){this.errorMsg="La votaci\xF3n no est\xE1 activa";return}this.errorMsg="";let n=this.opciones.findIndex(l=>l.id===t.id),i=n>=0?this.opciones[n].total_votos:0;n>=0&&(this.opciones[n]=v(b({},this.opciones[n]),{total_votos:i+1}));try{yield this.votosSvc.votar(this.votacion.id,t.id),this.miOpcionId=t.id}catch(l){n>=0&&(this.opciones[n]=v(b({},this.opciones[n]),{total_votos:i})),this.errorMsg=l?.message??"No se pudo registrar tu voto"}})}};s.\u0275fac=function(n){return new(n||s)(M(F),M(it))},s.\u0275cmp=I({type:s,selectors:[["app-votacion"]],decls:10,vars:4,consts:[[1,"rb-header"],["slot","start"],["menu","mainMenu","autoHide","false"],[1,"ion-padding","votacion",3,"fullscreen"],["color","danger","class","err",4,"ngIf"],["class","ion-text-center",4,"ngIf"],[4,"ngIf"],["color","danger",1,"err"],[1,"ion-text-center"],["name","crescent"],[1,"card"],[1,"status"],[3,"color","outline"],["name","time-outline"],["color","tertiary","class","total",4,"ngIf"],["lines","none",1,"opciones"],["class","opcion",3,"seleccionada","--pct",4,"ngFor","ngForOf","ngForTrackBy"],["color","success",4,"ngIf"],["color","tertiary",1,"total"],[1,"opcion"],[1,"label"],[1,"top"],[1,"titulo"],[1,"pct-badge"],[1,"bar"],[1,"fill"],[1,"meta"],["slot","end",3,"click","disabled"],["color","success"]],template:function(n,i){n&1&&(c(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),f(3,"ion-menu-button",2),a(),c(4,"ion-title"),d(5,"Votaci\xF3n"),a()()(),c(6,"ion-content",3),m(7,rt,2,1,"ion-text",4)(8,at,2,0,"div",5)(9,pt,16,9,"ng-container",6),a()),n&2&&(r(6),p("fullscreen",!0),r(),p("ngIf",i.errorMsg),r(),p("ngIf",i.cargando),r(),p("ngIf",!i.cargando&&i.votacion))},dependencies:[$,E,k,D,et,B,q,N,z,H,L,j,A,R,U,Y,G,J,K,Q,W,X,Z,tt,nt,ot],styles:['@charset "UTF-8";[_nghost-%COMP%]{color-scheme:light;--rb-primary: #2563eb;--rb-primary-10: rgba(37, 99, 235, .1);--rb-primary-20: rgba(37, 99, 235, .2);--rb-bg: #f8fafc;--rb-text: #0f172a;--ion-background-color: var(--rb-bg);--ion-text-color: var(--rb-text)}.rb-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--rb-primary), #60a5fa);--color: #fff;--border-color: transparent}ion-card[_ngcontent-%COMP%]{background:#fff;border-radius:18px;border:1px solid rgba(2,6,23,.06);box-shadow:0 10px 26px #02061714;overflow:hidden}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid rgba(2,6,23,.06)}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-weight:800;color:var(--rb-text)}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#64748b;font-weight:500}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding-top:12px}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{margin-bottom:8px;--color: var(--rb-text);--background: var(--rb-primary-10);--border-color: var(--rb-primary-20)}ion-list[_ngcontent-%COMP%]{background:transparent}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{position:relative;overflow:hidden;margin:10px 6px;border-radius:14px;background:#fff;--background: #fff;border:1px solid rgba(2,6,23,.06);box-shadow:0 6px 14px #0206170f}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;width:var(--pct, 0%);background:var(--bar-color, rgba(37, 99, 235, .14));transition:width .35s ease;z-index:0}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{position:relative;z-index:1}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:2px 0 4px;font-weight:800;color:var(--rb-text)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#64748b;font-weight:600}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 10px 18px var(--rb-primary-10);--padding-start: 14px;--padding-end: 14px}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:nth-child(6n+1){--bar-color: rgba(37, 99, 235, .18)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:nth-child(6n+2){--bar-color: rgba(34, 197, 94, .18)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:nth-child(6n+3){--bar-color: rgba(234, 179, 8, .2)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:nth-child(6n+4){--bar-color: rgba(168, 85, 247, .18)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:nth-child(6n+5){--bar-color: rgba(20, 184, 166, .18)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:nth-child(6n+6){--bar-color: rgba(244, 63, 94, .18)}ion-note[_ngcontent-%COMP%]{display:inline-block;margin-top:8px;font-weight:700}.ios[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 12px;--inner-padding-end: 12px}']});let e=s;return e})();export{xt as VotacionPage};
