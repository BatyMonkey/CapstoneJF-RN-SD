import{a as lt}from"./chunk-FHDZCLRV.js";import"./chunk-IIFLUBAB.js";import"./chunk-SIZNMXVG.js";import"./chunk-TX5AFJTF.js";import"./chunk-66QFWZLQ.js";import{A as d,B as C,C as _,Da as q,Ea as z,Fa as R,Ga as j,Ha as N,Ia as A,Ja as H,Ka as L,La as U,Na as W,O as E,P as D,Ra as Y,S as $,Sa as G,Va as J,Wa as K,Xa as Q,Y as F,_a as X,ab as Z,bb as tt,cb as nt,f as x,g as v,h as w,i as o,ib as et,j as M,jb as it,k as T,lb as ot,m,mb as at,o as l,p as c,q as r,qb as rt,r as f,s as y,t as k,ta as B,u as I,ub as ct,v as h,vb as st,w as p,y as V,z as S}from"./chunk-H7HGEQUX.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{a as u,b as P,j as b}from"./chunk-VI73JOY6.js";function dt(i,s){if(i&1&&(c(0,"ion-text",10),d(1),r()),i&2){let e=p();o(),C(e.errorMsg)}}function pt(i,s){i&1&&(c(0,"div",11),f(1,"ion-spinner",12),r())}function gt(i,s){if(i&1&&(c(0,"ion-card-subtitle"),d(1),r()),i&2){let e=p(2);o(),_(" ",e.votacion.descripcion," ")}}function mt(i,s){if(i&1&&(c(0,"ion-badge",21),d(1),r()),i&2){let e=p(2);o(),_(" Total: ",e.totalVotos," ")}}function _t(i,s){if(i&1&&(c(0,"p",33),d(1),r()),i&2){let e=p().$implicit;o(),_(" ",e.descripcion," ")}}function ft(i,s){if(i&1){let e=I();c(0,"button",34),h("click",function(){x(e);let n=p().$implicit,a=p(2);return v(a.openDetail(n))}),f(1,"img",35),r()}if(i&2){let e=p().$implicit;o(),l("src",e.image_url,w)}}function ht(i,s){if(i&1){let e=I();c(0,"ion-item",22)(1,"ion-label",23)(2,"div",24)(3,"h2",25),d(4),r(),c(5,"span",26),d(6),r()(),m(7,_t,2,1,"p",27),c(8,"div",28),f(9,"div",29),r(),m(10,ft,2,1,"button",30),c(11,"p",31),d(12),r()(),c(13,"ion-button",32),h("click",function(){let n=x(e).$implicit,a=p(2);return v(a.votar(n))}),d(14),r()()}if(i&2){let e=s.$implicit,t=p(2);V("--pct",t.pct(e)),S("seleccionada",t.miOpcionId===e.id),o(4),C(e.titulo),o(2),_("",t.percent(e),"%"),o(),l("ngIf",e.descripcion),o(3),l("ngIf",e.image_url),o(2),_("Votos: ",e.total_votos),o(),l("disabled",!!t.miOpcionId||t.bloqueada),o(),_(" ",t.miOpcionId&&t.miOpcionId===e.id?"Votado":"Votar"," ")}}function ut(i,s){i&1&&(c(0,"ion-note",36),d(1,"\xA1Voto registrado!"),r())}function bt(i,s){if(i&1&&(y(0),c(1,"ion-card",13)(2,"ion-card-header")(3,"ion-card-title"),d(4),r(),m(5,gt,2,1,"ion-card-subtitle",8),r(),c(6,"ion-card-content")(7,"div",14)(8,"ion-chip",15),f(9,"ion-icon",16),c(10,"ion-label"),d(11),r()(),m(12,mt,2,1,"ion-badge",17),r(),c(13,"ion-list",18),m(14,ht,15,11,"ion-item",19),r(),m(15,ut,2,0,"ion-note",20),r()(),k()),i&2){let e=p();o(4),C(e.votacion.titulo),o(),l("ngIf",e.votacion.descripcion),o(3),l("color",e.bloqueada?"medium":"primary")("outline",!0),o(3),C(e.etiquetaTiempo()),o(),l("ngIf",e.totalVotos),o(2),l("ngForOf",e.opciones)("ngForTrackBy",e.trackByOp),o(),l("ngIf",e.miOpcionId)}}function xt(i,s){if(i&1&&(c(0,"div",45),f(1,"img",35),r()),i&2){let e=p().ngIf;o(),l("src",e.image_url,w)}}function vt(i,s){if(i&1&&(c(0,"ion-card-subtitle"),d(1),r()),i&2){let e=p().ngIf;o(),_(" ",e.descripcion," ")}}function Ct(i,s){if(i&1){let e=I();y(0),c(1,"div",37),h("click",function(){x(e);let n=p(2);return v(n.closeDetail())}),c(2,"ion-card",38),h("click",function(n){return x(e),v(n.stopPropagation())}),m(3,xt,2,1,"div",39),c(4,"ion-card-header")(5,"ion-card-title"),d(6),r(),m(7,vt,2,1,"ion-card-subtitle",8),r(),c(8,"ion-card-content")(9,"div",40)(10,"ion-badge",41),d(11),r(),c(12,"ion-badge",42),d(13),r()(),c(14,"div",43),f(15,"div",29),r(),c(16,"ion-button",44),h("click",function(){let n=x(e).ngIf,a=p(2);return v(a.votar(n))}),d(17),r()()()(),k()}if(i&2){let e=s.ngIf,t=p(2);o(3),l("ngIf",e.image_url),o(3),C(e.titulo),o(),l("ngIf",e.descripcion),o(4),_("",t.percent(e),"%"),o(2),_("Votos: ",e.total_votos||0),o(2),V("width",t.percent(e),"%"),o(),l("disabled",!!t.miOpcionId||t.bloqueada),o(),_(" ",t.miOpcionId&&t.miOpcionId===e.id?"Votado":"Votar"," ")}}function Ot(i,s){if(i&1&&m(0,Ct,18,9,"ng-container",8),i&2){let e=p();l("ngIf",e.selectedOp)}}var St=(()=>{let s=class s{constructor(t,n,a){this.route=t,this.votosSvc=n,this.toastCtrl=a,this.cargando=!0,this.errorMsg="",this.opciones=[],this.now=Date.now(),this.detailOpen=!1}ngOnInit(){return b(this,null,function*(){this.id=this.route.snapshot.paramMap.get("id"),this.timer=setInterval(()=>this.now=Date.now(),1e3),yield this.cargar(),this.canalVotos=this.votosSvc.suscribirVotosInsertados(this.id,t=>{let n=t.new?.opcion_id;if(!n)return;let a=this.opciones.findIndex(g=>g.id===n);a>=0&&(this.opciones[a]=P(u({},this.opciones[a]),{total_votos:(this.opciones[a].total_votos??0)+1}),this.selectedOp?.id===n&&(this.selectedOp=u({},this.opciones[a])))})})}ngAfterViewInit(){this.presentingEl=document.querySelector("ion-router-outlet")||void 0}ngOnDestroy(){this.canalVotos&&this.votosSvc.desuscribir(this.canalVotos),this.timer&&clearInterval(this.timer)}ionViewWillEnter(){this.cargando=!0,setTimeout(()=>this.cargar(),600)}cargar(){return b(this,null,function*(){this.cargando=!0,this.errorMsg="";try{let t=yield this.votosSvc.obtenerVotacionConOpciones(this.id);this.votacion=t.votacion,this.opciones=t.opciones,this.miOpcionId=t.miOpcionId}catch(t){this.errorMsg=t?.message??"No se pudo cargar la votaci\xF3n",console.error("Error cargar votaci\xF3n:",t)}finally{this.cargando=!1}})}handleRefresh(t){return b(this,null,function*(){try{yield this.cargar()}finally{t.target?.complete?.()}})}get totalVotos(){return this.opciones.reduce((t,n)=>t+(n?.total_votos??0),0)}percent(t){let n=this.totalVotos;return n?Math.round((t?.total_votos??0)*100/n):0}pct(t){return`${this.percent(t)}%`}trackByOp(t,n){return n.id}get bloqueada(){if(!this.votacion)return!0;let t=this.now,n=new Date(this.votacion.fecha_inicio).getTime(),a=new Date(this.votacion.fecha_fin).getTime();return t<n||t>a}etiquetaTiempo(){if(!this.votacion)return"";let t=this.now,n=new Date(this.votacion.fecha_inicio).getTime(),a=new Date(this.votacion.fecha_fin).getTime();return t<n?`Inicia en: ${this.formatMs(n-t)}`:t>a?"Finalizada":`Termina en: ${this.formatMs(a-t)}`}formatMs(t){if(t<=0)return"0s";let n=Math.floor(t/1e3),a=Math.floor(n/86400);n%=86400;let g=Math.floor(n/3600);n%=3600;let O=Math.floor(n/60);return n%=60,a?`${a}d ${g}h ${O}m`:g?`${g}h ${O}m ${n}s`:`${O}m ${n}s`}votar(t){return b(this,null,function*(){if(!this.votacion)return;if(this.miOpcionId){yield this.mostrarToast("Ya emitiste tu voto en esta votaci\xF3n","danger");return}if(this.bloqueada){yield this.mostrarToast("La votaci\xF3n no est\xE1 activa","warning");return}let n=this.opciones.findIndex(g=>g.id===t.id),a=n>=0?this.opciones[n].total_votos??0:0;n>=0&&(this.opciones[n]=P(u({},this.opciones[n]),{total_votos:a+1}));try{yield this.votosSvc.votar(this.votacion.id,t.id),this.miOpcionId=t.id,this.selectedOp?.id===t.id&&(this.selectedOp=u({},this.opciones[n])),yield this.mostrarToast("Voto registrado correctamente \u2705","success"),this.detailOpen&&this.closeDetail()}catch(g){n>=0&&(this.opciones[n]=P(u({},this.opciones[n]),{total_votos:a})),console.error("Error al votar:",g),yield this.mostrarToast(g?.message??"No se pudo registrar tu voto","danger")}})}openDetail(t){this.selectedOp=t,this.detailOpen=!0}closeDetail(){this.detailOpen=!1,this.selectedOp=void 0}mostrarToast(t,n){return b(this,null,function*(){yield(yield this.toastCtrl.create({message:t,duration:3e3,position:"top",color:n})).present()})}};s.\u0275fac=function(n){return new(n||s)(M(F),M(lt),M(ct))},s.\u0275cmp=T({type:s,selectors:[["app-votacion"]],decls:14,vars:7,consts:[[1,"rb-header"],["slot","start"],["menu","mainMenu","autoHide","false"],[1,"ion-padding","votacion",3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["pullingText","Desliza para refrescar","refreshingSpinner","crescent","refreshingText","Actualizando..."],["color","danger","class","err",4,"ngIf"],["class","ion-text-center",4,"ngIf"],[4,"ngIf"],["cssClass","op-dialog",3,"didDismiss","isOpen","backdropDismiss","showBackdrop"],["color","danger",1,"err"],[1,"ion-text-center"],["name","crescent"],[1,"card"],[1,"status"],[3,"color","outline"],["name","time-outline"],["color","tertiary","class","total",4,"ngIf"],["lines","none",1,"opciones"],["class","opcion",3,"seleccionada","--pct",4,"ngFor","ngForOf","ngForTrackBy"],["color","success",4,"ngIf"],["color","tertiary",1,"total"],[1,"opcion"],[1,"label"],[1,"top"],[1,"titulo"],[1,"pct-badge"],["class","desc","style","margin:4px 0 8px 0;",4,"ngIf"],[1,"bar"],[1,"fill"],["class","img-box","type","button","aria-label","Ver detalle de la opci\xF3n",3,"click",4,"ngIf"],[1,"meta"],["slot","end",3,"click","disabled"],[1,"desc",2,"margin","4px 0 8px 0"],["type","button","aria-label","Ver detalle de la opci\xF3n",1,"img-box",3,"click"],["alt","Imagen opci\xF3n",3,"src"],["color","success"],[1,"dialog-overlay",3,"click"],[1,"dialog-card",3,"click"],["class","detail-img",4,"ngIf"],[1,"detail-stats"],["color","primary"],["color","medium"],[1,"bar","big"],["expand","block",3,"click","disabled"],[1,"detail-img"]],template:function(n,a){n&1&&(c(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),f(3,"ion-menu-button",2),r(),c(4,"ion-title"),d(5,"Votaci\xF3n"),r()()(),c(6,"ion-content",3)(7,"ion-refresher",4),h("ionRefresh",function(O){return a.handleRefresh(O)}),f(8,"ion-refresher-content",5),r(),m(9,dt,2,1,"ion-text",6)(10,pt,2,0,"div",7)(11,bt,16,9,"ng-container",8),c(12,"ion-modal",9),h("didDismiss",function(){return a.closeDetail()}),m(13,Ot,1,1,"ng-template"),r()()),n&2&&(o(6),l("fullscreen",!0),o(3),l("ngIf",a.errorMsg),o(),l("ngIf",a.cargando),o(),l("ngIf",!a.cargando&&a.votacion),o(),l("isOpen",a.detailOpen)("backdropDismiss",!0)("showBackdrop",!0))},dependencies:[$,E,D,B,st,q,z,R,j,N,A,H,L,U,W,Y,G,J,K,Q,X,Z,tt,nt,et,it,ot,at,rt],styles:['@charset "UTF-8";[_nghost-%COMP%]{color-scheme:light;--rb-primary: #2563eb;--rb-primary-10: rgba(37, 99, 235, .1);--rb-primary-20: rgba(37, 99, 235, .2);--rb-bg: #f8fafc;--rb-text: #0f172a;--ion-background-color: var(--rb-bg);--ion-text-color: var(--rb-text)}.rb-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--rb-primary), #60a5fa);--color: #fff;--border-color: transparent}ion-card[_ngcontent-%COMP%]{background:#fff;border-radius:18px;border:1px solid rgba(2,6,23,.06);box-shadow:0 10px 26px #02061714;overflow:hidden}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid rgba(2,6,23,.06)}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-weight:800;color:var(--rb-text)}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#64748b;font-weight:500}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding-top:12px}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{margin-bottom:8px;--color: var(--rb-text);--background: var(--rb-primary-10);--border-color: var(--rb-primary-20)}ion-list[_ngcontent-%COMP%]{background:transparent}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{position:relative;overflow:hidden;margin:10px 6px;border-radius:14px;background:#fff;--background: #fff;border:1px solid rgba(2,6,23,.06);box-shadow:0 6px 14px #0206170f}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;width:var(--pct, 0%);background:var(--bar-color, rgba(37, 99, 235, .14));transition:width .35s ease;z-index:0}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{position:relative;z-index:1}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:2px 0 4px;font-weight:800;color:var(--rb-text)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#64748b;font-weight:600}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 10px 18px var(--rb-primary-10);--padding-start: 14px;--padding-end: 14px}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:nth-child(6n+1){--bar-color: rgba(37, 99, 235, .18)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:nth-child(6n+2){--bar-color: rgba(34, 197, 94, .18)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:nth-child(6n+3){--bar-color: rgba(234, 179, 8, .2)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:nth-child(6n+4){--bar-color: rgba(168, 85, 247, .18)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:nth-child(6n+5){--bar-color: rgba(20, 184, 166, .18)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:nth-child(6n+6){--bar-color: rgba(244, 63, 94, .18)}ion-note[_ngcontent-%COMP%]{display:inline-block;margin-top:8px;font-weight:700}.ios[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 12px;--inner-padding-end: 12px}',".img-box[_ngcontent-%COMP%]{margin-top:.5rem;width:100%;aspect-ratio:16/9;border-radius:8px;overflow:hidden;padding:0;border:none;background:#f3f4f6}.img-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}.bar[_ngcontent-%COMP%]{margin:8px 0 6px;height:8px;border-radius:6px;background:#e5e7eb;overflow:hidden}.bar[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{height:100%;background:var(--ion-color-primary);width:var(--pct);transition:width .25s ease}.bar.big[_ngcontent-%COMP%]{height:12px;border-radius:10px}.detail-stats[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center;margin-bottom:.5rem}.op-dialog[_ngcontent-%COMP%]{--backdrop-opacity: 0;--background: transparent;--box-shadow: none;--ion-background-color: transparent}ion-modal.op-dialog[_ngcontent-%COMP%]::part(backdrop){background:transparent!important;pointer-events:auto!important}.op-dialog[_ngcontent-%COMP%]   .modal-shadow[_ngcontent-%COMP%]{display:none!important}.op-dialog[_ngcontent-%COMP%]   .ion-overlay-wrapper[_ngcontent-%COMP%]{background:transparent!important}.op-dialog[_ngcontent-%COMP%]   .modal-wrapper[_ngcontent-%COMP%]{position:fixed!important;inset:0!important;background:transparent!important;display:grid!important;place-items:center!important;padding:16px!important;box-shadow:none!important}.op-dialog[_ngcontent-%COMP%]   .modal-wrapper[_ngcontent-%COMP%]   .ion-page[_ngcontent-%COMP%]{background:transparent!important;color-scheme:light}.op-dialog[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]{--background: transparent !important}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;display:grid;place-items:center;background:transparent;z-index:1}.dialog-card[_ngcontent-%COMP%]{width:min(560px,92vw);max-height:85vh;border-radius:16px;overflow:hidden auto;background:var(--ion-background-color, #fff);box-shadow:0 10px 30px #0000001f;pointer-events:auto}.dialog-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%], .dialog-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{background:#fff!important}.detail-img[_ngcontent-%COMP%]{width:100%;aspect-ratio:16/9;overflow:hidden;background:#000}.detail-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}ion-modal.op-dialog[_ngcontent-%COMP%]::part(content), .op-dialog[_ngcontent-%COMP%]   .ion-overlay-wrapper[_ngcontent-%COMP%], .op-dialog[_ngcontent-%COMP%]   .modal-wrapper[_ngcontent-%COMP%], .op-dialog[_ngcontent-%COMP%]   .modal-wrapper[_ngcontent-%COMP%] > .ion-page[_ngcontent-%COMP%], .op-dialog[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]{border-radius:16px!important;overflow:hidden!important;background:transparent!important}.dialog-card[_ngcontent-%COMP%], ion-modal.op-dialog[_ngcontent-%COMP%]::part(content){-webkit-mask-image:-webkit-radial-gradient(white,black)}.op-dialog[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]{overscroll-behavior:contain}"]});let i=s;return i})();export{St as VotacionPage};
