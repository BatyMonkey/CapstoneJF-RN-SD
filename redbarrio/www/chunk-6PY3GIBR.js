import{a as ie}from"./chunk-CL4KBMSP.js";import"./chunk-TX5AFJTF.js";import{a as _}from"./chunk-66QFWZLQ.js";import{A as s,C as f,Fa as U,Ga as D,Ha as R,Ia as j,Ja as q,K as x,Ka as B,L as y,M as I,Ma as V,N as E,Na as Y,O as S,P as A,Q as k,Qa as $,R as N,Ra as G,S as T,_ as z,_a as K,ba as H,db as W,f as b,g as C,h as v,i as l,ib as J,j as g,k as w,lb as L,m,mb as Q,o as p,p as n,q as a,r as h,rb as X,ta as F,tb as Z,u as P,v as M,vb as ee,w as u,wb as te,x as O}from"./chunk-H7HGEQUX.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as d}from"./chunk-VI73JOY6.js";function ae(e,r){e&1&&(n(0,"div",9),h(1,"ion-spinner",10),n(2,"p"),s(3,"Cargando noticias..."),a()())}function oe(e,r){if(e&1&&(n(0,"div",18),h(1,"img",19),a()),e&2){let o=u().$implicit;l(),p("src",o.url_foto==null?null:o.url_foto[0],v)}}function re(e,r){if(e&1&&(n(0,"span"),s(1),x(2,"date"),a()),e&2){let o=u().$implicit;l(),f(" | ",y(2,1,o.fecha_creacion,"shortDate")," ")}}function ce(e,r){if(e&1&&(n(0,"p",20),s(1),x(2,"slice"),a()),e&2){let o=r.ngIf;l(),f(" ",I(2,1,o,0,100),"\u2026 ")}}function se(e,r){e&1&&(n(0,"p",21),s(1,"[Sin resumen]"),a())}function le(e,r){if(e&1){let o=P();n(0,"ion-col",12)(1,"ion-card",13),M("click",function(){let i=b(o).$implicit,c=u(2);return C(c.verDetalle(i.id))}),m(2,oe,2,1,"div",14),n(3,"ion-card-header")(4,"ion-card-title",15),s(5),a(),n(6,"div",16)(7,"ion-card-subtitle"),s(8),m(9,re,3,4,"span",7),a()()(),n(10,"ion-card-content"),m(11,ce,3,5,"p",17)(12,se,2,0,"ng-template",null,0,E),a()()()}if(e&2){let o=r.$implicit,t=O(13);l(2),p("ngIf",o.url_foto==null?null:o.url_foto.length),l(3),f(" ",o.titulo," "),l(3),f(" ",o.nombre_autor||"An\xF3nimo"," "),l(),p("ngIf",o.fecha_creacion),l(2),p("ngIf",o.parrafos==null?null:o.parrafos[0])("ngIfElse",t)}}function de(e,r){if(e&1&&(n(0,"ion-grid")(1,"ion-row"),m(2,le,14,6,"ion-col",11),a()()),e&2){let o=u();l(2),p("ngForOf",o.noticias)}}function pe(e,r){e&1&&(n(0,"div",22)(1,"h2"),s(2,"No hay noticias disponibles"),a(),n(3,"p"),s(4,"S\xE9 el primero en crear una noticia usando el bot\xF3n flotante."),a()())}var Pe=(()=>{let r=class r{constructor(t,i,c,ne){this.router=t,this.menu=i,this.auth=c,this.alertController=ne,this.noticias=[],this.estaCargando=!1,this.esAdmin=!1,this.usuarioActual=null,this.nombreAutorActual=null,this.supabase=te(_.supabaseUrl,_.supabaseAnonKey)}ngOnInit(){this.cargarEstadoYNoticias()}go(t){return d(this,null,function*(){yield this.router.navigate(["/",t]),yield this.menu.close("main-menu")})}goVotacion(){return d(this,null,function*(){yield this.router.navigate(["/votacion","VOTACION-DEMOSTRACION"]),yield this.menu.close("main-menu")})}salir(){return d(this,null,function*(){try{yield this.auth.signOut()}finally{yield this.menu.close("main-menu"),yield this.router.navigateByUrl("/login",{replaceUrl:!0})}})}cargarEstadoYNoticias(){return d(this,null,function*(){yield this.cargarEstadoUsuario(),yield this.cargarNoticias()})}cargarEstadoUsuario(){return d(this,null,function*(){try{let{data:{user:t}}=yield this.supabase.auth.getUser();if(this.usuarioActual=t,this.esAdmin=!1,this.nombreAutorActual=null,t){let{data:i,error:c}=yield this.supabase.from("usuario").select("rol, nombre").eq("user_id",t.id).single();if(c&&c.code!=="PGRST116")throw c;this.esAdmin=i?.rol==="administrador",this.nombreAutorActual=i?.nombre||"Administrador/a"}}catch(t){console.error("Error al cargar estado de usuario:",t),this.esAdmin=!1,this.nombreAutorActual=null}})}cargarNoticias(){return d(this,null,function*(){this.estaCargando=!0;try{let{data:t,error:i}=yield this.supabase.from("noticias").select("id, titulo, url_foto, nombre_autor, fecha_creacion, parrafos").order("fecha_creacion",{ascending:!1});if(i)throw i;this.noticias=t}catch(t){console.error("Error al cargar noticias:",t)}finally{this.estaCargando=!1}})}confirmarYEliminarNoticia(t){return d(this,null,function*(){yield(yield this.alertController.create({header:"Confirmar Eliminaci\xF3n",message:"\xBFEst\xE1s seguro de que quieres eliminar esta noticia? Esta acci\xF3n no se puede deshacer.",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary"},{text:"Eliminar",handler:()=>{this.eliminarNoticia(t)}}]})).present()})}eliminarNoticia(t){return d(this,null,function*(){this.estaCargando=!0;try{let{error:i}=yield this.supabase.from("noticias").delete().eq("id",t);if(i)throw i;yield this.cargarNoticias()}catch(i){console.error("Error al intentar eliminar noticia:",i)}finally{this.estaCargando=!1}})}verDetalle(t){this.router.navigate(["/noticias",t])}navegarACrearNoticia(){this.router.navigate(["noticias/crear"])}ionViewWillEnter(){this.cargarEstadoYNoticias()}};r.\u0275fac=function(i){return new(i||r)(g(z),g(Z),g(ie),g(X))},r.\u0275cmp=w({type:r,selectors:[["app-home"]],decls:20,vars:3,consts:[["sinResumen",""],[1,"rb-header"],["slot","start"],["menu","mainMenu","autoHide","false"],[1,"ion-padding","news"],[1,"hero"],["class","loading",4,"ngIf"],[4,"ngIf"],["class","empty",4,"ngIf"],[1,"loading"],["name","crescent"],["size","12","size-md","6","size-lg","4",4,"ngFor","ngForOf"],["size","12","size-md","6","size-lg","4"],[3,"click"],["class","card-image-container",4,"ngIf"],[1,"card-title","ion-text-wrap"],[2,"display","flex","justify-content","space-between","align-items","center"],["class","card-excerpt",4,"ngIf","ngIfElse"],[1,"card-image-container"],["alt","Miniatura",1,"card-image",3,"src"],[1,"card-excerpt"],[1,"card-excerpt-placeholder"],[1,"empty"]],template:function(i,c){i&1&&(n(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),h(3,"ion-menu-button",3),a(),n(4,"ion-title"),s(5,"Inicio y Noticias"),a()()(),n(6,"ion-content",4)(7,"div",5)(8,"h1"),s(9,"\xA1Bienvenido/a!"),a(),n(10,"p"),s(11,"Usa el men\xFA (arriba a la izquierda) para navegar por la app."),a()(),n(12,"div")(13,"h2"),s(14,"Noticias"),a(),n(15,"p"),s(16,"Aqu\xED puedes ver las noticias m\xE1s recientes de tu comunidad."),a()(),m(17,ae,4,0,"div",6)(18,de,3,1,"ion-grid",7)(19,pe,5,0,"div",8),a()),i&2&&(l(17),p("ngIf",c.estaCargando),l(),p("ngIf",!c.estaCargando&&(c.noticias==null?null:c.noticias.length)),l(),p("ngIf",!c.estaCargando&&(!c.noticias||!c.noticias.length)))},dependencies:[ee,U,D,R,j,q,B,V,Y,$,G,K,W,J,L,Q,T,S,A,H,F,N,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{--rb-primary: #2563eb;--rb-primary-10: rgba(37, 99, 235, .1);--rb-text: #0f172a;--rb-muted: #64748b;--rb-sep: rgba(2, 6, 23, .06);--rb-bg: #f8fafc;color-scheme:light;--ion-background-color: var(--rb-bg);--ion-text-color: var(--rb-text)}.rb-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--rb-primary), #60a5fa);--color: #fff;--border-color: transparent;--min-height: 56px}.home[_ngcontent-%COMP%]{--background: var(--rb-bg)}.hero[_ngcontent-%COMP%]{text-align:center;background:#fff;border-radius:18px;padding:28px 22px;width:min(620px,100%);box-shadow:0 10px 30px #0206171a,inset 0 1px #fff9;border:1px solid rgba(2,6,23,.06);margin:0 auto}.hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 8px;font-size:24px;font-weight:700;color:var(--rb-text)}.hero[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#475569}.ios[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 12px;--inner-padding-end: 12px}.news[_ngcontent-%COMP%]{--background: #fff;padding-bottom:8px}.news[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{--ion-grid-padding: 6px}.news[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:10px}ion-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;border:1px solid var(--rb-sep);box-shadow:0 6px 16px #0206171f,0 18px 30px #0206171f;overflow:hidden;transition:transform .08s ease,box-shadow .12s ease,border-color .12s ease}ion-card[_ngcontent-%COMP%]:active{transform:scale(.996);box-shadow:0 8px 18px #02061729,0 18px 36px #02061733;border-color:#2563eb2e}.card-image-container[_ngcontent-%COMP%]{width:100%;height:200px;overflow:hidden;background:#f1f5f9;border-bottom:1px solid var(--rb-sep)}@media (min-width: 768px){.card-image-container[_ngcontent-%COMP%]{height:230px}}.card-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}ion-card-header[_ngcontent-%COMP%]{background:#fff;padding:12px 14px 8px;border-bottom:1px solid var(--rb-sep)}.card-title[_ngcontent-%COMP%]{margin:0 0 2px;color:var(--rb-text);font-weight:800;font-size:17px;line-height:1.25;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}ion-card-subtitle[_ngcontent-%COMP%]{color:var(--rb-muted);font-weight:600;letter-spacing:.2px;font-size:12.5px}ion-card-content[_ngcontent-%COMP%]{padding:10px 14px 14px}.card-excerpt[_ngcontent-%COMP%]{color:#334155;font-weight:500;font-size:14.5px;line-height:1.4;margin:2px 0 0;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}.card-excerpt-placeholder[_ngcontent-%COMP%]{color:#94a3b8;font-style:italic;margin:2px 0 0}.loading[_ngcontent-%COMP%], .empty[_ngcontent-%COMP%]{text-align:center;color:#475569;padding:20px 12px}.loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:8px}@media (prefers-reduced-motion: reduce){ion-card[_ngcontent-%COMP%]{transition:none}}.fixed-action-button[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:16px;z-index:100;height:48px;width:auto;min-width:140px;--background: var(--rb-primary);--color: white;--border-radius: 12px;--box-shadow: 0 10px 20px rgba(37, 99, 235, .35);font-weight:700;letter-spacing:.5px;transition:transform .2s ease}.fixed-action-button[_ngcontent-%COMP%]:active{transform:scale(.98)}.fixed-action-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.3em;margin-inline-start:8px}@media (max-width: 480px){.fixed-action-button[_ngcontent-%COMP%]{bottom:12px;right:12px;min-width:120px;height:44px;font-size:.9em}}']});let e=r;return e})();export{Pe as HomePage};
