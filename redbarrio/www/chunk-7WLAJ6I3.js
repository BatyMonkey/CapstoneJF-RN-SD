import{a as ge}from"./chunk-CL4KBMSP.js";import{a as w}from"./chunk-TX5AFJTF.js";import"./chunk-66QFWZLQ.js";import{A as l,C as f,Da as $,E as T,F,Fa as q,G as D,Ga as G,H as A,Ha as K,Ia as Q,Ja as X,K as x,Ka as Z,L as M,M as N,Na as ee,O as j,P as B,Q as z,R as H,Ra as te,S as V,Ta as ie,Wa as ne,_ as R,_a as oe,da as U,eb as re,f as I,fb as ae,g as O,i as a,ia as W,ib as ce,j as h,k as S,lb as se,m as _,mb as le,o as d,p as n,q as c,r as v,rb as de,s as E,sb as me,t as k,ta as J,u as L,v as P,vb as pe,w as b,ya as Y}from"./chunk-H7HGEQUX.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{a as y,b as C,j as g}from"./chunk-VI73JOY6.js";function ue(o,s){o&1&&(n(0,"div",11),v(1,"ion-spinner",12),n(2,"p"),l(3,"Cargando elementos..."),c()())}function he(o,s){if(o&1&&(n(0,"div",21),v(1,"ion-img",22),c()),o&2){let r=b().$implicit;a(),d("src",r.imagen_url)}}function _e(o,s){if(o&1){let r=L();n(0,"ion-card",14),P("click",function(){let e=I(r).$implicit,t=b(2);return O(t.verDetalle(e))}),n(1,"ion-card-header")(2,"ion-card-title"),l(3),n(4,"ion-badge",15),l(5),c()(),n(6,"ion-card-subtitle"),l(7),x(8,"date"),c()(),n(9,"ion-card-content")(10,"div",16)(11,"div",17)(12,"p",18),l(13),x(14,"slice"),c(),n(15,"small",19),l(16),x(17,"date"),c()(),_(18,he,2,1,"div",20),c()()()}if(o&2){let r=s.$implicit;a(3),f(" ",r.titulo," "),a(),d("color",A(r.tipo==="actividad"?"success":"primary")),a(),f(" ",r.tipo==="actividad"?"Actividad":"Proyecto"," "),a(2),f(" ",M(8,8,r.fecha,"dd/MM/yyyy HH:mm")," "),a(6),f(" ",r.descripcion.length>100?N(14,11,r.descripcion,0,100)+"...":r.descripcion," "),a(3),f(" ",M(17,15,r.fecha,"dd/MM/yyyy HH:mm")," "),a(2),d("ngIf",r.imagen_url)}}function ve(o,s){if(o&1&&(E(0),_(1,_e,19,18,"ion-card",13),k()),o&2){let r=b();a(),d("ngForOf",r.elementosFiltrados)}}function be(o,s){o&1&&(n(0,"div",11)(1,"p"),l(2,"No hay elementos disponibles para mostrar."),c()())}var ke=(()=>{let s=class s{constructor(i,e,t,p){this.auth=i,this.router=e,this.loadingCtrl=t,this.alertCtrl=p,this.perfil=null,this.elementos=[],this.elementosFiltrados=[],this.isLoading=!0,this.filtro="todos"}ngOnInit(){return g(this,null,function*(){yield this.validarSesion(),yield this.cargarListado()})}validarSesion(){return g(this,null,function*(){try{let i=yield this.auth.waitForActiveSession(),e=yield this.auth.miPerfil();if(!e){let t=localStorage.getItem("rb_usuario_activo");t&&(e=JSON.parse(t))}if(!e){console.warn("\u26A0\uFE0F No hay sesi\xF3n v\xE1lida, usando modo local temporal.");return}this.perfil=e,console.log("\u2705 Sesi\xF3n activa o restaurada:",e)}catch(i){console.error("Error validando sesi\xF3n:",i)}})}cargarListado(){return g(this,null,function*(){this.isLoading=!0;let i=yield this.loadingCtrl.create({message:"Cargando proyectos...",spinner:"crescent"});yield i.present();try{let[e,t]=yield Promise.all([w.from("proyecto").select("*"),w.from("actividad").select("*")]);if(e.error)throw e.error;if(t.error)throw t.error;let p=(e.data||[]).map(m=>C(y({},m),{tipo:"proyecto",fecha:m.fecha||m.creado_en||new Date().toISOString()})),u=(t.data||[]).map(m=>C(y({},m),{tipo:"actividad",fecha:m.fecha||m.creado_en||new Date().toISOString()}));this.elementos=[...p,...u].sort((m,fe)=>new Date(fe.fecha).getTime()-new Date(m.fecha).getTime()),this.filtrarListado(),console.log("\u2705 Listado cargado:",this.elementos)}catch(e){console.error("Error al cargar listado:",e),yield this.mostrarAlerta("Error","No se pudo cargar el listado.")}finally{this.isLoading=!1,i.dismiss()}})}filtrarListado(){switch(this.filtro){case"proyectos":this.elementosFiltrados=this.elementos.filter(i=>i.tipo==="proyecto");break;case"actividades":this.elementosFiltrados=this.elementos.filter(i=>i.tipo==="actividad");break;default:this.elementosFiltrados=this.elementos}}verDetalle(i){return g(this,null,function*(){try{let e=yield this.auth.miUID();if(!e){let t=localStorage.getItem("rb_usuario_activo");if(t){let p=JSON.parse(t);this.auth.setUsuarioForzado(p),e=p.id_auth}}if(!e){console.warn("\u26A0\uFE0F No se detect\xF3 sesi\xF3n, redirigiendo al login"),this.router.navigate(["/auth/login"]);return}i.id_proyecto?this.router.navigate(["/inscripcion/inscripcion-proyecto",i.id_proyecto]):i.id_actividad?this.router.navigate(["/inscripcion/inscripcion-proyecto",i.id_actividad]):console.error("\u274C Elemento sin ID de proyecto o actividad")}catch(e){console.error("Error al abrir inscripci\xF3n:",e),this.router.navigate(["/auth/login"])}})}mostrarAlerta(i,e){return g(this,null,function*(){yield(yield this.alertCtrl.create({header:i,message:e,buttons:["Aceptar"]})).present()})}};s.\u0275fac=function(e){return new(e||s)(h(ge),h(R),h(me),h(de))},s.\u0275cmp=S({type:s,selectors:[["app-proyectos"]],decls:21,vars:6,consts:[[1,"rb-header",3,"translucent"],["slot","start"],["menu","mainMenu","autoHide","false"],[3,"fullscreen"],[1,"page-wrap","ion-padding"],["value","todos",3,"ngModelChange","ionChange","ngModel"],["value","todos"],["value","proyectos"],["value","actividades"],["class","ion-text-center ion-padding",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center","ion-padding"],["name","crescent","color","primary"],["class","card","button","true","detail","false",3,"click",4,"ngFor","ngForOf"],["button","true","detail","false",1,"card",3,"click"],["slot","end",2,"margin-left","6px",3,"color"],[1,"card-content"],[1,"text-section"],[1,"ion-text-justify"],[1,"fecha"],["class","image-section",4,"ngIf"],[1,"image-section"],["alt","imagen",1,"thumbnail-img",3,"src"]],template:function(e,t){e&1&&(n(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),v(3,"ion-menu-button",2),c(),n(4,"ion-title"),l(5,"Proyectos y Actividades"),c()()(),n(6,"ion-content",3)(7,"div",4)(8,"ion-segment",5),D("ngModelChange",function(u){return F(t.filtro,u)||(t.filtro=u),u}),P("ionChange",function(){return t.filtrarListado()}),n(9,"ion-segment-button",6)(10,"ion-label"),l(11,"Todos"),c()(),n(12,"ion-segment-button",7)(13,"ion-label"),l(14,"Proyectos"),c()(),n(15,"ion-segment-button",8)(16,"ion-label"),l(17,"Actividades"),c()()(),_(18,ue,4,0,"div",9)(19,ve,2,1,"ng-container",10)(20,be,3,0,"div",9),c()()),e&2&&(d("translucent",!0),a(6),d("fullscreen",!0),a(2),T("ngModel",t.filtro),a(10),d("ngIf",t.isLoading),a(),d("ngIf",!t.isLoading&&(t.elementos==null?null:t.elementos.length)),a(),d("ngIf",!t.isLoading&&!(t.elementos!=null&&t.elementos.length)))},dependencies:[V,j,B,pe,$,q,G,K,Q,X,Z,ee,te,ie,ne,oe,re,ae,ce,se,le,Y,J,U,W,H,z],styles:['@charset "UTF-8";[_nghost-%COMP%], html[_nghost-%COMP%], html   [_nghost-%COMP%]{color-scheme:light!important;--rb-primary: #2563eb;--rb-bg: #f5f7fb;--rb-text: #0f172a;--rb-muted: #475569;--ion-text-color: var(--rb-text);--ion-background-color: var(--rb-bg);--ion-item-background: #ffffff;--ion-card-background: #ffffff}.rb-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--rb-primary), #60a5fa);--color: #fff;--border-color: transparent}ion-title[_ngcontent-%COMP%]{font-weight:700}.page-wrap[_ngcontent-%COMP%]{max-width:960px;margin:0 auto;padding-top:1px}ion-card.card[_ngcontent-%COMP%]{background:#fff;border-radius:18px;border:1px solid rgba(2,6,23,.08);box-shadow:0 12px 28px #0206171a;overflow:hidden;margin-bottom:16px;transition:transform .2s ease-in-out,box-shadow .2s ease-in-out}ion-card.card[_ngcontent-%COMP%]:hover{box-shadow:0 14px 30px #02061726}ion-card.card[_ngcontent-%COMP%]:active{transform:translateY(1px);box-shadow:0 8px 24px #02061714}ion-card.card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid rgba(2,6,23,.06);padding-bottom:8px}ion-card.card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{color:var(--rb-text);font-weight:800;font-size:1.3rem}ion-card.card[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#64748b;font-weight:600;margin-top:4px;font-size:.9rem}ion-card-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0;color:var(--rb-text);line-height:1.4;font-size:.95rem;text-align:justify}ion-card-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--rb-muted);font-weight:600}ion-spinner[_ngcontent-%COMP%]{margin-bottom:6px}.ion-text-center[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--rb-muted);font-size:.95rem}@media (prefers-color-scheme: dark){[_nghost-%COMP%]{--ion-background-color: var(--rb-bg);--ion-card-background: #ffffff;--ion-item-background: #ffffff;--ion-text-color: var(--rb-text)}}.card-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px}.text-section[_ngcontent-%COMP%]{flex:1;min-width:0}.text-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:1.4;color:var(--ion-color-dark)}.text-section[_ngcontent-%COMP%]   .fecha[_ngcontent-%COMP%]{display:block;margin-top:4px;font-size:12px;color:var(--ion-color-medium)}.image-section[_ngcontent-%COMP%]{flex-shrink:0}.thumbnail-img[_ngcontent-%COMP%]{width:80px;height:80px;object-fit:cover;border-radius:8px;box-shadow:0 2px 6px #00000026}']});let o=s;return o})();export{ke as ProyectosPage};
