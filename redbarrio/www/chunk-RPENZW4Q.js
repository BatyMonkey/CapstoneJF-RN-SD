import{$ as D,$a as pe,A as v,B as E,F as w,Fa as Z,Ia as ee,Ja as te,Ka as ie,L as N,La as re,M as k,Ma as ne,Na as oe,Oa as ae,P as T,Qa as le,V as G,Y as V,Ya as se,Z as h,Za as ce,_ as R,_a as me,ab as de,ba as q,da as U,e as _,ea as z,f as x,fa as L,ga as X,h as n,ha as $,hb as ue,i as P,ia as B,ib as ge,j as M,ja as H,jb as S,l as d,la as j,m as c,ma as K,n as o,o as l,oa as Y,p as u,s as y,t as f,ta as J,u as g,v as F,wa as Q,xa as W,y as p,z as O}from"./chunk-C6RY7PX2.js";import"./chunk-G4GOZ2R2.js";import"./chunk-3EH7DRQW.js";import"./chunk-QUJFQN2Y.js";import"./chunk-E24K4UEG.js";import"./chunk-LEIZBYT7.js";import"./chunk-UM2WNVGK.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-TVBC6MYV.js";import"./chunk-26CMJVF7.js";import"./chunk-QQBOPM2N.js";import"./chunk-IACAUHTZ.js";import"./chunk-6KZXCEZL.js";import"./chunk-C7E54FQN.js";import"./chunk-ATYZ3M5D.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-Z455EQLB.js";import"./chunk-CKP3SGE2.js";import"./chunk-CIXXGG5D.js";import{j as b}from"./chunk-VI73JOY6.js";function _e(i,m){i&1&&(o(0,"p"),p(1,"El t\xEDtulo es obligatorio."),l())}function xe(i,m){if(i&1&&(o(0,"div")(1,"ion-text",16),d(2,_e,2,0,"p",9),l()()),i&2){let s,t=g();n(2),c("ngIf",(s=t.noticiaForm.get("titulo"))==null||s.errors==null?null:s.errors.required)}}function ve(i,m){i&1&&(o(0,"p"),p(1,"El primer p\xE1rrafo es obligatorio."),l())}function Ce(i,m){if(i&1&&(o(0,"div")(1,"ion-text",16),d(2,ve,2,0,"p",9),l()()),i&2){let s=g().$implicit;n(2),c("ngIf",s.errors==null?null:s.errors.required)}}function Pe(i,m){if(i&1){let s=y();o(0,"div")(1,"ion-item",19),u(2,"ion-textarea",20),o(3,"ion-buttons",21)(4,"ion-button",22),f("click",function(){let r=_(s).index,e=g();return x(e.quitarParrafo(r))}),u(5,"ion-icon",23),l()()(),d(6,Ce,3,1,"div",9),l()}if(i&2){let s=m.$implicit,t=m.index,r=g();n(),c("formGroupName",t),n(),c("label",w("P\xE1rrafo ",t+1))("formControl",s)("autoGrow",!0),n(2),c("disabled",r.parrafosFormArray.length<=1),n(2),c("ngIf",s.invalid&&(s.dirty||s.touched))}}function ye(i,m){if(i&1){let s=y();o(0,"ion-item",24)(1,"ion-label",25),p(2),l(),o(3,"div",26)(4,"p",27),p(5),l(),o(6,"input",28,0),f("change",function(r){let e=_(s).index,a=g();return x(a.onFileSelected(r,e))}),l(),o(8,"ion-button",29),f("click",function(){_(s);let r=F(7);return x(r.click())}),p(9," Seleccionar archivo "),l()()()}if(i&2){let s=m.index,t=g();n(2),v(" ",s===0?"Imagen de Portada (Obligatoria)":"Imagen "+s+" (Opcional)"," "),n(3),v(" ",(t.archivosSeleccionados[s]==null?null:t.archivosSeleccionados[s].name)||"Sin archivos seleccionados"," "),n(),c("required",s===0)}}function Se(i,m){i&1&&(o(0,"p"),p(1," Debe seleccionar una Imagen de Portada. "),l())}function Ie(i,m){i&1&&(o(0,"span"),p(1,"Guardar Noticia"),l())}function Ae(i,m){i&1&&(o(0,"span"),p(1,"Subiendo Im\xE1genes..."),l())}function Me(i,m){i&1&&(o(0,"span"),p(1,"Guardando..."),l())}function Fe(i,m){i&1&&u(0,"ion-spinner",30)}var fe="noticias-bucket",be=6,C=5,Ue=(()=>{let m=class m{constructor(t,r){this.fb=t,this.router=r,this.estaGuardando=!1,this.usuarioAutenticado=null,this.nombreAutor=null,this.archivosSeleccionados=new Array(C).fill(null),this.estaSubiendoImagen=!1,this.MAX_PARRAFOS=be,this.MAX_IMAGENES=C,this.supabase=ge(S.supabaseUrl,S.supabaseAnonKey)}get parrafosFormArray(){return this.noticiaForm.get("parrafos")}get parrafoControls(){return this.parrafosFormArray.controls}ngOnInit(){return b(this,null,function*(){this.noticiaForm=this.fb.group({titulo:["",[h.required,h.maxLength(100)]],parrafos:this.fb.array([])}),this.agregarParrafo(!0),this.noticiaForm.reset(),yield this.inicializarUsuarioYAutor()})}crearParrafoControl(t=!1){let r=t?[h.required]:[];return new q(null,r)}agregarParrafo(t=!1){this.parrafosFormArray.length<be&&this.parrafosFormArray.push(this.crearParrafoControl(t))}quitarParrafo(t){this.parrafosFormArray.length>1&&(this.parrafosFormArray.removeAt(t),t===0&&this.parrafosFormArray.length>0&&(this.parrafosFormArray.at(0).setValidators([h.required]),this.parrafosFormArray.at(0).updateValueAndValidity()))}inicializarUsuarioYAutor(){return b(this,null,function*(){let{data:{user:t}}=yield this.supabase.auth.getUser();if(this.usuarioAutenticado=t,!t){this.router.navigate(["/login"]);return}try{let{data:r,error:e}=yield this.supabase.from("usuario").select("nombre").eq("user_id",t.id).single();if(e&&e.code!=="PGRST116")throw e;this.nombreAutor=r?.nombre||"Autor Desconocido"}catch{this.nombreAutor="Autor Desconocido"}})}onFileSelected(t,r){let e=t.target.files[0];e?this.archivosSeleccionados[r]=e:this.archivosSeleccionados[r]=null}subirImagenes(){return b(this,null,function*(){let t=this.usuarioAutenticado;if(!t)return null;this.estaSubiendoImagen=!0;let r=[];if(!this.archivosSeleccionados[0])return alert("La primera imagen es obligatoria."),this.estaSubiendoImagen=!1,null;try{for(let e=0;e<C;e++){let a=this.archivosSeleccionados[e];if(a){let I=`${t.id}/noticias/${Date.now()}_${e}_${a.name.replace(/ /g,"_")}`,{error:A}=yield this.supabase.storage.from(fe).upload(I,a);if(A)throw A;let{data:he}=this.supabase.storage.from(fe).getPublicUrl(I);r.push(he.publicUrl)}}return this.estaSubiendoImagen=!1,r}catch(e){return this.estaSubiendoImagen=!1,console.error("Error subiendo im\xE1genes:",e),alert("Error subiendo las im\xE1genes. Intenta de nuevo."),null}})}crearNoticia(){return b(this,null,function*(){if(this.noticiaForm.markAllAsTouched(),this.parrafosFormArray.invalid||this.noticiaForm.invalid||this.estaGuardando||this.estaSubiendoImagen||!this.usuarioAutenticado){alert("Por favor, completa el t\xEDtulo y el primer p\xE1rrafo antes de continuar.");return}this.estaGuardando=!0;let t=yield this.subirImagenes();if(t===null){this.estaGuardando=!1;return}let r=this.parrafosFormArray.controls.map(a=>a.value).filter(a=>a&&a.trim().length>0),e={titulo:this.noticiaForm.value.titulo,parrafos:r,url_foto:t,nombre_autor:this.nombreAutor,fecha_creacion:new Date().toISOString(),user_id:this.usuarioAutenticado.id};try{let{error:a}=yield this.supabase.from("noticias").insert(e);a?(console.error("Error al guardar noticia en Supabase:",a),alert("Hubo un error al crear la noticia. Detalle: "+a.message)):(alert("Noticia creada con \xE9xito!"),this.noticiaForm.reset(),this.parrafosFormArray.clear(),this.agregarParrafo(!0),this.archivosSeleccionados=new Array(C).fill(null),this.router.navigate(["/noticias"]))}catch(a){console.error("Error inesperado:",a),alert("Ocurri\xF3 un error inesperado.")}finally{this.estaGuardando=!1}})}};m.\u0275fac=function(r){return new(r||m)(P(K),P(G))},m.\u0275cmp=M({type:m,selectors:[["app-crear-noticia"]],decls:37,vars:17,consts:[["fileInput",""],[1,"rb-header"],["slot","start"],["menu","mainMenu","autoHide","false"],[1,"ion-padding",3,"fullscreen"],["color","medium"],[3,"ngSubmit","formGroup"],["lines","full",1,"ion-margin-bottom"],["label","T\xEDtulo","labelPlacement","stacked","formControlName","titulo","placeholder","M\xE1x 100 caracteres","required","",3,"maxlength"],[4,"ngIf"],["formArrayName","parrafos",1,"ion-margin-vertical"],[4,"ngFor","ngForOf"],["expand","block","fill","outline",1,"ion-margin-bottom",3,"click","disabled"],["name","add-circle-outline","slot","start"],[1,"ion-margin-vertical"],["lines","full",4,"ngFor","ngForOf"],["color","danger",1,"ion-padding-start"],["type","submit","expand","block",1,"ion-margin-top",3,"disabled"],["slot","end","name","dots",4,"ngIf"],["lines","full",1,"ion-margin-bottom",3,"formGroupName"],["labelPlacement","stacked","placeholder","Escribe el contenido aqu\xED...","rows","4",3,"label","formControl","autoGrow"],["slot","end"],["color","danger",3,"click","disabled"],["name","trash-outline"],["lines","full"],["slot","start",1,"ion-text-wrap"],["slot","end",1,"ion-text-end"],[1,"ion-no-margin","ion-text-wrap",2,"font-size","0.9em","color","var(--ion-color-medium)"],["type","file","accept","image/jpeg, image/png",2,"display","none",3,"change","required"],["size","small",3,"click"],["slot","end","name","dots"]],template:function(r,e){if(r&1&&(o(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),u(3,"ion-menu-button",3),l(),o(4,"ion-title"),p(5,"Crear Nueva Noticia"),l()()(),o(6,"ion-content",4)(7,"ion-text",5)(8,"p"),p(9,"Creando como: "),o(10,"strong"),p(11),l()()(),o(12,"form",6),f("ngSubmit",function(){return e.crearNoticia()}),o(13,"ion-item",7),u(14,"ion-input",8),l(),d(15,xe,3,1,"div",9),o(16,"ion-list",10)(17,"ion-list-header")(18,"ion-label"),p(19),l()(),d(20,Pe,7,7,"div",11),l(),o(21,"ion-button",12),f("click",function(){return e.agregarParrafo()}),u(22,"ion-icon",13),p(23),l(),u(24,"hr"),o(25,"ion-list",14)(26,"ion-list-header")(27,"ion-label"),p(28,"Im\xE1genes (La primera es la Portada)"),l()(),d(29,ye,10,3,"ion-item",15),o(30,"ion-text",16),d(31,Se,2,0,"p",9),l()(),o(32,"ion-button",17),d(33,Ie,2,0,"span",9)(34,Ae,2,0,"span",9)(35,Me,2,0,"span",9)(36,Fe,1,0,"ion-spinner",18),l()()()),r&2){let a;n(6),c("fullscreen",!0),n(5),O(e.nombreAutor||"Cargando..."),n(),c("formGroup",e.noticiaForm),n(2),c("maxlength",100),n(),c("ngIf",((a=e.noticiaForm.get("titulo"))==null?null:a.invalid)&&(((a=e.noticiaForm.get("titulo"))==null?null:a.dirty)||((a=e.noticiaForm.get("titulo"))==null?null:a.touched))),n(4),v("Contenido (P\xE1rrafos - M\xE1x ",e.MAX_PARRAFOS,")"),n(),c("ngForOf",e.parrafoControls),n(),c("disabled",e.parrafosFormArray.length>=e.MAX_PARRAFOS),n(2),E(" A\xF1adir P\xE1rrafo (",e.parrafosFormArray.length,"/",e.MAX_PARRAFOS,") "),n(6),c("ngForOf",e.archivosSeleccionados),n(2),c("ngIf",!e.archivosSeleccionados[0]&&e.noticiaForm.touched),n(),c("disabled",e.estaGuardando||e.estaSubiendoImagen||e.noticiaForm.invalid),n(),c("ngIf",!e.estaGuardando&&!e.estaSubiendoImagen),n(),c("ngIf",e.estaSubiendoImagen),n(),c("ngIf",e.estaGuardando&&!e.estaSubiendoImagen),n(),c("ngIf",e.estaGuardando||e.estaSubiendoImagen)}},dependencies:[T,N,k,ue,Q,W,Z,ee,te,ie,re,ne,oe,ae,le,se,ce,me,pe,de,J,V,Y,U,R,D,H,j,z,L,B,X,$],styles:['@charset "UTF-8";[_nghost-%COMP%]{--rb-primary: #2563eb;--rb-primary-10: rgba(37, 99, 235, .1);--rb-primary-20: rgba(37, 99, 235, .2);--rb-text: #0f172a;--rb-muted: #64748b;color-scheme:light;--ion-text-color: var(--rb-text);--ion-background-color: #f7fbff}ion-content[_ngcontent-%COMP%]{--background: linear-gradient(180deg, #f7fbff 0%, #e8f0ff 100%);color:var(--rb-text)}ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--rb-primary), #60a5fa);--color: #fff;--border-color: transparent;--min-height: 56px}form[_ngcontent-%COMP%]{max-width:860px;margin:16px auto}ion-text[color=medium][_ngcontent-%COMP%]{display:block;max-width:860px;margin:8px auto 0;color:var(--rb-muted)}ion-item[_ngcontent-%COMP%]{--background: #fff;background:#fff;border:1.5px solid #e2e8f0;border-radius:14px;box-shadow:0 8px 18px #0206170f;--padding-start: 12px;--inner-padding-end: 12px;--inner-padding-top: 12px;--inner-padding-bottom: 12px;--min-height: auto;margin-top:12px;transition:border-color .16s ease,box-shadow .16s ease;color:var(--rb-text)}ion-item.item-has-focus[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]:focus-within{border-color:var(--rb-primary);box-shadow:0 0 0 3px #2563eb24,0 8px 18px #0206170f}ion-input[_ngcontent-%COMP%]::part(label), ion-textarea[_ngcontent-%COMP%]::part(label), ion-input[label-placement=stacked][_ngcontent-%COMP%]::part(label), ion-textarea[label-placement=stacked][_ngcontent-%COMP%]::part(label){color:#1f2937!important;opacity:1!important;transform:none!important;margin:2px 4px 6px 2px;line-height:1.2;font-weight:700;z-index:1}ion-input[_ngcontent-%COMP%], ion-textarea[_ngcontent-%COMP%]{--color: var(--rb-text) !important;--placeholder-color: #475569 !important}ion-input[_ngcontent-%COMP%]::part(native), ion-textarea[_ngcontent-%COMP%]::part(native){color:var(--rb-text)!important;-webkit-text-fill-color:var(--rb-text)!important;background:#fff;line-height:1.25;font-weight:600;padding:8px 10px 10px;caret-color:var(--rb-primary)}ion-input[_ngcontent-%COMP%]::part(native)::placeholder, ion-textarea[_ngcontent-%COMP%]::part(native)::placeholder{color:#475569!important;opacity:1}ion-textarea[_ngcontent-%COMP%]{min-height:110px}ion-text[color=danger][_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;margin:6px 0 0}ion-list[_ngcontent-%COMP%]{background:transparent}ion-list-header[_ngcontent-%COMP%]{padding-inline-start:0;margin-top:12px;margin-bottom:6px}ion-list-header[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:700;color:var(--rb-text)}ion-button[_ngcontent-%COMP%]{--border-radius: 12px;--box-shadow: 0 8px 18px var(--rb-primary-10)}ion-button[fill=outline][_ngcontent-%COMP%]{--border-color: var(--rb-primary-20);--color: var(--rb-primary);--ripple-color: var(--rb-primary)}ion-item[_ngcontent-%COMP%]   ion-buttons[slot=end][_ngcontent-%COMP%]{margin-left:8px}hr[_ngcontent-%COMP%]{border:none;height:1px;background:linear-gradient(to right,transparent,rgba(2,6,23,.08),transparent);margin:16px 0}ion-item[_ngcontent-%COMP%]   .ion-text-end[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9em;color:#334155!important;font-weight:600}ion-button[type=submit][_ngcontent-%COMP%]{margin-top:12px;font-weight:700}ion-button[disabled][_ngcontent-%COMP%]{opacity:.7;filter:grayscale(6%)}@media (max-width: 480px){ion-item[_ngcontent-%COMP%]{box-shadow:0 6px 12px #0206170d}}']});let i=m;return i})();export{Ue as CrearNoticiaPage};
