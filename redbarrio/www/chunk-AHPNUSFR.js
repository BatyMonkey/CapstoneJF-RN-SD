import{a as cn}from"./chunk-KPKAVJKI.js";import{$a as tn,A as P,Aa as z,Ba as A,C as m,Ca as H,D as _,E as u,Fa as R,Ga as U,Ia as Y,Ja as q,Ka as J,L as S,La as K,M as k,Ma as Q,Na as X,P as F,Qa as Z,V as T,Ya as $,Za as nn,_ as E,_a as en,ab as on,ca as V,e as v,f as w,gb as rn,h as a,hb as an,i as h,j as y,l as M,m as g,n as t,na as G,o as i,p as f,s as I,sa as W,t as C,ta as D,u as b,wa as B,xa as N,y as c,ya as L,za as j}from"./chunk-C6RY7PX2.js";import"./chunk-G4GOZ2R2.js";import"./chunk-3EH7DRQW.js";import"./chunk-QUJFQN2Y.js";import"./chunk-E24K4UEG.js";import"./chunk-LEIZBYT7.js";import"./chunk-UM2WNVGK.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-TVBC6MYV.js";import"./chunk-26CMJVF7.js";import"./chunk-QQBOPM2N.js";import"./chunk-IACAUHTZ.js";import"./chunk-6KZXCEZL.js";import"./chunk-C7E54FQN.js";import"./chunk-ATYZ3M5D.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-Z455EQLB.js";import"./chunk-CKP3SGE2.js";import"./chunk-CIXXGG5D.js";import{j as x}from"./chunk-VI73JOY6.js";function dn(l,d){if(l&1){let p=I();t(0,"ion-item",20)(1,"ion-label",7),c(2),i(),t(3,"ion-input",21),u("ngModelChange",function(e){let n=v(p).$implicit;return _(n.titulo,e)||(n.titulo=e),w(e)}),i(),t(4,"ion-button",22),C("click",function(){let e=v(p).index,n=b();return w(n.removeOpcion(e))}),f(5,"ion-icon",23),i()()}if(l&2){let p=d.$implicit,o=d.index,e=b();a(2),P("Opci\xF3n ",o+1),a(),m("ngModel",p.titulo),a(),g("disabled",e.opciones.length<=2||e.loading)}}function sn(l,d){if(l&1&&(t(0,"ion-text",24),c(1),i()),l&2){let p=b();a(),P(" ",p.errorMsg," ")}}function gn(l,d){l&1&&f(0,"ion-spinner",1)}var Pn=(()=>{let d=class d{constructor(o,e,n){this.votosSvc=o,this.toast=e,this.router=n,this.loading=!1,this.errorMsg="",this.titulo="",this.descripcion="",this.fechaInicio="",this.fechaFin="",this.opciones=[{titulo:""},{titulo:""}]}ngOnInit(){let o=new Date,e=new Date(o.getTime()+48*3600*1e3);this.fechaInicio=o.toISOString(),this.fechaFin=e.toISOString()}addOpcion(){this.opciones.push({titulo:""})}removeOpcion(o){this.opciones.length>2&&this.opciones.splice(o,1)}get puedeGuardar(){let o=(this.titulo??"").trim(),e=this.opciones.map(O=>(O.titulo??"").trim()).filter(O=>O.length>0),n=new Set(e),s=new Date(this.fechaInicio).getTime(),r=new Date(this.fechaFin).getTime(),ln=!!this.fechaInicio&&!!this.fechaFin&&Number.isFinite(s)&&Number.isFinite(r)&&s<r;return o.length>0&&ln&&e.length>=2&&e.length===n.size}guardar(){return x(this,null,function*(){if(this.puedeGuardar){this.loading=!0,this.errorMsg="";try{let o=yield this.votosSvc.crearVotacionConOpciones({titulo:this.titulo.trim(),descripcion:this.descripcion.trim()||void 0,fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,opciones:this.opciones.map(e=>e.titulo.trim())});yield this.presentToast("Votaci\xF3n creada correctamente \u2705","success"),yield this.router.navigate(["/votacion",o])}catch(o){this.errorMsg=o?.message??"No se pudo crear la votaci\xF3n",yield this.presentToast(this.errorMsg,"danger")}finally{this.loading=!1}}})}presentToast(o,e){return x(this,null,function*(){yield(yield this.toast.create({message:o,duration:2500,position:"top",color:e})).present()})}};d.\u0275fac=function(e){return new(e||d)(h(cn),h(rn),h(T))},d.\u0275cmp=y({type:d,selectors:[["app-generar-votacion"]],decls:44,vars:11,consts:[[1,"rb-header"],["slot","start"],["menu","mainMenu","autoHide","false"],[1,"ion-padding","crear-votacion",3,"fullscreen"],[1,"card"],["lines","none"],[1,"field"],["position","stacked"],["placeholder","Ej: Prioridades de mejora del barrio",3,"ngModelChange","ngModel"],["autoGrow","true","rows","3","placeholder","Describe brevemente el prop\xF3sito de esta votaci\xF3n",3,"ngModelChange","ngModel"],["presentation","date-time","minute-values","0,15,30,45",3,"ngModelChange","ngModel"],[1,"options-header"],["size","small","fill","outline",3,"click","disabled"],["name","add-outline","slot","start"],[1,"options"],["class","field option",4,"ngFor","ngForOf"],["color","danger","style","display:block; margin-top:8px;",4,"ngIf"],[1,"actions"],["expand","block",3,"click","disabled"],["slot","start",4,"ngIf"],[1,"field","option"],["placeholder","Texto de la opci\xF3n",3,"ngModelChange","ngModel"],["slot","end","fill","clear","color","danger","aria-label","Eliminar opci\xF3n",3,"click","disabled"],["name","trash-outline"],["color","danger",2,"display","block","margin-top","8px"]],template:function(e,n){e&1&&(t(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),f(3,"ion-menu-button",2),i(),t(4,"ion-title"),c(5,"Crear votaci\xF3n"),i()()(),t(6,"ion-content",3)(7,"ion-card",4)(8,"ion-card-header")(9,"ion-card-title"),c(10,"Nueva votaci\xF3n"),i(),t(11,"ion-card-subtitle"),c(12,"Completa los campos y publica"),i()(),t(13,"ion-card-content")(14,"ion-list",5)(15,"ion-item",6)(16,"ion-label",7),c(17,"T\xEDtulo"),i(),t(18,"ion-input",8),u("ngModelChange",function(r){return _(n.titulo,r)||(n.titulo=r),r}),i()(),t(19,"ion-item",6)(20,"ion-label",7),c(21,"Descripci\xF3n (opcional)"),i(),t(22,"ion-textarea",9),u("ngModelChange",function(r){return _(n.descripcion,r)||(n.descripcion=r),r}),i()(),t(23,"ion-item",6)(24,"ion-label",7),c(25,"Fecha de inicio"),i(),t(26,"ion-datetime",10),u("ngModelChange",function(r){return _(n.fechaInicio,r)||(n.fechaInicio=r),r}),i()(),t(27,"ion-item",6)(28,"ion-label",7),c(29,"Fecha de t\xE9rmino"),i(),t(30,"ion-datetime",10),u("ngModelChange",function(r){return _(n.fechaFin,r)||(n.fechaFin=r),r}),i()(),t(31,"div",11)(32,"h3"),c(33,"Opciones (m\xEDnimo 2, sin repetir)"),i(),t(34,"ion-button",12),C("click",function(){return n.addOpcion()}),f(35,"ion-icon",13),c(36," Agregar opci\xF3n "),i()(),t(37,"div",14),M(38,dn,6,3,"ion-item",15),i()(),M(39,sn,2,1,"ion-text",16),t(40,"div",17)(41,"ion-button",18),C("click",function(){return n.guardar()}),M(42,gn,1,0,"ion-spinner",19),c(43),i()()()()()),e&2&&(a(6),g("fullscreen",!0),a(12),m("ngModel",n.titulo),a(4),m("ngModel",n.descripcion),a(4),m("ngModel",n.fechaInicio),a(4),m("ngModel",n.fechaFin),a(4),g("disabled",n.loading),a(4),g("ngForOf",n.opciones),a(),g("ngIf",n.errorMsg),a(2),g("disabled",!n.puedeGuardar||n.loading),a(),g("ngIf",n.loading),a(),P(" ",n.loading?"Creando\u2026":"Crear votaci\xF3n"," "))},dependencies:[an,B,N,L,j,z,A,H,R,U,Y,q,J,K,Q,X,Z,$,nn,en,tn,on,W,D,F,S,k,G,E,V],styles:['@charset "UTF-8";[_nghost-%COMP%]{color-scheme:light;--rb-primary: #2563eb;--rb-primary-10: rgba(37, 99, 235, .1);--rb-primary-20: rgba(37, 99, 235, .2);--rb-bg: #f8fafc;--rb-text: #0f172a;--rb-muted: #64748b;--ion-background-color: var(--rb-bg);--ion-text-color: var(--rb-text);--ion-item-background: #ffffff;--ion-card-background: #ffffff}.rb-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--rb-primary), #60a5fa);--color: #fff;--border-color: transparent;--min-height: 56px}.crear-votacion[_ngcontent-%COMP%]{--background: var(--rb-bg)}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{background:#fff;border:1px solid rgba(2,6,23,.06);border-radius:18px;box-shadow:0 10px 26px #02061714;overflow:hidden;margin-bottom:16px}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid rgba(2,6,23,.06)}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-weight:800;color:var(--rb-text)}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:var(--rb-muted);font-weight:500}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{--background: #fff;background:#fff;border:1.5px solid #e2e8f0;border-radius:14px;box-shadow:0 8px 18px #0206170f;--padding-start: 12px;--inner-padding-end: 12px;--inner-padding-top: 12px;--inner-padding-bottom: 12px;--min-height: auto;margin:10px 0;transition:border-color .16s ease,box-shadow .16s ease}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:2px 4px 6px 2px;line-height:1.2;color:#334155;font-weight:700}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]::part(native), .crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]::part(native){color:var(--rb-text);background:#fff;line-height:1.25;font-weight:600;padding:8px 10px 10px}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]::part(native)::placeholder, .crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]::part(native)::placeholder{color:#6b7280;opacity:1}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   ion-datetime[_ngcontent-%COMP%]{--background: #fff;--color: var(--rb-text);--wheel-highlight-background: rgba(37, 99, 235, .08);--wheel-fade-background-rgb: 255,255,255;border-radius:12px}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field.item-has-focus[_ngcontent-%COMP%], .crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]:focus-within{border-color:var(--rb-primary);box-shadow:0 0 0 3px #2563eb24,0 8px 18px #0206170f}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   ion-text[color=danger][_ngcontent-%COMP%]{display:block;margin:4px 6px 0;font-size:.9rem;font-weight:600}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:16px}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 10px 18px var(--rb-primary-10)}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:active{transform:translateY(1px)}.crear-votacion[_ngcontent-%COMP%]   .options-header[_ngcontent-%COMP%]{margin:14px 2px 8px;display:flex;align-items:center;gap:10px}.crear-votacion[_ngcontent-%COMP%]   .options-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:800;color:var(--rb-text);font-size:16px;letter-spacing:.2px}.crear-votacion[_ngcontent-%COMP%]   .options-header[_ngcontent-%COMP%]   ion-button[fill=outline][_ngcontent-%COMP%]{--border-color: var(--rb-primary-20);--color: var(--rb-primary);--ripple-color: var(--rb-primary);--border-radius: 12px;--box-shadow: 0 6px 14px var(--rb-primary-10)}.crear-votacion[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{position:relative}.crear-votacion[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]   ion-button[slot=end][_ngcontent-%COMP%]{margin-left:8px}.action-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #fff;--border-color: rgba(2, 6, 23, .08);box-shadow:0 -8px 18px #0206170f}.ios[_ngcontent-%COMP%]   ion-item.field[_ngcontent-%COMP%]{--padding-start: 12px;--inner-padding-end: 12px}@media (max-width: 480px){.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{box-shadow:0 6px 12px #0206170d}}']});let l=d;return l})();export{Pn as GenerarVotacionPage};
