import{a as ce}from"./chunk-CL4KBMSP.js";import{a as h}from"./chunk-TX5AFJTF.js";import"./chunk-66QFWZLQ.js";import{A as a,C as s,Ea as L,Fa as B,Ga as q,H as M,Ia as H,Ja as R,Ka as $,Na as K,Oa as J,P as S,Ra as Q,S as E,Ua as W,Va as X,Wa as Y,_a as Z,ab as ee,ca as f,da as F,ea as k,eb as te,f as v,fb as ie,g as y,h as O,i as r,j as x,ja as A,k as I,kb as oe,la as T,lb as ne,m as P,mb as re,o as c,oa as D,p as o,q as i,r as u,ra as N,rb as ae,sa as G,u as w,ua as V,v as p,vb as le,w as C,xa as U,ya as j,za as z}from"./chunk-H7HGEQUX.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as b}from"./chunk-VI73JOY6.js";function pe(l,d){if(l&1&&(o(0,"div",24),u(1,"img",25),i()),l&2){let g=C();r(),c("src",g.previewUrl,O)}}function se(l,d){l&1&&(o(0,"ion-item",11)(1,"ion-label",12),a(2,"Cupos disponibles"),i(),u(3,"ion-input",26),i())}function me(l,d){if(l&1){let g=w();o(0,"ion-item",11)(1,"ion-label",12),a(2,"Fecha de inicio"),i(),o(3,"ion-datetime",27),p("ionChange",function(t){v(g);let e=C();return y(e.onDateChange("fecha_inicio",t))}),i()()}}function ue(l,d){if(l&1){let g=w();o(0,"ion-item",11)(1,"ion-label",12),a(2,"Fecha de t\xE9rmino"),i(),o(3,"ion-datetime",28),p("ionChange",function(t){v(g);let e=C();return y(e.onDateChange("fecha_fin",t))}),i()()}}var Pe=(()=>{let d=class d{constructor(n,t,e){this.fb=n,this.alertCtrl=t,this.auth=e,this.perfil=null,this.isActividad=!1,this.selectedFile=null,this.previewUrl=null,this.uploadedUrl=null}ngOnInit(){return b(this,null,function*(){this.proyectoForm=this.fb.group({tipo:["proyecto",f.required],titulo:["",[f.required,f.minLength(3)]],descripcion:["",[f.required,f.minLength(10)]],cupos_total:[null],fecha_inicio:[null],fecha_fin:[null]}),this.perfil=yield this.auth.miPerfil()})}onTipoChange(){this.isActividad=this.proyectoForm.value.tipo==="actividad"}onDateChange(n,t){let e=t.detail?.value;this.proyectoForm.patchValue({[n]:e})}limpiarFormulario(){this.proyectoForm.reset({tipo:"proyecto",titulo:"",descripcion:"",cupos_total:null,fecha_inicio:null,fecha_fin:null}),this.isActividad=!1,this.selectedFile=null,this.previewUrl=null,this.uploadedUrl=null}onFileSelected(n){return b(this,null,function*(){let t=n.target.files[0];if(!t)return;this.selectedFile=t;let e=new FileReader;e.onload=()=>this.previewUrl=e.result,e.readAsDataURL(t);let m=`${Date.now()}_${t.name}`,{error:_}=yield h.storage.from("proyectos").upload(m,t);if(_){console.error("Error al subir imagen:",_.message),this.showAlert("Error","No se pudo subir la imagen al servidor.");return}let{data:de}=h.storage.from("proyectos").getPublicUrl(m);this.uploadedUrl=de.publicUrl})}generarProyecto(){return b(this,null,function*(){if(this.proyectoForm.invalid){this.showAlert("Error","Por favor completa todos los campos obligatorios.");return}let n=this.proyectoForm.value,t=this.perfil?.id_auth;if(!t){this.showAlert("Error","No se pudo obtener la sesi\xF3n del usuario.");return}try{if(n.tipo==="actividad"){let{error:e}=yield h.from("actividad").insert([{id_auth:t,titulo:n.titulo,descripcion:n.descripcion,cupos_total:n.cupos_total??0,fecha_inicio:n.fecha_inicio,fecha_fin:n.fecha_fin,estado:"publicada",imagen_url:this.uploadedUrl,creado_en:new Date().toISOString(),actualizado_en:new Date().toISOString()}]);if(e)throw e;yield this.showAlert("\xC9xito","Actividad creada correctamente.")}else{let{error:e}=yield h.from("proyecto").insert([{id_auth:t,titulo:n.titulo,descripcion:n.descripcion,estado:"pendiente",fecha_creacion:new Date().toISOString(),actualizado_en:new Date().toISOString(),imagen_url:this.uploadedUrl}]);if(e)throw e;yield this.showAlert("\xC9xito","Proyecto creado correctamente.")}this.limpiarFormulario()}catch(e){console.error("Error al crear:",e),yield this.showAlert("Error",e.message||"No se pudo crear el registro.")}})}showAlert(n,t){return b(this,null,function*(){yield(yield this.alertCtrl.create({header:n,message:t,buttons:["OK"]})).present()})}};d.\u0275fac=function(t){return new(t||d)(x(G),x(ae),x(ce))},d.\u0275cmp=I({type:d,selectors:[["app-generar-proyecto"]],decls:48,vars:17,consts:[[1,"rb-header",3,"translucent"],["slot","start"],["menu","mainMenu","autoHide","false"],["fullscreen",""],[1,"page-wrap","ion-padding"],[1,"card","hero"],[3,"ngSubmit","formGroup"],["lines","none",1,"tipo-publicacion"],["formControlName","tipo",3,"ionChange"],["value","proyecto"],["value","actividad"],["lines","none",1,"field"],["position","stacked"],["formControlName","titulo","maxlength","80",3,"placeholder"],[1,"char-counter"],["formControlName","descripcion","autoGrow","true",3,"placeholder"],[1,"image-upload"],[1,"upload-label"],["type","file","accept","image/*",3,"change"],["class","preview-card",4,"ngIf"],["class","field","lines","none",4,"ngIf"],[1,"buttons-container"],["type","button","color","medium","fill","outline",3,"click"],["expand","block","type","submit",3,"disabled"],[1,"preview-card"],["alt","Vista previa",1,"preview-img",3,"src"],["formControlName","cupos_total","type","number","placeholder","Ej: 20"],["formControlName","fecha_inicio","presentation","date-time",3,"ionChange"],["formControlName","fecha_fin","presentation","date-time",3,"ionChange"]],template:function(t,e){t&1&&(o(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),u(3,"ion-menu-button",2),i(),o(4,"ion-title"),a(5,"Generar publicaci\xF3n"),i()()(),o(6,"ion-content",3)(7,"div",4)(8,"ion-card",5)(9,"ion-card-header")(10,"ion-card-title"),a(11),i(),o(12,"ion-card-subtitle"),a(13),i()()(),o(14,"form",6),p("ngSubmit",function(){return e.generarProyecto()}),o(15,"ion-item",7)(16,"ion-label"),a(17,"Tipo de publicaci\xF3n"),i(),o(18,"ion-segment",8),p("ionChange",function(){return e.onTipoChange()}),o(19,"ion-segment-button",9)(20,"ion-label"),a(21,"Proyecto"),i()(),o(22,"ion-segment-button",10)(23,"ion-label"),a(24,"Actividad"),i()()()(),o(25,"ion-item",11)(26,"ion-label",12),a(27),i(),u(28,"ion-input",13),o(29,"ion-note",14),a(30),i()(),o(31,"ion-item",11)(32,"ion-label",12),a(33),i(),u(34,"ion-textarea",15),i(),o(35,"div",16)(36,"label",17),a(37,"Imagen de referencia"),i(),o(38,"input",18),p("change",function(_){return e.onFileSelected(_)}),i(),P(39,pe,2,1,"div",19),i(),P(40,se,4,0,"ion-item",20)(41,me,4,0,"ion-item",20)(42,ue,4,0,"ion-item",20),o(43,"div",21)(44,"ion-button",22),p("click",function(){return e.limpiarFormulario()}),a(45," Limpiar "),i(),o(46,"ion-button",23),a(47),i()()()()()),t&2&&(c("translucent",!0),r(11),s("Nuevo ",e.isActividad?"Actividad":"Proyecto"),r(2),s(" Completa la informaci\xF3n b\xE1sica de la ",e.isActividad?"actividad":"proyecto",". "),r(),c("formGroup",e.proyectoForm),r(13),s(" ",e.isActividad?"T\xEDtulo de la actividad":"T\xEDtulo del proyecto"," "),r(),c("placeholder",M(e.isActividad?"Ej: Taller de reciclaje":"Ej: Plaza comunitaria")),r(2),s("",(e.proyectoForm.value.titulo==null?null:e.proyectoForm.value.titulo.length)||0,"/80"),r(3),s(" ",e.isActividad?"Descripci\xF3n de la actividad":"Descripci\xF3n del proyecto"," "),r(),c("placeholder",M(e.isActividad?"Ej: Actividad comunitaria de limpieza y reciclaje en el parque central.":"Describe el prop\xF3sito, etapas y beneficios del proyecto.")),r(5),c("ngIf",e.previewUrl),r(),c("ngIf",e.isActividad),r(),c("ngIf",e.isActividad),r(),c("ngIf",e.isActividad),r(4),c("disabled",e.proyectoForm.invalid),r(),s(" ",e.isActividad?"Crear Actividad":"Crear Proyecto"," "))},dependencies:[E,S,le,L,B,q,H,R,$,K,J,Q,W,X,Y,Z,ee,te,ie,oe,ne,re,U,j,z,V,A,F,k,N,T,D],styles:["[_nghost-%COMP%], html[_nghost-%COMP%], html   [_nghost-%COMP%]{color-scheme:light!important;--rb-primary: #2563eb;--rb-bg: #f5f7fb;--rb-text: #0f172a;--rb-muted: #475569;--ion-text-color: var(--rb-text);--ion-background-color: var(--rb-bg);--ion-item-background: #ffffff;--ion-card-background: #ffffff}.rb-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--rb-primary), #60a5fa);--color: #fff;--border-color: transparent}.page-wrap[_ngcontent-%COMP%]{max-width:960px;margin:0 auto;padding:8px 16px 32px}.card[_ngcontent-%COMP%]{background:#fff;border-radius:18px;border:1px solid rgba(2,6,23,.08);box-shadow:0 12px 28px #02061714;overflow:hidden;margin-bottom:18px}.card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid rgba(2,6,23,.06)}.card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{color:var(--rb-text);font-weight:800;font-size:1.2rem}.card[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#64748b;font-weight:600}ion-item.tipo-publicacion[_ngcontent-%COMP%]{background:#fff;border-radius:14px;border:1px solid rgba(2,6,23,.08);box-shadow:0 6px 18px #0206170f;margin-bottom:18px;--background: #fff}ion-item.tipo-publicacion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:700;color:var(--rb-muted);margin-bottom:6px}ion-item.tipo-publicacion[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{background:#f1f5f9;border-radius:10px;padding:4px;box-shadow:inset 0 0 0 1px #0206170f}ion-item.tipo-publicacion[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--background: transparent;--background-checked: var(--rb-primary);--color: #334155;--color-checked: #ffffff;border-radius:8px;font-weight:700;text-transform:none}.field[_ngcontent-%COMP%]{margin-bottom:18px;background:#fff;border-radius:14px;border:1px solid rgba(2,6,23,.08);box-shadow:0 6px 16px #0206170f;--background: #fff;--inner-background: #fff;--padding-start: 14px;--padding-end: 14px;--inner-padding-top: 12px;--inner-padding-bottom: 12px}.field[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--rb-muted);font-weight:700;margin:4px 0 6px 2px}.field[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   ion-datetime[_ngcontent-%COMP%]{--background: #fff;--color: var(--rb-text);--placeholder-color: #94a3b8;font-weight:500;font-size:.95rem;padding-top:6px;padding-bottom:6px}.field[_ngcontent-%COMP%]:hover{border-color:#cbd5e1}.field[_ngcontent-%COMP%]:focus-within{border-color:var(--rb-primary);box-shadow:0 0 0 3px #2563eb24}.image-upload[_ngcontent-%COMP%]{background:#fff;border-radius:14px;border:1px solid rgba(2,6,23,.08);padding:12px;box-shadow:0 6px 16px #0206170f;margin-bottom:18px}.image-upload[_ngcontent-%COMP%]   .upload-label[_ngcontent-%COMP%]{font-weight:700;color:var(--rb-muted);display:block;margin-bottom:6px}.image-upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{font-size:.9rem;color:var(--rb-muted);margin-bottom:10px}.image-upload[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]{border-radius:12px;overflow:hidden;background:#fff;box-shadow:0 4px 12px #02061714;display:flex;justify-content:center;align-items:center;max-height:260px}.image-upload[_ngcontent-%COMP%]   .preview-img[_ngcontent-%COMP%]{width:100%;height:auto;object-fit:contain;background:#fff}.buttons-container[_ngcontent-%COMP%]{margin-top:20px;display:flex;justify-content:flex-end;gap:10px}.buttons-container[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{border-radius:10px;font-weight:700;box-shadow:0 8px 20px #2563eb26}.buttons-container[_ngcontent-%COMP%]   ion-button[color=medium][_ngcontent-%COMP%]{--color: #475569;--border-color: #cbd5e1;--background: #fff}@media (prefers-color-scheme: dark){[_nghost-%COMP%]{--ion-background-color: var(--rb-bg);--ion-card-background: #fff;--ion-item-background: #fff;--ion-text-color: var(--rb-text)}}"]});let l=d;return l})();export{Pe as GenerarProyectoComponent};
