import{$ as P,A as n,B as x,C as m,Ea as y,Ga as M,Ha as b,Ia as z,Ka as j,Na as A,P as _,Ra as N,S as E,Y as v,_ as C,ba as S,i as a,ib as O,j as p,k as h,lb as R,m as f,mb as T,o as d,p as r,pb as k,q as t,r as I,rb as w,vb as J,w as g,wb as F}from"./chunk-H7HGEQUX.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as u}from"./chunk-VI73JOY6.js";function Y(o,l){if(o&1&&(r(0,"div",4),I(1,"ion-spinner",5),r(2,"p",6),n(3),t()()),o&2){let i=g();a(3),x(i.mensaje)}}function H(o,l){if(o&1&&(r(0,"ion-card-content")(1,"p")(2,"strong"),n(3,"Estado:"),t(),n(4),t(),r(5,"p")(6,"strong"),n(7,"Monto:"),t(),n(8),t(),r(9,"p")(10,"strong"),n(11,"Tipo de pago:"),t(),n(12),t(),r(13,"p")(14,"strong"),n(15,"C\xF3digo autorizaci\xF3n:"),t(),n(16),t()()),o&2){let i=g(2);a(4),m(" ",i.detalles.estado),a(4),m(" $",i.detalles.monto),a(4),m(" ",i.detalles.tipoPago),a(4),m(" ",i.detalles.codigoAutorizacion)}}function L(o,l){if(o&1&&(r(0,"div")(1,"ion-card",7)(2,"ion-card-header")(3,"ion-card-title"),n(4),t()(),f(5,H,17,4,"ion-card-content",3),t(),r(6,"ion-button",8),n(7," Volver al inicio "),t()()),o&2){let i=g();a(),d("color",(i.detalles==null?null:i.detalles.estado)==="Pagado"?"success":"danger"),a(3),x(i.mensaje),a(),d("ngIf",i.detalles)}}var U="https://sovnabbbubapqxziubuh.supabase.co",B="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvdm5hYmJidWJhcHF4eml1YnVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3NTY0NzcsImV4cCI6MjA3NDMzMjQ3N30.eQoxa8NkXwHwpSM03bB2gEJj9EZ0FxK3-nY3SJe5iiE",D=F(U,B),ee=(()=>{let l=class l{constructor(s,e,c){this.route=s,this.router=e,this.alertCtrl=c,this.mensaje="Procesando pago...",this.detalles=null,this.loading=!0}ngOnInit(){return u(this,null,function*(){yield this.confirmarPago()})}confirmarPago(){return u(this,null,function*(){let s=this.route.snapshot.queryParamMap.get("token_ws");if(!s){this.mensaje="\u26A0\uFE0F No se encontr\xF3 el token del pago.",this.loading=!1;return}try{let{data:e,error:c}=yield D.functions.invoke("transbank-confirm",{body:{token_ws:s}});if(this.loading=!1,c){console.error("Error Supabase:",c),this.mensaje="\u274C Error al confirmar el pago.";return}e?.status==="AUTHORIZED"?(this.mensaje="\u2705 Pago realizado con \xE9xito.",this.detalles={estado:"Pagado",codigoAutorizacion:e.authorization_code,tipoPago:e.payment_type_code,monto:e.amount}):(this.mensaje="\u274C El pago fue rechazado o no autorizado.",this.detalles={estado:"Rechazado",codigoAutorizacion:e?.authorization_code??"N/A",tipoPago:e?.payment_type_code??"N/A",monto:e?.amount??0}),yield(yield this.alertCtrl.create({header:"Resultado del Pago",message:this.mensaje,buttons:[{text:"Volver al inicio",handler:()=>this.router.navigate(["/home"])}]})).present()}catch(e){console.error("Error general:",e),this.loading=!1,this.mensaje="\u26A0\uFE0F Error inesperado al confirmar el pago."}})}};l.\u0275fac=function(e){return new(e||l)(p(v),p(C),p(w))},l.\u0275cmp=h({type:l,selectors:[["app-pago-retorno"]],decls:7,vars:2,consts:[["color","primary"],[1,"ion-padding"],["class","ion-text-center",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center"],["name","crescent","color","primary"],[1,"ion-margin-top"],[1,"ion-text-center",3,"color"],["expand","block","color","medium","routerLink","/home"]],template:function(e,c){e&1&&(r(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),n(3,"Pago WebPay"),t()()(),r(4,"ion-content",1),f(5,Y,4,1,"div",2)(6,L,8,3,"div",3),t()),e&2&&(a(5),d("ngIf",c.loading),a(),d("ngIf",!c.loading))},dependencies:[E,_,J,y,M,b,z,j,A,N,O,R,T,k,S,P],styles:["ion-content[_ngcontent-%COMP%]{text-align:center}ion-content[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:24px 0;font-size:64px}ion-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:700;margin-bottom:8px}ion-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}"]});let o=l;return o})();export{ee as PagoRetornoPage};
