import{A as f,B as l,Da as M,Ma as y,O as E,R as v,X as S,_ as P,aa as C,hb as z,i,j as _,k as h,m as u,n as m,o as a,ob as b,p as t,q as I,ub as w,v as p,vb as O,z as o}from"./chunk-JZTRD5FY.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as g}from"./chunk-VI73JOY6.js";function N(n,r){if(n&1&&(a(0,"div"),I(1,"ion-spinner",2),a(2,"p"),o(3),t()()),n&2){let s=p();i(3),f(s.mensaje)}}function k(n,r){if(n&1&&(a(0,"div")(1,"p")(2,"strong"),o(3,"Estado:"),t(),o(4),t(),a(5,"p")(6,"strong"),o(7,"Monto:"),t(),o(8),t(),a(9,"p")(10,"strong"),o(11,"Tipo de pago:"),t(),o(12),t(),a(13,"p")(14,"strong"),o(15,"C\xF3digo autorizaci\xF3n:"),t(),o(16),t()()),n&2){let s=p(2);i(4),l(" ",s.detalles.estado),i(4),l(" $",s.detalles.monto),i(4),l(" ",s.detalles.tipoPago),i(4),l(" ",s.detalles.codigoAutorizacion)}}function A(n,r){if(n&1&&(a(0,"div")(1,"h2"),o(2),t(),u(3,k,17,4,"div",1),a(4,"ion-button",3),o(5," Volver al inicio "),t()()),n&2){let s=p();i(2),f(s.mensaje),i(),m("ngIf",s.detalles)}}var j="https://sovnabbbubapqxziubuh.supabase.co",J="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvdm5hYmJidWJhcHF4eml1YnVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3NTY0NzcsImV4cCI6MjA3NDMzMjQ3N30.eQoxa8NkXwHwpSM03bB2gEJj9EZ0FxK3-nY3SJe5iiE",x=O(j,J),Z=(()=>{let r=class r{constructor(c){this.route=c,this.mensaje="Procesando pago...",this.detalles=null,this.loading=!0}ngOnInit(){return g(this,null,function*(){yield this.confirmarPago()})}confirmarPago(){return g(this,null,function*(){let c=this.route.snapshot.queryParamMap.get("token_ws");if(!c){this.mensaje="\u26A0\uFE0F No se encontr\xF3 el token del pago.",this.loading=!1;return}try{let{data:e,error:d}=yield x.functions.invoke("transbank-confirm",{body:{token_ws:c}});if(this.loading=!1,d){console.error("Error Supabase:",d),this.mensaje="\u274C Error al confirmar el pago.";return}e?.status==="AUTHORIZED"?(this.mensaje="\u2705 Pago realizado con \xE9xito.",this.detalles={estado:"Pagado",codigoAutorizacion:e.authorization_code,tipoPago:e.payment_type_code,monto:e.amount},yield x.from("orden_pago").update({token_ws:c,estado:"pagado",updated_at:new Date().toISOString()}).eq("token_ws",c)):(this.mensaje="\u274C El pago fue rechazado o no autorizado.",this.detalles={estado:"Rechazado",codigoAutorizacion:e?.authorization_code??"N/A",tipoPago:e?.payment_type_code??"N/A",monto:e?.amount??0},yield x.from("orden_pago").update({estado:"rechazado",updated_at:new Date().toISOString()}).eq("token_ws",c))}catch(e){console.error("Error general:",e),this.loading=!1,this.mensaje="\u26A0\uFE0F Error inesperado al confirmar el pago."}})}};r.\u0275fac=function(e){return new(e||r)(_(S))},r.\u0275cmp=h({type:r,selectors:[["app-pago-retorno"]],decls:3,vars:2,consts:[[1,"ion-padding"],[4,"ngIf"],["name","crescent"],["routerLink","/home","expand","block","color","primary"]],template:function(e,d){e&1&&(a(0,"ion-content",0),u(1,N,4,1,"div",1)(2,A,6,2,"div",1),t()),e&2&&(i(),m("ngIf",d.loading),i(),m("ngIf",!d.loading))},dependencies:[v,E,w,M,y,z,b,C,P],styles:["ion-content[_ngcontent-%COMP%]{text-align:center}ion-content[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:24px 0;font-size:64px}ion-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:700;margin-bottom:8px}ion-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}"]});let n=r;return n})();export{Z as PagoRetornoPage};
