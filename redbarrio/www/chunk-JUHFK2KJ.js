import{a as ae}from"./chunk-DSYC522I.js";import"./chunk-BSJEIMOO.js";import{a as P}from"./chunk-CGH6KSUE.js";import{B as f,Da as U,Ea as D,Fa as R,Ga as B,Ha as j,Ia as q,J as w,Ja as Y,K as O,L as E,La as $,M as k,Ma as G,N as S,O as A,P as N,Pa as K,Q as T,Qa as W,R as z,Ra as J,Z as H,Za as L,aa as V,cb as Q,f as x,g as h,h as I,hb as X,i as s,j as u,k as M,kb as Z,lb as ee,m as g,n as d,o,p as a,q as _,qb as te,sa as F,sb as ie,t as b,u as C,ub as ne,v as p,vb as oe,w as y,z as l}from"./chunk-JZTRD5FY.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as m}from"./chunk-VI73JOY6.js";function re(e,r){e&1&&(o(0,"div",10),_(1,"ion-spinner",11),o(2,"p"),l(3,"Cargando noticias..."),a()())}function ce(e,r){if(e&1&&(o(0,"div",20),_(1,"img",21),a()),e&2){let n=p().$implicit;s(),d("src",n.url_foto==null?null:n.url_foto[0],I)}}function le(e,r){if(e&1&&(o(0,"span"),l(1),w(2,"date"),a()),e&2){let n=p().$implicit;s(),f(" | ",O(2,1,n.fecha_creacion,"shortDate")," ")}}function se(e,r){if(e&1){let n=b();o(0,"ion-button",22),C("click",function(i){x(n);let c=p().$implicit,v=p(2);return i.stopPropagation(),h(v.confirmarYEliminarNoticia(c.id))}),l(1,"Eliminar "),a()}}function de(e,r){if(e&1&&(o(0,"p",23),l(1),w(2,"slice"),a()),e&2){let n=r.ngIf;s(),f(" ",E(2,1,n,0,100),"\u2026 ")}}function me(e,r){e&1&&(o(0,"p",24),l(1,"[Sin resumen]"),a())}function pe(e,r){if(e&1){let n=b();o(0,"ion-col",13)(1,"ion-card",14),C("click",function(){let i=x(n).$implicit,c=p(2);return h(c.verDetalle(i.id))}),g(2,ce,2,1,"div",15),o(3,"ion-card-header")(4,"ion-card-title",16),l(5),a(),o(6,"div",17)(7,"ion-card-subtitle"),l(8),g(9,le,3,4,"span",7),a(),g(10,se,2,0,"ion-button",18),a()(),o(11,"ion-card-content"),g(12,de,3,5,"p",19)(13,me,2,0,"ng-template",null,0,k),a()()()}if(e&2){let n=r.$implicit,t=y(14),i=p(2);s(2),d("ngIf",n.url_foto==null?null:n.url_foto.length),s(3),f(" ",n.titulo," "),s(3),f(" ",n.nombre_autor||"An\xF3nimo"," "),s(),d("ngIf",n.fecha_creacion),s(),d("ngIf",i.esAdmin),s(2),d("ngIf",n.parrafos==null?null:n.parrafos[0])("ngIfElse",t)}}function ge(e,r){if(e&1&&(o(0,"ion-grid")(1,"ion-row"),g(2,pe,15,7,"ion-col",12),a()()),e&2){let n=p();s(2),d("ngForOf",n.noticias)}}function ue(e,r){e&1&&(o(0,"div",25)(1,"h2"),l(2,"No hay noticias disponibles"),a(),o(3,"p"),l(4,"S\xE9 el primero en crear una noticia usando el bot\xF3n flotante."),a()())}function _e(e,r){if(e&1){let n=b();o(0,"ion-button",26),C("click",function(){x(n);let i=p();return h(i.navegarACrearNoticia())}),l(1," Nueva Noticia "),_(2,"ion-icon",27),a()}}var Oe=(()=>{let r=class r{constructor(t,i,c,v){this.router=t,this.menu=i,this.auth=c,this.alertController=v,this.noticias=[],this.estaCargando=!1,this.esAdmin=!1,this.usuarioActual=null,this.nombreAutorActual=null,this.supabase=oe(P.supabaseUrl,P.supabaseAnonKey)}ngOnInit(){this.cargarEstadoYNoticias()}go(t){return m(this,null,function*(){yield this.router.navigate(["/",t]),yield this.menu.close("main-menu")})}goVotacion(){return m(this,null,function*(){yield this.router.navigate(["/votacion","VOTACION-DEMOSTRACION"]),yield this.menu.close("main-menu")})}salir(){return m(this,null,function*(){try{yield this.auth.signOut()}finally{yield this.menu.close("main-menu"),yield this.router.navigateByUrl("/login",{replaceUrl:!0})}})}cargarEstadoYNoticias(){return m(this,null,function*(){yield this.cargarEstadoUsuario(),yield this.cargarNoticias()})}cargarEstadoUsuario(){return m(this,null,function*(){try{let{data:{user:t}}=yield this.supabase.auth.getUser();if(this.usuarioActual=t,this.esAdmin=!1,this.nombreAutorActual=null,t){let{data:i,error:c}=yield this.supabase.from("usuario").select("rol, nombre").eq("user_id",t.id).single();if(c&&c.code!=="PGRST116")throw c;this.esAdmin=i?.rol==="administrador",this.nombreAutorActual=i?.nombre||"Administrador/a"}}catch(t){console.error("Error al cargar estado de usuario:",t),this.esAdmin=!1,this.nombreAutorActual=null}})}cargarNoticias(){return m(this,null,function*(){this.estaCargando=!0;try{let{data:t,error:i}=yield this.supabase.from("noticias").select("id, titulo, url_foto, nombre_autor, fecha_creacion, parrafos").order("fecha_creacion",{ascending:!1});if(i)throw i;this.noticias=t}catch(t){console.error("Error al cargar noticias:",t)}finally{this.estaCargando=!1}})}confirmarYEliminarNoticia(t){return m(this,null,function*(){yield(yield this.alertController.create({header:"Confirmar Eliminaci\xF3n",message:"\xBFEst\xE1s seguro de que quieres eliminar esta noticia? Esta acci\xF3n no se puede deshacer.",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary"},{text:"Eliminar",handler:()=>{this.eliminarNoticia(t)}}]})).present()})}eliminarNoticia(t){return m(this,null,function*(){this.estaCargando=!0;try{let{error:i}=yield this.supabase.from("noticias").delete().eq("id",t);if(i)throw i;yield this.cargarNoticias()}catch(i){console.error("Error al intentar eliminar noticia:",i)}finally{this.estaCargando=!1}})}verDetalle(t){this.router.navigate(["/noticias",t])}navegarACrearNoticia(){this.router.navigate(["noticias/crear"])}ionViewWillEnter(){this.cargarEstadoYNoticias()}};r.\u0275fac=function(i){return new(i||r)(u(H),u(ie),u(ae),u(te))},r.\u0275cmp=M({type:r,selectors:[["app-home"]],decls:21,vars:4,consts:[["sinResumen",""],[1,"rb-header"],["slot","start"],["menu","mainMenu","autoHide","false"],[1,"ion-padding","news"],[1,"hero"],["class","loading",4,"ngIf"],[4,"ngIf"],["class","empty",4,"ngIf"],["class","fixed-action-button","expand","block",3,"click",4,"ngIf"],[1,"loading"],["name","crescent"],["size","12","size-md","6","size-lg","4",4,"ngFor","ngForOf"],["size","12","size-md","6","size-lg","4"],[3,"click"],["class","card-image-container",4,"ngIf"],[1,"card-title","ion-text-wrap"],[2,"display","flex","justify-content","space-between","align-items","center"],["size","block","color","danger","style","margin-left: 8px;",3,"click",4,"ngIf"],["class","card-excerpt",4,"ngIf","ngIfElse"],[1,"card-image-container"],["alt","Miniatura",1,"card-image",3,"src"],["size","block","color","danger",2,"margin-left","8px",3,"click"],[1,"card-excerpt"],[1,"card-excerpt-placeholder"],[1,"empty"],["expand","block",1,"fixed-action-button",3,"click"],["name","add-circle-outline","slot","end"]],template:function(i,c){i&1&&(o(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),_(3,"ion-menu-button",3),a(),o(4,"ion-title"),l(5,"Inicio y Noticias"),a()()(),o(6,"ion-content",4)(7,"div",5)(8,"h1"),l(9,"\xA1Bienvenido/a!"),a(),o(10,"p"),l(11,"Usa el men\xFA (arriba a la izquierda) para navegar por la app."),a()(),o(12,"div")(13,"h2"),l(14,"Noticias"),a(),o(15,"p"),l(16,"Aqu\xED puedes ver las noticias m\xE1s recientes de tu comunidad."),a()(),g(17,re,4,0,"div",6)(18,ge,3,1,"ion-grid",7)(19,ue,5,0,"div",8)(20,_e,3,0,"ion-button",9),a()),i&2&&(s(17),d("ngIf",c.estaCargando),s(),d("ngIf",!c.estaCargando&&(c.noticias==null?null:c.noticias.length)),s(),d("ngIf",!c.estaCargando&&(!c.noticias||!c.noticias.length)),s(),d("ngIf",c.esAdmin))},dependencies:[ne,U,D,R,B,j,q,Y,$,G,K,W,J,L,Q,X,Z,ee,z,S,A,V,F,T,N],styles:['@charset "UTF-8";[_nghost-%COMP%]{--rb-primary: #2563eb;--rb-primary-10: rgba(37, 99, 235, .1);--rb-text: #0f172a;--rb-muted: #64748b;--rb-sep: rgba(2, 6, 23, .06);--rb-bg: #f8fafc;color-scheme:light;--ion-background-color: var(--rb-bg);--ion-text-color: var(--rb-text)}.rb-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--rb-primary), #60a5fa);--color: #fff;--border-color: transparent;--min-height: 56px}.home[_ngcontent-%COMP%]{--background: var(--rb-bg)}.hero[_ngcontent-%COMP%]{text-align:center;background:#fff;border-radius:18px;padding:28px 22px;width:min(620px,100%);box-shadow:0 10px 30px #0206171a,inset 0 1px #fff9;border:1px solid rgba(2,6,23,.06);margin:0 auto}.hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 8px;font-size:24px;font-weight:700;color:var(--rb-text)}.hero[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#475569}.ios[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 12px;--inner-padding-end: 12px}.news[_ngcontent-%COMP%]{--background: #fff;padding-bottom:8px}.news[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{--ion-grid-padding: 6px}.news[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:10px}ion-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;border:1px solid var(--rb-sep);box-shadow:0 6px 16px #0206171f,0 18px 30px #0206171f;overflow:hidden;transition:transform .08s ease,box-shadow .12s ease,border-color .12s ease}ion-card[_ngcontent-%COMP%]:active{transform:scale(.996);box-shadow:0 8px 18px #02061729,0 18px 36px #02061733;border-color:#2563eb2e}.card-image-container[_ngcontent-%COMP%]{width:100%;height:200px;overflow:hidden;background:#f1f5f9;border-bottom:1px solid var(--rb-sep)}@media (min-width: 768px){.card-image-container[_ngcontent-%COMP%]{height:230px}}.card-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}ion-card-header[_ngcontent-%COMP%]{background:#fff;padding:12px 14px 8px;border-bottom:1px solid var(--rb-sep)}.card-title[_ngcontent-%COMP%]{margin:0 0 2px;color:var(--rb-text);font-weight:800;font-size:17px;line-height:1.25;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}ion-card-subtitle[_ngcontent-%COMP%]{color:var(--rb-muted);font-weight:600;letter-spacing:.2px;font-size:12.5px}ion-card-content[_ngcontent-%COMP%]{padding:10px 14px 14px}.card-excerpt[_ngcontent-%COMP%]{color:#334155;font-weight:500;font-size:14.5px;line-height:1.4;margin:2px 0 0;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}.card-excerpt-placeholder[_ngcontent-%COMP%]{color:#94a3b8;font-style:italic;margin:2px 0 0}.loading[_ngcontent-%COMP%], .empty[_ngcontent-%COMP%]{text-align:center;color:#475569;padding:20px 12px}.loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:8px}@media (prefers-reduced-motion: reduce){ion-card[_ngcontent-%COMP%]{transition:none}}.fixed-action-button[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:16px;z-index:100;height:48px;width:auto;min-width:140px;--background: var(--rb-primary);--color: white;--border-radius: 12px;--box-shadow: 0 10px 20px rgba(37, 99, 235, .35);font-weight:700;letter-spacing:.5px;transition:transform .2s ease}.fixed-action-button[_ngcontent-%COMP%]:active{transform:scale(.98)}.fixed-action-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.3em;margin-inline-start:8px}@media (max-width: 480px){.fixed-action-button[_ngcontent-%COMP%]{bottom:12px;right:12px;min-width:120px;height:44px;font-size:.9em}}']});let e=r;return e})();export{Oe as HomePage};
