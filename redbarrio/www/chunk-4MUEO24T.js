import{$ as I,A as n,B as _,C as p,Ea as v,Ga as y,Ha as E,Ia as S,Ka as k,Na as w,P as C,Ra as j,S as P,Y as h,_ as M,ba as O,i,ib as z,j as g,k as u,lb as A,m as x,mb as N,o as l,p as r,pb as T,q as e,r as b,rb as R,vb as J,w as m,wb as Y}from"./chunk-H7HGEQUX.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as f}from"./chunk-VI73JOY6.js";function U(o,c){if(o&1&&(r(0,"div",4),b(1,"ion-spinner",5),r(2,"p",6),n(3),e()()),o&2){let a=m();i(3),_(a.mensaje)}}function F(o,c){if(o&1&&(r(0,"ion-card-content")(1,"p")(2,"strong"),n(3,"Estado:"),e(),n(4),e(),r(5,"p")(6,"strong"),n(7,"Monto:"),e(),n(8),e(),r(9,"p")(10,"strong"),n(11,"Tipo de pago:"),e(),n(12),e(),r(13,"p")(14,"strong"),n(15,"C\xF3digo autorizaci\xF3n:"),e(),n(16),e()()),o&2){let a=m(2);i(4),p(" ",a.detalles.estado),i(4),p(" $",a.detalles.monto),i(4),p(" ",a.detalles.tipoPago),i(4),p(" ",a.detalles.codigoAutorizacion)}}function H(o,c){if(o&1&&(r(0,"div")(1,"ion-card",7)(2,"ion-card-header")(3,"ion-card-title"),n(4),e()(),x(5,F,17,4,"ion-card-content",3),e(),r(6,"ion-button",8),n(7," Volver al inicio "),e()()),o&2){let a=m();i(),l("color",(a.detalles==null?null:a.detalles.estado)==="Pagado"?"success":"danger"),i(3),_(a.mensaje),i(),l("ngIf",a.detalles)}}var L="https://sovnabbbubapqxziubuh.supabase.co",B="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvdm5hYmJidWJhcHF4eml1YnVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3NTY0NzcsImV4cCI6MjA3NDMzMjQ3N30.eQoxa8NkXwHwpSM03bB2gEJj9EZ0FxK3-nY3SJe5iiE",D=Y(L,B),tt=(()=>{let c=class c{constructor(s,t,d){this.route=s,this.router=t,this.alertCtrl=d,this.mensaje="Procesando pago...",this.detalles=null,this.loading=!0}ngOnInit(){return f(this,null,function*(){yield this.confirmarPago()})}confirmarPago(){return f(this,null,function*(){let s=this.route.snapshot.queryParamMap.get("token_ws");if(!s){this.mensaje="\u26A0\uFE0F No se encontr\xF3 el token del pago.",this.loading=!1;return}try{let{data:t,error:d}=yield D.functions.invoke("transbank-confirm",{body:{token_ws:s}});if(this.loading=!1,d){console.error("Error Supabase:",d),this.mensaje="\u274C Error al confirmar el pago.";return}t?.status==="AUTHORIZED"?(this.mensaje="\u2705 Pago realizado con \xE9xito.",this.detalles={estado:"Pagado",codigoAutorizacion:t.authorization_code,tipoPago:t.payment_type_code,monto:t.amount}):(this.mensaje="\u274C El pago fue rechazado o no autorizado.",this.detalles={estado:"Rechazado",codigoAutorizacion:t?.authorization_code??"N/A",tipoPago:t?.payment_type_code??"N/A",monto:t?.amount??0}),yield(yield this.alertCtrl.create({header:"Resultado del Pago",message:this.mensaje,buttons:[{text:"Volver al inicio",handler:()=>this.router.navigate(["/home"])}]})).present()}catch(t){console.error("Error general:",t),this.loading=!1,this.mensaje="\u26A0\uFE0F Error inesperado al confirmar el pago."}})}};c.\u0275fac=function(t){return new(t||c)(g(h),g(M),g(R))},c.\u0275cmp=u({type:c,selectors:[["app-pago-retorno"]],decls:7,vars:2,consts:[["color","primary"],[1,"ion-padding"],["class","ion-text-center",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center"],["name","crescent","color","primary"],[1,"ion-margin-top"],[1,"ion-text-center",3,"color"],["expand","block","color","medium","routerLink","/home"]],template:function(t,d){t&1&&(r(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),n(3,"Pago WebPay"),e()()(),r(4,"ion-content",1),x(5,U,4,1,"div",2)(6,H,8,3,"div",3),e()),t&2&&(i(5),l("ngIf",d.loading),i(),l("ngIf",!d.loading))},dependencies:[P,C,J,v,y,E,S,k,w,j,z,A,N,T,O,I],styles:['@charset "UTF-8";[_nghost-%COMP%]{color-scheme:light;--rb-primary: #2563eb;--rb-primary-10: rgba(37, 99, 235, .1);--rb-primary-20: rgba(37, 99, 235, .2);--rb-bg: #f8fafc;--rb-text: #0f172a;--ion-background-color: var(--rb-bg);--ion-text-color: var(--rb-text)}.rb-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--rb-primary), #60a5fa);--color: #fff;--border-color: transparent}.webpay[_ngcontent-%COMP%]{text-align:center}.webpay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--rb-text)}ion-card.card[_ngcontent-%COMP%]{background:#fff!important;border-radius:18px;border:1px solid rgba(2,6,23,.06);box-shadow:0 10px 26px #02061714;overflow:hidden;text-align:left}ion-card.card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid rgba(2,6,23,.06)}ion-card.card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-weight:800;color:var(--rb-text)}ion-card.card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding-top:12px}ion-card.card[color=success][_ngcontent-%COMP%]{border-left:6px solid #16a34a}ion-card.card[color=danger][_ngcontent-%COMP%]{border-left:6px solid #ef4444}.status-row[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin-bottom:10px}.status-row[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{--background: var(--rb-primary-10);--color: var(--rb-text);--border-color: var(--rb-primary-20)}.kv[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:6px 0}.kv[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#334155}.loading-box[_ngcontent-%COMP%]{display:grid;place-items:center;gap:.5rem;min-height:35vh}.spinner[_ngcontent-%COMP%]{filter:drop-shadow(0 6px 16px rgba(37,99,235,.25))}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_popIn{0%{opacity:0;transform:scale(.98)}to{opacity:1;transform:scale(1)}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .28s ease-out both}.pop-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_popIn .22s ease-out both}.slide-up[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideUp .25s ease-out .05s both}ion-button[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 10px 18px var(--rb-primary-10);--padding-start: 14px;--padding-end: 14px}.md[_ngcontent-%COMP%]   ion-card.card[_ngcontent-%COMP%]{text-align:left}.ios[_ngcontent-%COMP%]   ion-card.card[_ngcontent-%COMP%]{text-align:left}']});let o=c;return o})();export{tt as PagoRetornoPage};
