import{a as de}from"./chunk-GC4IB6VA.js";import{a as fe}from"./chunk-CL4KBMSP.js";import{c as O}from"./chunk-SIZNMXVG.js";import{a as w}from"./chunk-TX5AFJTF.js";import"./chunk-66QFWZLQ.js";import{$a as le,A as c,Ca as ee,Na as te,P as H,Ra as ne,S as Z,Sa as ie,T as z,U as J,Va as oe,Wa as re,X as $,Xa as ae,Ya as ce,Z as K,Za as se,_ as S,aa as Y,b as j,ba as T,c as F,d as A,e as G,f,g as d,i as s,j as b,k as W,l as M,lb as me,m as I,mb as pe,n as q,nb as ue,o as l,p as r,q as a,r as m,tb as _e,u as g,v as h,va as Q,vb as k,w as p,wa as X}from"./chunk-H7HGEQUX.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as v}from"./chunk-VI73JOY6.js";var y=(()=>{let n=class n{constructor(i){this.router=i}canActivate(i){return v(this,null,function*(){let t=i.data?.roles??[],{data:{session:u}}=yield w.auth.getSession();if(!u){let _=localStorage.getItem("rb_usuario_activo");if(_)try{let x=JSON.parse(_);return t.length?x?.rol?t.includes(x.rol)?!0:(this.router.navigate(["/home"]),!1):(this.router.navigate(["/auth/login"]),!1):!0}catch{return this.router.navigate(["/auth/login"]),!1}return this.router.navigate(["/auth/login"]),!1}if(!t.length)return!0;let{data:P,error:C}=yield w.from("usuario").select("rol").eq("id_auth",u.user.id).maybeSingle();if(C||!P?.rol){console.warn("No se pudo obtener rol desde Supabase, intentando perfil local:",C);let _=localStorage.getItem("rb_usuario_activo");if(_)try{let x=JSON.parse(_);return x?.rol?t.includes(x.rol)?!0:(this.router.navigate(["/home"]),!1):(this.router.navigate(["/auth/login"]),!1)}catch{return this.router.navigate(["/auth/login"]),!1}return console.error("Error al obtener perfil o rol no definido:",C),this.router.navigate(["/auth/login"]),!1}return t.includes(P.rol)?!0:(console.warn(`\u26D4 Acceso denegado. Rol actual: ${P.rol}, Roles permitidos: ${t.join(", ")}`),this.router.navigate(["/home"]),!1)})}};n.\u0275fac=function(t){return new(t||n)(G(S))},n.\u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();var xe=[{path:"",redirectTo:"auth/login",pathMatch:"full"},{path:"auth/login",loadComponent:()=>import("./chunk-PZQCGPLT.js").then(e=>e.LoginPage)},{path:"auth/register",loadComponent:()=>import("./chunk-6IQUOQEE.js").then(e=>e.RegisterPage)},{path:"solicitar",canActivate:[y],loadComponent:()=>import("./chunk-P73VUZVE.js").then(e=>e.SolicitarCertificadoPage)},{path:"pago-retorno",loadComponent:()=>import("./chunk-IHLHM3WA.js").then(e=>e.PagoRetornoPage)},{path:"noticias/crear",loadComponent:()=>import("./chunk-YDTY7J6J.js").then(e=>e.CrearNoticiaPage)},{path:"noticias/:id",loadComponent:()=>import("./chunk-MCEUNLAR.js").then(e=>e.DetalleNoticiaPage)},{path:"votacion/:id",canActivate:[y],loadComponent:()=>import("./chunk-2KJU6PEU.js").then(e=>e.VotacionPage)},{path:"votaciones",loadComponent:()=>import("./chunk-E5WIX7OV.js").then(e=>e.VotacionesListPage)},{path:"solicitud",loadComponent:()=>import("./chunk-PSYLWIGS.js").then(e=>e.SolicitudPage)},{path:"perfil",canActivate:[y],loadComponent:()=>import("./chunk-HWDUELFD.js").then(e=>e.PerfilPage)},{path:"generar/proyecto",canActivate:[y],data:{roles:["administrador"]},loadComponent:()=>import("./chunk-F774RFKO.js").then(e=>e.GenerarProyectoComponent)},{path:"espacios",loadComponent:()=>import("./chunk-SWB5QIC5.js").then(e=>e.EspaciosPage)},{path:"espacio/crear",canActivate:[y],loadComponent:()=>import("./chunk-DDBMIMAJ.js").then(e=>e.CrearEspacioPage)},{path:"espacios/:id",loadComponent:()=>import("./chunk-RMOZ67VV.js").then(e=>e.DetalleEspacioPage)},{path:"generar/votacion",canActivate:[y],data:{roles:["administrador"]},loadComponent:()=>import("./chunk-2PPIJAUV.js").then(e=>e.GenerarVotacionPage)},{path:"auth/recuperar-contrasena",loadComponent:()=>import("./chunk-4SYYUXA3.js").then(e=>e.UpdatePasswordPage)},{path:"inscripcion",children:[{path:"proyectos",loadComponent:()=>import("./chunk-7WLAJ6I3.js").then(e=>e.ProyectosPage)},{path:"inscripcion-proyecto/:id",loadComponent:()=>import("./chunk-YHQVC2HC.js").then(e=>e.InscripcionProyectoComponent)}]},{path:"home",canActivate:[y],loadComponent:()=>import("./chunk-6PY3GIBR.js").then(e=>e.HomePage)},{path:"**",redirectTo:"auth/login"}],ge=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=M({type:n}),n.\u0275inj=A({imports:[T.forRoot(xe,{preloadingStrategy:Y}),T]});let e=n;return e})();var U=(function(e){return e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT",e})(U||{});var V=O("StatusBar");var R=O("App",{web:()=>import("./chunk-5NLA6BLV.js").then(e=>new e.AppWeb)});function ve(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){f(o);let t=p(2);return d(t.go("/home"))}),m(1,"ion-icon",15),r(2,"ion-label"),c(3,"Inicio"),a()()}}function we(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){f(o);let t=p(2);return d(t.go("/solicitar"))}),m(1,"ion-icon",16),r(2,"ion-label"),c(3,"Solicitar certificado"),a()()}}function ye(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){f(o);let t=p(2);return d(t.go("/votaciones"))}),m(1,"ion-icon",17),r(2,"ion-label"),c(3,"Votaciones"),a()()}}function Pe(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){f(o);let t=p(2);return d(t.go("/inscripcion/proyectos"))}),m(1,"ion-icon",17),r(2,"ion-label"),c(3,"Inscribirse a proyecto/Actividad"),a()()}}function be(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){f(o);let t=p(2);return d(t.go("/solicitud"))}),m(1,"ion-icon",18),r(2,"ion-label"),c(3,"Arrendar espacio"),a()()}}function Ae(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){f(o);let t=p(2);return d(t.go("/espacios"))}),m(1,"ion-icon",19),r(2,"ion-label"),c(3,"Espacios Comunitarios"),a()()}}function Me(e,n){e&1&&(r(0,"ion-list-header"),c(1,"Administraci\xF3n"),a())}function Ie(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){f(o);let t=p(2);return d(t.go("/generar/proyecto"))}),m(1,"ion-icon",20),r(2,"ion-label"),c(3,"Generar proyecto"),a()()}}function Se(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){f(o);let t=p(2);return d(t.go("/generar/votacion"))}),m(1,"ion-icon",21),r(2,"ion-label"),c(3,"Generar votaci\xF3n"),a()()}}function ke(e,n){if(e&1){let o=g();r(0,"ion-item",14),h("click",function(){f(o);let t=p(2);return d(t.go("/noticias/crear"))}),m(1,"ion-icon",21),r(2,"ion-label"),c(3,"Generar noticia"),a()()}}function Oe(e,n){if(e&1){let o=g();r(0,"ion-item",22),h("click",function(){f(o);let t=p(2);return d(t.go("/perfil"))}),m(1,"ion-icon",23),r(2,"ion-label"),c(3,"Mi perfil"),a()()}}function Ve(e,n){if(e&1){let o=g();r(0,"ion-menu",2)(1,"ion-header",3)(2,"ion-toolbar")(3,"ion-title"),c(4,"Men\xFA"),a()()(),r(5,"ion-content",4)(6,"ion-list",5)(7,"ion-menu-toggle",6),I(8,ve,4,0,"ion-item",7)(9,we,4,0,"ion-item",7)(10,ye,4,0,"ion-item",7)(11,Pe,4,0,"ion-item",7)(12,be,4,0,"ion-item",7)(13,Ae,4,0,"ion-item",7)(14,Me,2,0,"ion-list-header",8)(15,Ie,4,0,"ion-item",7)(16,Se,4,0,"ion-item",7)(17,ke,4,0,"ion-item",7),a()(),r(18,"div",9),I(19,Oe,4,0,"ion-item",10),a(),r(20,"div",11)(21,"ion-item",12),h("click",function(){f(o);let t=p();return d(t.salir())}),m(22,"ion-icon",13),r(23,"ion-label"),c(24,"Cerrar sesi\xF3n"),a()()()()()}if(e&2){let o=p();s(8),l("ngIf",!o.isActive("/home")),s(),l("ngIf",!o.isActive("/solicitar")),s(),l("ngIf",!o.isActive("/votaciones")),s(),l("ngIf",!o.isActive("/inscripcion/proyectos")),s(),l("ngIf",!o.isActive("/solicitud")),s(),l("ngIf",!o.isActive("/espacios")),s(),l("ngIf",o.isAdmin),s(),l("ngIf",o.isAdmin&&!o.isActive("/generar/proyecto")),s(),l("ngIf",o.isAdmin&&!o.isActive("/generar/votacion")),s(),l("ngIf",o.isAdmin&&!o.isActive("/noticias/crear")),s(2),l("ngIf",!o.isActive("/perfil"))}}var L=(()=>{let n=class n{constructor(i,t,u,P,C){this.router=i,this.menu=t,this.auth=u,this.platform=P,this.ngZone=C,this.currentUrl="",this.isAdmin=!1,this.currentUrl=this.router.url||"",this.refrescarRol(),this.platform.ready().then(()=>v(this,null,function*(){yield this.configurarStatusBar(),n._deepLinkInit||(this.setupDeepLinks(),n._deepLinkInit=!0)})),this.router.events.pipe(j(_=>_ instanceof $)).subscribe(_=>v(this,null,function*(){this.currentUrl=_.urlAfterRedirects||_.url||"",yield this.refrescarRol()}))}get isAuth(){return this.currentUrl.startsWith("/auth")}isActive(i){return this.currentUrl?this.currentUrl===i||this.currentUrl.startsWith(i+"/"):!1}go(i){return v(this,null,function*(){try{(yield this.menu.isOpen("mainMenu"))&&(yield this.menu.close("mainMenu"))}catch{}yield this.router.navigateByUrl(i)})}salir(){return v(this,null,function*(){try{yield this.auth.signOut(),this.isAdmin=!1}finally{try{(yield this.menu.isOpen("mainMenu"))&&(yield this.menu.close("mainMenu"))}catch{}yield this.router.navigateByUrl("/auth/login",{replaceUrl:!0})}})}refrescarRol(){return v(this,null,function*(){try{if(this.isAuth){this.isAdmin=!1;return}let{data:{user:i}}=yield w.auth.getUser();if(!i){this.isAdmin=!1;return}let{data:t,error:u}=yield w.from("usuario").select("rol").eq("user_id",i.id).maybeSingle();if(u){this.isAdmin=!1;return}this.isAdmin=t?.rol==="administrador"}catch{this.isAdmin=!1}})}configurarStatusBar(){return v(this,null,function*(){try{yield V.setOverlaysWebView({overlay:!1}),yield V.setBackgroundColor({color:"#000000"}),yield V.setStyle({style:U.Dark})}catch{}})}setupDeepLinks(){R.getLaunchUrl().then(i=>{i?.url&&this.handleUrl(i.url)}),R.addListener("appUrlOpen",i=>{i?.url&&this.handleUrl(i.url)})}handleUrl(i){return v(this,null,function*(){try{let t=new URL(i);if(t.protocol==="redbarrio:"&&t.host==="app"&&t.pathname.startsWith("/pago-retorno")||t.protocol==="capacitor:"&&t.host==="localhost"&&t.pathname==="/pago-retorno"){let u=t.searchParams.get("token_ws")||"";try{yield de.close()}catch{}this.ngZone.run(()=>{this.router.navigate(["/pago-retorno"],{queryParams:{token_ws:u},replaceUrl:!0})});return}if(t.protocol==="myapp:"&&t.host==="auth"){let u=t.searchParams,P=new URLSearchParams(t.hash?.startsWith("#")?t.hash.slice(1):t.hash),C=B=>u.get(B)??P.get(B),_=C("type"),x=C("access_token"),N=C("refresh_token"),D=C("code");_==="recovery"&&x&&N?yield w.auth.setSession({access_token:x,refresh_token:N}):D?yield w.auth.exchangeCodeForSession(D):console.warn("Deep link sin tokens ni code. No se pudo establecer sesi\xF3n."),this.ngZone.run(()=>{this.router.navigateByUrl("/auth/recuperar-contrasena",{replaceUrl:!0})});return}}catch(t){console.error("Deep link parse error",t)}})}};n._deepLinkInit=!1,n.\u0275fac=function(t){return new(t||n)(b(S),b(_e),b(fe),b(Q),b(q))},n.\u0275cmp=W({type:n,selectors:[["app-root"]],decls:3,vars:1,consts:[["side","start","menuId","mainMenu","contentId","main-content","type","reveal",4,"ngIf"],["id","main-content"],["side","start","menuId","mainMenu","contentId","main-content","type","reveal"],[1,"menu-header"],[1,"menu-content"],["lines","none",1,"menu-list"],["auto-hide","true"],["button","","detail","false",3,"click",4,"ngIf"],[4,"ngIf"],[1,"perfil-wrap"],["button","","detail","false","class","perfil",3,"click",4,"ngIf"],[1,"logout-wrap"],["button","","detail","false",1,"logout",3,"click"],["slot","start","name","log-out-outline"],["button","","detail","false",3,"click"],["slot","start","name","home-outline"],["slot","start","name","document-text-outline"],["slot","start","name","people-outline"],["slot","start","name","calendar-outline"],["slot","start","name","business-outline"],["slot","start","name","construct-outline"],["slot","start","name","list-circle-outline"],["button","","detail","false",1,"perfil",3,"click"],["slot","start","name","person-circle-outline"]],template:function(t,u){t&1&&(r(0,"ion-app"),I(1,Ve,25,11,"ion-menu",0),m(2,"ion-router-outlet",1),a()),t&2&&(s(),l("ngIf",!u.isAuth))},dependencies:[Z,H,k,ee,te,ne,ie,oe,re,ae,ce,se,le,me,pe,ue],styles:['@charset "UTF-8";ion-header[_ngcontent-%COMP%], ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{position:relative;z-index:1000;pointer-events:auto;--min-height: 56px}ion-menu[type=reveal][_ngcontent-%COMP%]::part(backdrop){opacity:0;pointer-events:none}ion-menu[_ngcontent-%COMP%]::part(container){box-shadow:0 8px 24px #0206173d;border-right:1px solid rgba(2,6,23,.06)}.menu-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #2563eb, #60a5fa);--color: #fff}.menu-content[_ngcontent-%COMP%]{--background: #f8fafc}.menu-content[_ngcontent-%COMP%]   .menu-list[_ngcontent-%COMP%]{background:transparent;padding:6px 0}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin:8px 6px;border-radius:14px;background:#fff;--background: #fff;border:1px solid rgba(37,99,235,.1);transition:transform .12s ease,box-shadow .12s ease,border-color .12s ease}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#2563eb;font-size:20px}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:600;color:#0f172a}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:active{transform:translateY(1px)}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:focus-within, .menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:hover{border-color:#2563eb33;box-shadow:0 8px 18px #2563eb1a}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]{margin-top:auto;padding-top:8px}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]{background:#fff5f5;border-color:#ef444433}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#ef4444}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:#b91c1c}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]:hover{box-shadow:0 8px 18px #ef44441f}']});let e=n;return e})();var he=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=M({type:n,bootstrap:[L]}),n.\u0275inj=A({providers:[{provide:K,useClass:X}],imports:[J,k.forRoot(),ge,L]});let e=n;return e})();z().bootstrapModule(he).catch(e=>console.log(e));
