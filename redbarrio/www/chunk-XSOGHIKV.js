import{a as be}from"./chunk-CATCBSYX.js";import{a as fe}from"./chunk-CL4KBMSP.js";import{c as ge}from"./chunk-SIZNMXVG.js";import{a as v}from"./chunk-TX5AFJTF.js";import{a as ue}from"./chunk-66QFWZLQ.js";import{A as i,D as E,Ea as $,Fa as U,Ga as V,Ha as H,Ia as L,Ja as z,Ka as J,Na as K,O as y,Oa as W,P as I,Ra as Q,S as k,Ua as X,Va as Y,Wa as Z,_ as D,_a as ee,ab as te,bb as oe,ca as g,cb as ne,da as F,ea as T,gb as ie,hb as re,i as m,j as d,ja as N,k as S,kb as ae,la as R,lb as ce,m as x,mb as se,o as u,oa as j,p as o,q as e,r as l,rb as de,sa as A,sb as le,ua as B,ub as pe,v as O,vb as me,ya as q,za as G}from"./chunk-H7HGEQUX.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as f}from"./chunk-VI73JOY6.js";var _e=ge("Browser",{web:()=>import("./chunk-S6OH65FZ.js").then(r=>new r.BrowserWeb)});function ve(r,c){if(r&1&&(o(0,"ion-select-option",21),i(1),e()),r&2){let C=c.$implicit;u("value",C.id_espacio),m(),E(" ",C.nombre," \u2014 ",C.tipo||"General"," ")}}function Ce(r,c){r&1&&(o(0,"ion-note",22),i(1," No hay espacios disponibles por ahora. "),e())}var Be=(()=>{let c=class c{constructor(t,a,n,p,s,_,b){this.fb=t,this.espaciosService=a,this.authService=n,this.alertCtrl=p,this.toastCtrl=s,this.loadingCtrl=_,this.router=b,this.espaciosDisponibles=[],this.solicitudForm=this.fb.group({id_espacio:["",g.required],descripcion:[""],evento_titulo:["",g.required],evento_descripcion:["",g.required],evento_inicio:["",g.required],evento_fin:["",g.required]})}ngOnInit(){return f(this,null,function*(){yield this.cargarEspaciosDisponibles()})}cargarEspaciosDisponibles(){return f(this,null,function*(){try{let t=yield this.espaciosService.obtenerEspacios();this.espaciosDisponibles=t||[]}catch(t){console.error("Error cargando espacios:",t),this.espaciosDisponibles=[]}})}enviarSolicitud(){return f(this,null,function*(){if(this.solicitudForm.invalid)return;let t=this.solicitudForm.value,n=(yield this.authService.session())?.user?.id||null;if(!n){this.mostrarAlerta("Error","No se pudo obtener el usuario autenticado.");return}let p=yield this.loadingCtrl.create({message:"Procesando solicitud...",spinner:"crescent"});yield p.present();try{let{data:s,error:_}=yield v.from("evento").insert([{titulo:t.evento_titulo,descripcion:t.evento_descripcion,fecha_inicio:t.evento_inicio,fecha_fin:t.evento_fin}]).select().single();if(_)throw _;let b=Number(t.id_espacio),{data:he,error:P}=yield v.from("reserva").insert([{id_espacio:b,id_evento:s.id_evento,id_auth:n,fecha:new Date().toISOString(),creado_en:new Date().toISOString()}]).select().single();if(P)throw P;let{data:xe,error:M}=yield v.from("orden_pago").insert([{id_auth:n,id_evento:s.id_evento,id_espacio:b,monto:1500,estado:"pendiente",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(M)throw M;let w=yield fetch(`${ue.supabaseUrl}/functions/v1/transbank-simular`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_reserva:he.id_reserva,monto:1500,descripcion:`Pago arriendo espacio #${b}`})});if(!w.ok)throw new Error("Error al iniciar simulaci\xF3n de pago");let h=yield w.json();if(h.url&&h.token)yield _e.open({url:`${h.url}?token_ws=${h.token}`,presentationStyle:"fullscreen"});else throw new Error("No se recibi\xF3 token o URL de Transbank.");yield p.dismiss()}catch(s){console.error("Error al enviar solicitud:",s),yield p.dismiss(),this.mostrarAlerta("Error","No se pudo completar la reserva ni el pago.")}})}mostrarAlerta(t,a){return f(this,null,function*(){yield(yield this.alertCtrl.create({header:t,message:a,buttons:["OK"]})).present()})}mostrarToast(t){return f(this,null,function*(){(yield this.toastCtrl.create({message:t,duration:2500,color:"success"})).present()})}};c.\u0275fac=function(a){return new(a||c)(d(A),d(be),d(fe),d(de),d(pe),d(le),d(D))},c.\u0275cmp=S({type:c,selectors:[["app-solicitud"]],decls:47,vars:5,consts:[[1,"rb-header"],["slot","start"],["menu","mainMenu","autoHide","false"],[1,"ion-padding","reserva",3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["pullingText","Desliza para refrescar","refreshingSpinner","crescent","refreshingText","Actualizando..."],[1,"card"],[3,"ngSubmit","formGroup"],[1,"field"],["position","stacked"],["formControlName","id_espacio","interface","popover","placeholder","Elige un espacio disponible"],[3,"value",4,"ngFor","ngForOf"],["color","medium",4,"ngIf"],["formControlName","descripcion","placeholder","Agrega una nota o detalle (opcional)"],["formControlName","evento_titulo","placeholder","Ej: Campeonato de f\xFAtbol"],["formControlName","evento_descripcion","placeholder","Describe el evento"],[1,"grid-2"],["formControlName","evento_inicio","presentation","date-time","minute-values","0,15,30,45"],["formControlName","evento_fin","presentation","date-time","minute-values","0,15,30,45"],[1,"actions"],["expand","block","type","submit","color","success",3,"disabled"],[3,"value"],["color","medium"]],template:function(a,n){a&1&&(o(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),l(3,"ion-menu-button",2),e(),o(4,"ion-title"),i(5,"Reserva de Espacio/Terreno"),e()()(),o(6,"ion-content",3)(7,"ion-refresher",4),O("ionRefresh",function(s){return n.cargarEspaciosDisponibles(),s.target.complete()}),l(8,"ion-refresher-content",5),e(),o(9,"ion-card",6)(10,"ion-card-header")(11,"ion-card-title"),i(12,"Formulario de Reserva"),e(),o(13,"ion-card-subtitle"),i(14,"Completa los datos para solicitar un espacio"),e()(),o(15,"ion-card-content")(16,"form",7),O("ngSubmit",function(){return n.enviarSolicitud()}),o(17,"ion-item",8)(18,"ion-label",9),i(19,"Selecciona un Espacio"),e(),o(20,"ion-select",10),x(21,ve,2,3,"ion-select-option",11),e()(),x(22,Ce,2,0,"ion-note",12),o(23,"ion-item",8)(24,"ion-label",9),i(25,"Descripci\xF3n / Comentario"),e(),l(26,"ion-textarea",13),e(),o(27,"ion-item",8)(28,"ion-label",9),i(29,"T\xEDtulo del Evento"),e(),l(30,"ion-input",14),e(),o(31,"ion-item",8)(32,"ion-label",9),i(33,"Descripci\xF3n del Evento"),e(),l(34,"ion-textarea",15),e(),o(35,"div",16)(36,"ion-item",8)(37,"ion-label",9),i(38,"Fecha de Inicio"),e(),l(39,"ion-datetime",17),e(),o(40,"ion-item",8)(41,"ion-label",9),i(42,"Fecha de T\xE9rmino"),e(),l(43,"ion-datetime",18),e()(),o(44,"div",19)(45,"ion-button",20),i(46," \u{1F4B3} Reservar Espacio "),e()()()()()()),a&2&&(m(6),u("fullscreen",!0),m(10),u("formGroup",n.solicitudForm),m(5),u("ngForOf",n.espaciosDisponibles),m(),u("ngIf",(n.espaciosDisponibles==null?null:n.espaciosDisponibles.length)===0),m(23),u("disabled",n.solicitudForm.invalid))},dependencies:[k,y,I,me,$,U,V,H,L,z,J,K,W,Q,X,Y,Z,ee,te,oe,ne,ie,re,ae,ce,se,q,G,B,N,F,T,R,j],styles:['@charset "UTF-8";[_nghost-%COMP%]{color-scheme:light;--rb-primary: #2563eb;--rb-primary-10: rgba(37, 99, 235, .1);--rb-primary-20: rgba(37, 99, 235, .2);--rb-bg: #f8fafc;--rb-text: #0f172a;--ion-background-color: var(--rb-bg);--ion-text-color: var(--rb-text)}.rb-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--rb-primary), #60a5fa);--color: #fff;--border-color: transparent}ion-card.card[_ngcontent-%COMP%]{background:#fff;border-radius:18px;border:1px solid rgba(2,6,23,.06);box-shadow:0 10px 26px #02061714;overflow:hidden}ion-card.card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid rgba(2,6,23,.06)}ion-card.card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-weight:800;color:var(--rb-text)}ion-card.card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#64748b;font-weight:500}ion-card.card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding-top:12px}ion-card.card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{margin-bottom:8px;--color: var(--rb-text);--background: var(--rb-primary-10);--border-color: var(--rb-primary-20)}.field[_ngcontent-%COMP%]{--background: #fff;background:#fff;border-radius:14px;margin:10px 6px;border:1px solid rgba(2,6,23,.06);box-shadow:0 6px 14px #0206170f}.field[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:700;color:var(--rb-text)}.grid-2[_ngcontent-%COMP%]{display:grid;gap:10px;grid-template-columns:1fr}@media (min-width: 640px){.grid-2[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}.actions[_ngcontent-%COMP%]{margin-top:12px;padding:0 6px}.actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 10px 18px var(--rb-primary-10);--padding-start: 14px;--padding-end: 14px}.ios[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{--padding-start: 12px;--inner-padding-end: 12px}ion-datetime[_ngcontent-%COMP%]{--background: #ffffff !important;--color: var(--rb-text) !important;--title-color: var(--rb-text) !important;--wheel-background: #ffffff !important;--wheel-color: var(--rb-text) !important;--wheel-highlight-background: rgba(37, 99, 235, .1) !important;--wheel-highlight-border-radius: 12px;border-radius:14px;box-shadow:inset 0 0 0 1px #0206170f;--button-color: var(--rb-primary);--button-background-selected: rgba(37, 99, 235, .08)}ion-datetime[_ngcontent-%COMP%]::part(calendar-body), ion-datetime[_ngcontent-%COMP%]::part(time-body){background:#fff!important;color:var(--rb-text)!important}ion-datetime[_ngcontent-%COMP%]::part(title){color:var(--rb-text)!important;font-weight:800}ion-datetime[_ngcontent-%COMP%]::part(calendar-month-year), ion-datetime[_ngcontent-%COMP%]::part(month-year-button){color:var(--rb-text)!important}ion-datetime[_ngcontent-%COMP%]::part(calendar-day), ion-datetime[_ngcontent-%COMP%]::part(time-button){color:var(--rb-text)!important;background:#fff!important}ion-datetime[_ngcontent-%COMP%]::part(calendar-day-inner){border-radius:10px}ion-datetime[_ngcontent-%COMP%]::part(calendar-day-today){outline:2px solid rgba(37,99,235,.25);outline-offset:2px;border-radius:10px}ion-datetime[_ngcontent-%COMP%]::part(calendar-day-active){background:#2563eb24!important;color:#0b2b77!important;border-radius:10px}ion-datetime[_ngcontent-%COMP%]::part(wheel-item){color:var(--rb-text)!important;background:#fff!important}ion-datetime[_ngcontent-%COMP%]::part(wheel-item active){background:#2563eb1a!important;border-radius:12px}.field[_ngcontent-%COMP%]   ion-datetime[_ngcontent-%COMP%]{background:#fff!important}.reserva[_ngcontent-%COMP%]   ion-popover[_ngcontent-%COMP%]{--background: #ffffff !important;--box-shadow: 0 10px 26px rgba(2, 6, 23, .12);--backdrop-opacity: .18;--color: var(--rb-text)}.reserva[_ngcontent-%COMP%]   ion-popover[_ngcontent-%COMP%]::part(content){background:#fff!important;color:var(--rb-text)!important;border-radius:14px!important}.reserva[_ngcontent-%COMP%]   ion-modal[_ngcontent-%COMP%]{--background: #ffffff !important;--backdrop-opacity: .18;--box-shadow: 0 10px 26px rgba(2, 6, 23, .12)}.reserva[_ngcontent-%COMP%]   ion-modal[_ngcontent-%COMP%]::part(content){background:#fff!important;color:var(--rb-text)!important;border-radius:16px!important}.md[_ngcontent-%COMP%]   ion-datetime[_ngcontent-%COMP%]{--color: #0f172a !important;--background: #ffffff !important}.dark[_nghost-%COMP%], .dark[_nghost-%COMP%], .dark   [_nghost-%COMP%]{color-scheme:light;--ion-background-color: var(--rb-bg);--ion-text-color: var(--rb-text)}']});let r=c;return r})();export{Be as SolicitudPage};
