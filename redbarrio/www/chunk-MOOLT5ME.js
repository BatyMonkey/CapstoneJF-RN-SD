import{a as de}from"./chunk-4247AXEV.js";import"./chunk-IIFLUBAB.js";import"./chunk-SIZNMXVG.js";import{a as le}from"./chunk-BSJEIMOO.js";import"./chunk-CGH6KSUE.js";import{B as y,D as u,Da as N,E as f,Ea as z,F as h,Fa as L,Ga as j,Ha as A,Ia as H,Ja as R,Ma as Q,N as k,Na as Y,O as E,Qa as q,R as T,Ra as J,Ta as K,Ua as X,Va as Z,Wa as $,Z as V,Za as ee,aa as F,ca as D,f as b,g as M,h as I,ha as G,hb as ne,i as a,ib as te,j as O,jb as ie,k as S,kb as oe,lb as re,m as C,n as s,o,p as i,q as _,sa as W,t as w,tb as ae,u as x,ub as ce,v as m,xa as U,ya as B,z as d}from"./chunk-JZTRD5FY.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as P}from"./chunk-VI73JOY6.js";function ge(l,g){if(l&1){let r=w();o(0,"ion-button",31),x("click",function(){b(r);let n=m().index,e=m();return M(e.removeImage(n))}),d(1," Quitar foto "),i()}if(l&2){let r=m(2);s("disabled",r.loading)}}function pe(l,g){if(l&1&&(o(0,"div",32),_(1,"img",33),i()),l&2){let r=m().$implicit;a(),s("src",r.previewDataUrl||r.image_url,I)}}function me(l,g){if(l&1){let r=w();o(0,"ion-item",20)(1,"ion-label",7),d(2,"T\xEDtulo de la opci\xF3n"),i(),o(3,"ion-input",21),h("ngModelChange",function(n){let e=b(r).$implicit;return f(e.titulo,n)||(e.titulo=n),M(n)}),i(),o(4,"ion-label",22),d(5,"Descripci\xF3n"),i(),o(6,"ion-textarea",23),h("ngModelChange",function(n){let e=b(r).$implicit;return f(e.descripcion,n)||(e.descripcion=n),M(n)}),i(),o(7,"div",24)(8,"ion-button",25),x("click",function(){let n=b(r).index,e=m();return M(e.pickImage(n))}),_(9,"ion-icon",26),d(10," Agregar / cambiar foto "),i(),C(11,ge,2,1,"ion-button",27),i(),C(12,pe,2,1,"div",28),o(13,"ion-button",29),x("click",function(){let n=b(r).index,e=m();return M(e.removeOpcion(n))}),_(14,"ion-icon",30),i()()}if(l&2){let r=g.$implicit,t=m();a(3),u("ngModel",r.titulo),a(3),u("ngModel",r.descripcion),a(2),s("disabled",t.loading),a(3),s("ngIf",r.previewDataUrl||r.image_url),a(),s("ngIf",r.previewDataUrl||r.image_url),a(),s("disabled",t.opciones.length<=2||t.loading)}}function _e(l,g){if(l&1&&(o(0,"ion-text",34),d(1),i()),l&2){let r=m();a(),y(" ",r.errorMsg," ")}}function ue(l,g){l&1&&_(0,"ion-spinner",1)}var Ie=(()=>{let g=class g{constructor(t,n,e){this.votosSvc=t,this.toast=n,this.router=e,this.loading=!1,this.errorMsg="",this.titulo="",this.descripcion="",this.fechaInicio="",this.fechaFin="",this.opciones=[{titulo:""},{titulo:""}]}ngOnInit(){let t=new Date,n=new Date(t.getTime()+48*3600*1e3);this.fechaInicio=t.toISOString(),this.fechaFin=n.toISOString()}ionViewWillEnter(){}addOpcion(){this.opciones.push({titulo:""})}removeOpcion(t){this.opciones.length>2&&this.opciones.splice(t,1)}pickImage(t){return P(this,null,function*(){try{let{blob:n,ext:e,previewDataUrl:p}=yield this.votosSvc.pickPhoto();this.opciones[t]._blob=n,this.opciones[t]._ext=e,this.opciones[t].previewDataUrl=p}catch(n){this.errorMsg=n?.message||"No se pudo obtener la imagen",yield this.presentToast(this.errorMsg,"danger")}})}removeImage(t){this.opciones[t]._blob=void 0,this.opciones[t]._ext=void 0,this.opciones[t].previewDataUrl=void 0,this.opciones[t].image_url=void 0}get puedeGuardar(){let t=(this.titulo??"").trim(),n=this.opciones.map(v=>(v.titulo??"").trim()).filter(v=>v.length>0),e=new Set(n),p=new Date(this.fechaInicio).getTime(),c=new Date(this.fechaFin).getTime(),se=!!this.fechaInicio&&!!this.fechaFin&&Number.isFinite(p)&&Number.isFinite(c)&&p<c;return t.length>0&&se&&n.length>=2&&n.length===e.size}guardar(){return P(this,null,function*(){if(this.puedeGuardar){this.loading=!0,this.errorMsg="";try{let{data:t}=yield le.auth.getUser(),n=t?.user?.id||null;if(!n)throw new Error("Debes iniciar sesi\xF3n");for(let e of this.opciones)e._blob&&e._ext&&(e.image_url=yield this.votosSvc.uploadOptionImage(e._blob,e._ext,n),e._blob=void 0,e._ext=void 0);yield this.votosSvc.crearVotacionConOpciones({titulo:this.titulo.trim(),descripcion:this.descripcion?.trim()||void 0,fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,opciones:this.opciones.map(e=>({titulo:(e.titulo??"").trim(),descripcion:e.descripcion??null,image_url:e.image_url??null})).filter(e=>e.titulo.length>0)}),yield this.presentToast("Votaci\xF3n creada correctamente \u2705","success"),yield this.router.navigateByUrl("/votaciones",{replaceUrl:!0})}catch(t){this.errorMsg=t?.message??"No se pudo crear la votaci\xF3n",yield this.presentToast(this.errorMsg,"danger")}finally{this.loading=!1}}})}presentToast(t,n){return P(this,null,function*(){yield(yield this.toast.create({message:t,duration:2500,position:"top",color:n})).present()})}};g.\u0275fac=function(n){return new(n||g)(O(de),O(ae),O(V))},g.\u0275cmp=S({type:g,selectors:[["app-generar-votacion"]],decls:44,vars:11,consts:[[1,"rb-header"],["slot","start"],["menu","mainMenu","autoHide","false"],[1,"ion-padding","crear-votacion",3,"fullscreen"],[1,"card"],["lines","none"],[1,"field"],["position","stacked"],["placeholder","Ej: Prioridades de mejora del barrio",3,"ngModelChange","ngModel"],["autoGrow","true","rows","3","placeholder","Describe brevemente el prop\xF3sito de esta votaci\xF3n",3,"ngModelChange","ngModel"],["presentation","date-time","minute-values","0,15,30,45",3,"ngModelChange","ngModel"],[1,"options-header"],["size","small","fill","outline",3,"click","disabled"],["name","add-outline","slot","start"],[1,"options"],["class","field option op-card",4,"ngFor","ngForOf"],["color","danger","style","display:block; margin-top:8px;",4,"ngIf"],[1,"actions"],["expand","block",3,"click","disabled"],["slot","start",4,"ngIf"],[1,"field","option","op-card"],["placeholder","Ej: Iluminaci\xF3n de calles",3,"ngModelChange","ngModel"],["position","stacked",1,"ion-margin-top"],["autoGrow","true","rows","2","placeholder","Detalle breve de la opci\xF3n",3,"ngModelChange","ngModel"],[1,"ion-margin-top","img-row"],["size","small",3,"click","disabled"],["slot","start","name","image-outline"],["size","small","color","medium","fill","outline",3,"disabled","click",4,"ngIf"],["class","img-box",4,"ngIf"],["slot","end","fill","clear","color","danger","aria-label","Eliminar opci\xF3n",3,"click","disabled"],["name","trash-outline"],["size","small","color","medium","fill","outline",3,"click","disabled"],[1,"img-box"],[2,"width","100%","height","100%","object-fit","cover","border-radius","8px",3,"src"],["color","danger",2,"display","block","margin-top","8px"]],template:function(n,e){n&1&&(o(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),_(3,"ion-menu-button",2),i(),o(4,"ion-title"),d(5,"Crear votaci\xF3n"),i()()(),o(6,"ion-content",3)(7,"ion-card",4)(8,"ion-card-header")(9,"ion-card-title"),d(10,"Nueva votaci\xF3n"),i(),o(11,"ion-card-subtitle"),d(12,"Completa los campos y publica"),i()(),o(13,"ion-card-content")(14,"ion-list",5)(15,"ion-item",6)(16,"ion-label",7),d(17,"T\xEDtulo"),i(),o(18,"ion-input",8),h("ngModelChange",function(c){return f(e.titulo,c)||(e.titulo=c),c}),i()(),o(19,"ion-item",6)(20,"ion-label",7),d(21,"Descripci\xF3n (opcional)"),i(),o(22,"ion-textarea",9),h("ngModelChange",function(c){return f(e.descripcion,c)||(e.descripcion=c),c}),i()(),o(23,"ion-item",6)(24,"ion-label",7),d(25,"Fecha de inicio"),i(),o(26,"ion-datetime",10),h("ngModelChange",function(c){return f(e.fechaInicio,c)||(e.fechaInicio=c),c}),i()(),o(27,"ion-item",6)(28,"ion-label",7),d(29,"Fecha de t\xE9rmino"),i(),o(30,"ion-datetime",10),h("ngModelChange",function(c){return f(e.fechaFin,c)||(e.fechaFin=c),c}),i()(),o(31,"div",11)(32,"h3"),d(33,"Opciones (m\xEDnimo 2, sin repetir)"),i(),o(34,"ion-button",12),x("click",function(){return e.addOpcion()}),_(35,"ion-icon",13),d(36," Agregar opci\xF3n "),i()(),o(37,"div",14),C(38,me,15,6,"ion-item",15),i()(),C(39,_e,2,1,"ion-text",16),o(40,"div",17)(41,"ion-button",18),x("click",function(){return e.guardar()}),C(42,ue,1,0,"ion-spinner",19),d(43),i()()()()()),n&2&&(a(6),s("fullscreen",!0),a(12),u("ngModel",e.titulo),a(4),u("ngModel",e.descripcion),a(4),u("ngModel",e.fechaInicio),a(4),u("ngModel",e.fechaFin),a(4),s("disabled",e.loading),a(4),s("ngForOf",e.opciones),a(),s("ngIf",e.errorMsg),a(2),s("disabled",!e.puedeGuardar||e.loading),a(),s("ngIf",e.loading),a(),y(" ",e.loading?"Creando\u2026":"Crear votaci\xF3n"," "))},dependencies:[ce,N,z,L,j,A,H,R,Q,Y,q,J,K,X,Z,$,ee,ne,te,ie,oe,re,U,B,T,k,E,W,D,G,F],styles:['@charset "UTF-8";[_nghost-%COMP%]{color-scheme:light;--rb-primary: #2563eb;--rb-primary-10: rgba(37, 99, 235, .1);--rb-primary-20: rgba(37, 99, 235, .2);--rb-bg: #f8fafc;--rb-text: #0f172a;--rb-muted: #64748b;--ion-background-color: var(--rb-bg);--ion-text-color: var(--rb-text);--ion-item-background: #ffffff;--ion-card-background: #ffffff}.rb-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--rb-primary), #60a5fa);--color: #fff;--border-color: transparent;--min-height: 56px}.crear-votacion[_ngcontent-%COMP%]{--background: var(--rb-bg)}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{background:#fff;border:1px solid rgba(2,6,23,.06);border-radius:18px;box-shadow:0 10px 26px #02061714;overflow:hidden;margin-bottom:16px}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid rgba(2,6,23,.06)}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-weight:800;color:var(--rb-text)}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:var(--rb-muted);font-weight:500}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{--background: #fff;background:#fff;border:1.5px solid #e2e8f0;border-radius:14px;box-shadow:0 8px 18px #0206170f;--padding-start: 12px;--inner-padding-end: 12px;--inner-padding-top: 12px;--inner-padding-bottom: 12px;--min-height: auto;margin:10px 0;transition:border-color .16s ease,box-shadow .16s ease}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:2px 4px 6px 2px;line-height:1.2;color:#334155;font-weight:700}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]::part(native), .crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]::part(native){color:var(--rb-text);background:#fff;line-height:1.25;font-weight:600;padding:8px 10px 10px}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]::part(native)::placeholder, .crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]::part(native)::placeholder{color:#6b7280;opacity:1}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   ion-datetime[_ngcontent-%COMP%]{--background: #fff;--color: var(--rb-text);--wheel-highlight-background: rgba(37, 99, 235, .08);--wheel-fade-background-rgb: 255,255,255;border-radius:12px}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field.item-has-focus[_ngcontent-%COMP%], .crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]:focus-within{border-color:var(--rb-primary);box-shadow:0 0 0 3px #2563eb24,0 8px 18px #0206170f}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   ion-text[color=danger][_ngcontent-%COMP%]{display:block;margin:4px 6px 0;font-size:.9rem;font-weight:600}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:16px}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 10px 18px var(--rb-primary-10)}.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:active{transform:translateY(1px)}.crear-votacion[_ngcontent-%COMP%]   .options-header[_ngcontent-%COMP%]{margin:14px 2px 8px;display:flex;align-items:center;gap:10px}.crear-votacion[_ngcontent-%COMP%]   .options-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:800;color:var(--rb-text);font-size:16px;letter-spacing:.2px}.crear-votacion[_ngcontent-%COMP%]   .options-header[_ngcontent-%COMP%]   ion-button[fill=outline][_ngcontent-%COMP%]{--border-color: var(--rb-primary-20);--color: var(--rb-primary);--ripple-color: var(--rb-primary);--border-radius: 12px;--box-shadow: 0 6px 14px var(--rb-primary-10)}.crear-votacion[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{position:relative}.crear-votacion[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]   ion-button[slot=end][_ngcontent-%COMP%]{margin-left:8px}.action-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #fff;--border-color: rgba(2, 6, 23, .08);box-shadow:0 -8px 18px #0206170f}.ios[_ngcontent-%COMP%]   ion-item.field[_ngcontent-%COMP%]{--padding-start: 12px;--inner-padding-end: 12px}@media (max-width: 480px){.crear-votacion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{box-shadow:0 6px 12px #0206170d}}',".options[_ngcontent-%COMP%]   .op-card[_ngcontent-%COMP%]{align-items:stretch;--inner-padding-end: 0}.img-row[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.img-box[_ngcontent-%COMP%]{margin-top:.5rem;width:100%;height:160px;border-radius:8px;overflow:hidden;background:#f3f4f6}"]});let l=g;return l})();export{Ie as GenerarVotacionPage};
