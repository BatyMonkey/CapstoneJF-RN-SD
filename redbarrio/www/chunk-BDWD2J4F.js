import{a as Z}from"./chunk-6C47DM3O.js";import{a as v}from"./chunk-3ODY6JMO.js";import{$ as A,$a as Q,Fa as j,Ga as k,Ia as B,Ka as H,La as L,M as w,Ma as K,P as N,Wa as U,Xa as z,Z as a,_ as y,_a as J,ab as W,da as D,eb as X,fa as T,h as p,hb as Y,i as u,ia as q,j as C,l as F,m as f,ma as M,n as i,o as e,oa as P,p as r,ra as O,sa as V,t as x,ta as G,wa as R,y as t}from"./chunk-C6RY7PX2.js";import"./chunk-G4GOZ2R2.js";import"./chunk-3EH7DRQW.js";import"./chunk-QUJFQN2Y.js";import"./chunk-E24K4UEG.js";import"./chunk-LEIZBYT7.js";import"./chunk-UM2WNVGK.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-TVBC6MYV.js";import"./chunk-26CMJVF7.js";import"./chunk-QQBOPM2N.js";import"./chunk-IACAUHTZ.js";import"./chunk-6KZXCEZL.js";import"./chunk-C7E54FQN.js";import"./chunk-ATYZ3M5D.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-Z455EQLB.js";import"./chunk-CKP3SGE2.js";import"./chunk-CIXXGG5D.js";import{j as g}from"./chunk-VI73JOY6.js";function ie(c,l){c&1&&(i(0,"div")(1,"ion-item")(2,"ion-label",7),t(3,"Nombre del Espacio"),e(),r(4,"ion-input",11),e(),i(5,"ion-item")(6,"ion-label",7),t(7,"Tipo de Espacio"),e(),r(8,"ion-input",12),e(),i(9,"ion-item")(10,"ion-label",7),t(11,"Capacidad"),e(),r(12,"ion-input",13),e(),i(13,"ion-item")(14,"ion-label",7),t(15,"T\xEDtulo del Evento"),e(),r(16,"ion-input",14),e(),i(17,"ion-item")(18,"ion-label",7),t(19,"Descripci\xF3n del Evento"),e(),r(20,"ion-textarea",15),e(),i(21,"ion-item")(22,"ion-label"),t(23,"Fecha de Inicio"),e(),r(24,"ion-datetime",16),e(),i(25,"ion-item")(26,"ion-label"),t(27,"Fecha de T\xE9rmino"),e(),r(28,"ion-datetime",17),e()())}var pe=(()=>{let l=class l{constructor(s,o,n){this.fb=s,this.auth=o,this.alertCtrl=n,this.submitting=!1,this.solicitudForm=this.fb.group({tipo:["reserva",a.required],descripcion:[""],espacio_nombre:["",a.required],espacio_tipo:["",a.required],espacio_capacidad:[null,[a.required,a.min(1)]],evento_titulo:["",a.required],evento_descripcion:[""],evento_inicio:["",a.required],evento_fin:["",a.required]})}enviarSolicitud(){return g(this,null,function*(){if(this.solicitudForm.get("tipo")?.value!=="reserva"){yield this.mostrarAlerta("Informaci\xF3n",'Por ahora solo est\xE1 habilitada la opci\xF3n "Reserva de espacio/terreno".');return}if(this.solicitudForm.invalid){yield this.mostrarAlerta("Formulario incompleto","Debes llenar todos los campos obligatorios.");return}let{espacio_nombre:s,espacio_tipo:o,espacio_capacidad:n,evento_titulo:d,evento_descripcion:$,evento_inicio:_,evento_fin:b}=this.solicitudForm.value;if(_&&b&&new Date(b)<new Date(_)){yield this.mostrarAlerta("Fechas inv\xE1lidas","La fecha de t\xE9rmino debe ser posterior a la de inicio.");return}this.submitting=!0;try{let m=yield this.auth.miUID();if(!m){yield this.mostrarAlerta("Sesi\xF3n","Debes iniciar sesi\xF3n para registrar una reserva.");return}let{data:h,error:S}=yield v.from("espacio").insert({nombre:s,tipo:o,capacidad:Number(n)}).select("id_espacio").single();if(S)throw S;let{data:ee,error:E}=yield v.from("evento").insert({titulo:d,descripcion:$,fecha_inicio:_,fecha_fin:b}).select("id_evento").single();if(E)throw E;let{error:I}=yield v.from("reserva").insert({id_auth:m,id_espacio:h.id_espacio,id_evento:ee.id_evento,fecha:new Date().toISOString()});if(I)throw I;yield this.mostrarAlerta("\xC9xito","Tu reserva fue registrada correctamente \u2705"),this.solicitudForm.reset({tipo:"reserva",descripcion:"",espacio_nombre:"",espacio_tipo:"",espacio_capacidad:null,evento_titulo:"",evento_descripcion:"",evento_inicio:"",evento_fin:""})}catch(m){console.error("\u274C Error al crear la reserva:",m);let h=m?.message??(typeof m=="string"?m:"Hubo un error al registrar tu reserva.");yield this.mostrarAlerta("Error",h)}finally{this.submitting=!1}})}mostrarAlerta(s,o){return g(this,null,function*(){yield(yield this.alertCtrl.create({header:s,message:o,buttons:["OK"]})).present()})}};l.\u0275fac=function(o){return new(o||l)(u(M),u(Z),u(X))},l.\u0275cmp=C({type:l,selectors:[["app-solicitud"]],decls:23,vars:3,consts:[["color","primary"],[1,"ion-padding"],[3,"ngSubmit","formGroup"],["formControlName","tipo","placeholder","Selecciona"],["value","proyecto"],["value","reserva"],["value","actividad"],["position","floating"],["formControlName","descripcion"],[4,"ngIf"],["expand","block","type","submit",3,"disabled"],["formControlName","espacio_nombre"],["formControlName","espacio_tipo"],["type","number","formControlName","espacio_capacidad"],["formControlName","evento_titulo"],["formControlName","evento_descripcion"],["formControlName","evento_inicio","presentation","date-time"],["formControlName","evento_fin","presentation","date-time"]],template:function(o,n){if(o&1&&(i(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),t(3,"Solicitud Comunitaria"),e()()(),i(4,"ion-content",1)(5,"form",2),x("ngSubmit",function(){return n.enviarSolicitud()}),i(6,"ion-item")(7,"ion-label"),t(8,"Tipo de Solicitud"),e(),i(9,"ion-select",3)(10,"ion-select-option",4),t(11,"Postulaci\xF3n de Proyecto"),e(),i(12,"ion-select-option",5),t(13,"Reserva de Espacio/Terreno"),e(),i(14,"ion-select-option",6),t(15,"Inscripci\xF3n a Actividad"),e()()(),i(16,"ion-item")(17,"ion-label",7),t(18,"Descripci\xF3n"),e(),r(19,"ion-textarea",8),e(),F(20,ie,29,0,"div",9),i(21,"ion-button",10),t(22," Enviar Solicitud "),e()()()),o&2){let d;p(5),f("formGroup",n.solicitudForm),p(15),f("ngIf",((d=n.solicitudForm.get("tipo"))==null?null:d.value)==="reserva"),p(),f("disabled",n.solicitudForm.invalid)}},dependencies:[Y,R,j,k,B,H,L,K,U,z,J,Q,W,O,V,G,N,w,P,D,y,A,T,q],styles:["ion-toolbar[_ngcontent-%COMP%]{--background: #3880ff;--color: #fff}ion-button[_ngcontent-%COMP%]{margin-top:20px}"]});let c=l;return c})();export{pe as SolicitudPage};
