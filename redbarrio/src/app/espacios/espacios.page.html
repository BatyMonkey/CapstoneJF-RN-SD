<!-- ========================================
     HERO HEADER SUPERIOR (igual al Home)
========================================= -->
<ion-header class="rb-hero-header">
  <div class="rb-hero-container">
    <div class="rb-hero-info">
      <div class="rb-hero-logo">
        <img src="assets/icon/redbarrio.png" alt="Logo RedBarrio" />
      </div>
      <div class="rb-hero-text">
        <h1>RedBarrio</h1>
        <p>Tu comunidad conectada</p>
      </div>
    </div>

    <!-- Bot칩n atr치s -->
    <button class="rb-hero-chat" type="button" (click)="goBack()">
      <ion-icon name="chevron-back-outline"></ion-icon>
    </button>
  </div>
</ion-header>

<!-- ========================================
            CONTENIDO
========================================= -->
<ion-content class="espacios-page" [fullscreen]="true">

  <!-- SUBHEADER -->
  <div class="subheader">
    <div class="espacio-hero-card">
      <div class="espacio-hero-icon">
        <ion-icon name="calendar-outline"></ion-icon>
      </div>
      <div class="espacio-hero-text">
        <h2>Espacios Comunitarios</h2>
        <p>Arrienda espacios del barrio</p>
      </div>
    </div>
  </div>

  <div class="content-wrapper">

    <!-- TIP -->
    <div class="tip-box">
      <span class="tip-emoji">游늰</span>
      <p>
        Selecciona un espacio y completa el formulario para solicitar un arriendo.
        El administrador revisar치 tu solicitud y te confirmar치 la disponibilidad.
      </p>
    </div>

    <h3 class="section-title">Espacios Disponibles</h3>

    <!-- LISTADO ESPACIOS -->
    <ng-container *ngIf="!isLoading && espacios?.length; else loadingOrEmpty">

      <ion-card *ngFor="let espacio of espacios"
        class="espacio-card"
        [class.selected]="espacioSeleccionadoId === espacio.id_espacio"
        (click)="seleccionarEspacio(espacio)">

        <div class="espacio-img-wrapper">
          <img *ngIf="espacio.imagen_url" [src]="espacio.imagen_url" [alt]="espacio.nombre" />

          <div class="espacio-price" *ngIf="espacio.precio">
            {{ formatearPrecio(espacio.precio) }}
          </div>

          <div class="espacio-check" *ngIf="espacioSeleccionadoId === espacio.id_espacio">
            <ion-icon name="checkmark-outline"></ion-icon>
          </div>
        </div>

        <ion-card-content>
          <h4 class="espacio-nombre">{{ espacio.nombre }}</h4>
          <p class="espacio-desc">{{ espacio.descripcion || 'Sin descripci칩n' }}</p>

          <div class="espacio-meta">
            <div class="meta-item">
              <ion-icon name="people-outline"></ion-icon>
              <span>Capacidad: {{ espacio.capacidad }} personas</span>
            </div>

            <div class="meta-item" *ngIf="espacio.direccion_completa">
              <ion-icon name="location-outline"></ion-icon>
              <span>{{ espacio.direccion_completa }}</span>
            </div>
          </div>

          <!-- Servicios -->
          <div class="espacio-servicios" *ngIf="espacio.servicios?.length">
            <p class="servicios-title">Servicios incluidos:</p>

            <div class="servicios-grid">
              <div class="servicio-pill" *ngFor="let s of espacio.servicios">
                <ion-icon [name]="iconoServicio(s)"></ion-icon>
                <span>{{ nombreServicio(s) }}</span>
              </div>
            </div>
          </div>
        </ion-card-content>

      </ion-card>
    </ng-container>

    <!-- LOADING / EMPTY -->
    <ng-template #loadingOrEmpty>
      <div *ngIf="isLoading" class="loading-wrapper">
        <ion-spinner name="crescent" color="primary"></ion-spinner>
        <p>Cargando espacios...</p>
      </div>

      <div *ngIf="!isLoading && !espacios?.length" class="empty-wrapper">
        <p>No se encontraron espacios disponibles.</p>
        <ion-button *ngIf="isAdmin" (click)="irACrearEspacio()" fill="solid">
          Crear nuevo espacio
        </ion-button>
      </div>
    </ng-template>

    <!-- ========================================
         FORMULARIO DE ARRIENDO / SOLICITUD
    ========================================== -->

    <div class="solicitud-card" *ngIf="espacioSeleccionadoId">
      <h3>Solicitar Arriendo</h3>

      <!-- FECHA -->
      <div class="field">
        <label>Fecha <span class="req">*</span></label>
        <div class="field-input icon-left">
          <ion-icon name="calendar-outline"></ion-icon>
          <input type="date" [(ngModel)]="fechaArriendo" (change)="validarHorario()" />
        </div>
      </div>

      <!-- HORARIO -->
      <div class="field">
        <label>Horario <span class="req">*</span></label>

        <div class="time-grid">
          <div class="field-input icon-left">
            <ion-icon name="time-outline"></ion-icon>
            <input type="time" [(ngModel)]="horaInicio" (change)="validarHorario()" />
          </div>

          <div class="field-input icon-left">
            <ion-icon name="time-outline"></ion-icon>
            <input type="time" [(ngModel)]="horaFin" (change)="validarHorario()" />
          </div>
        </div>
      </div>

      <!-- MENSAJE VISUAL DE ERROR DE HORARIO -->
      <div class="error-horario-box" *ngIf="errorHorario">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <p>{{ errorHorario }}</p>
      </div>

      <!-- MOTIVO -->
      <div class="field">
        <label>Motivo <span class="req">*</span></label>
        <textarea rows="3" [(ngModel)]="motivo" placeholder="Describe brevemente el motivo del arriendo..."></textarea>
      </div>

      <ion-button expand="block" class="btn-submit" (click)="solicitarArriendo()">
        Solicitar Arriendo
      </ion-button>
    </div>

  </div>

  <!-- FAB ADMIN -->
  <ion-fab *ngIf="isAdmin" slot="fixed" vertical="bottom" horizontal="end">
    <ion-button (click)="irACrearEspacio()" class="fab-squared-button" color="primary" fill="solid">
      <ion-icon name="add-outline" slot="start"></ion-icon>
      Nuevo Espacio
    </ion-button>
  </ion-fab>

</ion-content>
