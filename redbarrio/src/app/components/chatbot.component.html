<!-- src/app/components/chatbot.component.html -->

<!-- LAUNCHER (aparece cuando el chat estÃ¡ cerrado) -->
<button
  class="rb-chat-launcher"
  *ngIf="!visible"
  type="button"
  aria-label="Abrir chat"
  (click)="openChat()"
>
  <ion-icon name="chatbubbles-outline"></ion-icon>
</button>

<!-- CHAT (aparece cuando visible=true) -->
<div class="rb-chat" *ngIf="visible">
  <!-- HEADER -->
  <div class="rb-chat__header">
    <div class="rb-chat__avatar">
      <ion-icon name="sparkles-outline"></ion-icon>
      <span class="rb-chat__avatar-fallback">ðŸ¤–</span>
    </div>
    <div class="rb-chat__title">
      <h2>Asistente RedBarrio</h2>
      <p>Hola {{ displayName || 'vecino/a' }} ðŸ‘‹</p>
    </div>

    <!-- BOTÃ“N CERRAR -->
    <button
      type="button"
      class="rb-chat__close"
      aria-label="Cerrar chat"
      (click)="closeChat()"
    >
      <ion-icon name="close-outline"></ion-icon>
      <span class="rb-chat__close-fallback">Ã—</span>
    </button>
  </div>

  <!-- QUICK ACTIONS -->
  <div class="rb-chat__quick">
    <button (click)="clickQuick('faq')">
      <ion-icon name="help-circle-outline"></ion-icon>
      FAQ
    </button>
    <button (click)="clickQuick('cert')">
      <ion-icon name="document-text-outline"></ion-icon>
      Certificados
    </button>
    <button (click)="clickQuick('votacion')">
      <ion-icon name="checkbox-outline"></ion-icon>
      Votaciones
    </button>
    <button (click)="clickQuick('noticias')">
      <ion-icon name="newspaper-outline"></ion-icon>
      Noticias
    </button>
  </div>

  <!-- MENSAJES -->
  <div class="rb-chat__messages">
    <div
      *ngFor="let m of messages"
      [ngClass]="{
        'msg': true,
        'msg--bot': m.from === 'bot',
        'msg--user': m.from === 'user'
      }"
    >
      <div class="msg__bubble" [innerHTML]="m.text"></div>
      <div class="msg__time">{{ m.at | date:'shortTime' }}</div>
    </div>

    <div class="rb-chat__loading" *ngIf="loading">
      <ion-spinner name="dots"></ion-spinner>
      <span>Escribiendoâ€¦</span>
    </div>
  </div>

  <!-- INPUT -->
  <form class="rb-chat__input" (ngSubmit)="send()">
    <input
      type="text"
      [(ngModel)]="inputText"
      name="chatInput"
      placeholder="Escribe un mensaje..."
      [disabled]="loading"
      autocomplete="off"
    />
    <button type="submit" [disabled]="loading || !inputText.trim()">
      <ion-icon name="paper-plane-outline"></ion-icon>
      <span class="rb-chat__send-fallback">âž¤</span>
    </button>
  </form>
</div>
