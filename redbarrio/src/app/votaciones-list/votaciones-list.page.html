<ion-header class="rb-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button menu="mainMenu" autoHide="false"></ion-menu-button>
    </ion-buttons>
    <ion-title>Votaciones</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="vot-content" [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="cargarTodo($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="vot-wrapper">
    <!-- Título interno -->
    <div class="vot-header">
      <h2>Votaciones</h2>
    </div>

    <!-- Pestañas Activas / Finalizadas -->
    <div class="vot-tabs">
      <button
        class="vot-tab"
        [class.active]="activeTab === 'activas'"
        (click)="activeTab = 'activas'">
        <span>Activas</span>
        <span class="badge">{{ activas.length }}</span>
      </button>

      <button
        class="vot-tab"
        [class.active]="activeTab === 'finalizadas'"
        (click)="activeTab = 'finalizadas'">
        <span>Finalizadas</span>
        <span class="badge">{{ finalizadas.length }}</span>
      </button>
    </div>

    <!-- ============ LISTA ACTIVAS ============ -->
    <div class="vot-list" *ngIf="activeTab === 'activas'">
      <ion-text color="danger" *ngIf="errorActivas">
        <p class="error-text">{{ errorActivas }}</p>
      </ion-text>

      <div class="loading" *ngIf="cargandoActivas">
        <ion-spinner name="crescent"></ion-spinner>
      </div>

      <ng-container *ngIf="!cargandoActivas">
        <ion-card
          class="vot-card vot-card--active"
          *ngFor="let v of activas; trackBy: trackById"
          (click)="irDetalle(v)">
          <div class="vot-card-header">
            <div class="titles">
              <h3 class="title">{{ v.titulo }}</h3>
              <p class="subtitle" *ngIf="v.descripcion">
                {{ v.descripcion }}
              </p>
            </div>
            <ion-icon name="chevron-forward-outline"></ion-icon>
          </div>

          <div class="vot-card-footer vot-card-footer--active">
            <div class="left">
              <ion-icon name="time-outline"></ion-icon>
              <span>Cierra en:</span>
            </div>
            <div class="pills">
              <span class="pill">{{ tiempoRestante(v.fecha_fin) }}</span>
            </div>
          </div>
        </ion-card>

        <ion-text color="medium" *ngIf="!activas.length">
          <p class="empty">No hay votaciones activas en este momento.</p>
        </ion-text>
      </ng-container>
    </div>

    <!-- ============ LISTA FINALIZADAS ============ -->
    <div class="vot-list" *ngIf="activeTab === 'finalizadas'">
      <ion-text color="danger" *ngIf="errorFinalizadas">
        <p class="error-text">{{ errorFinalizadas }}</p>
      </ion-text>

      <div class="loading" *ngIf="cargandoFinalizadas">
        <ion-spinner name="crescent"></ion-spinner>
      </div>

      <ng-container *ngIf="!cargandoFinalizadas">
        <ion-card
          class="vot-card vot-card--finished"
          *ngFor="let v of finalizadas; trackBy: trackById"
          (click)="irDetalle(v)">
          <div class="vot-card-header">
            <div class="titles">
              <h3 class="title">{{ v.titulo }}</h3>
              <p class="subtitle" *ngIf="v.descripcion">
                {{ v.descripcion }}
              </p>
            </div>
            <ion-icon name="chevron-forward-outline"></ion-icon>
          </div>

          <div class="vot-card-footer vot-card-footer--finished">
            <div class="left">
              <ion-icon name="calendar-outline"></ion-icon>
              <span class="pill pill-finished">
                Finalizada el
                {{ v.fecha_fin | date:'d \'de\' MMMM \'de\' y' }}
              </span>
            </div>
          </div>
        </ion-card>

        <ion-text color="medium" *ngIf="!finalizadas.length">
          <p class="empty">No hay votaciones finalizadas.</p>
        </ion-text>
      </ng-container>
    </div>
  </div>
</ion-content>
