<ion-header class="rb-hero-header">
  <div class="rb-hero-container">
    <div class="rb-hero-info">
      <div class="rb-hero-logo">
        <img src="assets/icon/redbarrio.png" alt="Logo RedBarrio" />
      </div>
      <div class="rb-hero-text">
        <h1>RedBarrio</h1>
        <p>Tu comunidad conectada</p>
      </div>
    </div>

    <div class="rb-hero-chat-wrapper"></div>
  </div>
</ion-header>

<ion-content [fullscreen]="true" class="crear-noticia-page">
  <div class="page-container">
    <div class="content-wrapper">

      <!-- CABECERA: Gestionar Noticias + Tabs -->
      <section class="projects-manage-card">
        <div class="projects-manage-header">
          <!-- Bot√≥n volver -->
          <button type="button" class="back-btn" (click)="goBack()">
            <ion-icon name="chevron-back-outline"></ion-icon>
          </button>

          <div class="header-text">
            <h2>Gestionar Noticias</h2>
            <p>Crear y administrar noticias</p>
          </div>
        </div>

        <!-- Tabs principales -->
        <div class="projects-main-tabs">
          <!-- Ver Noticias: vuelve a la lista -->
          <button type="button" class="main-tab" (click)="goBack()">
            <ion-icon name="eye-outline"></ion-icon>
            <span>Ver Noticias</span>
          </button>

          <!-- Crear Nueva: activo en esta pantalla -->
          <button type="button" class="main-tab create active">
            <ion-icon name="add-outline"></ion-icon>
            <span>Crear Nueva</span>
          </button>
        </div>
      </section>

      <!-- FORMULARIO GENERAR NOTICIA -->
      <section class="news-form">
        <!-- Encabezado del formulario -->
        <div class="form-title-block">
          <h3>Generar Noticia</h3>
          <p>Crea un nuevo anuncio para los vecinos</p>
        </div>

        <!-- T√≠tulo -->
        <div class="form-group">
          <label>
            T√≠tulo de la Noticia <span class="required">*</span>
          </label>
          <ion-input [(ngModel)]="title" placeholder="Ingresa el t√≠tulo..."></ion-input>
        </div>

        <!-- P√°rrafos -->
        <div class="form-group">
          <div class="label-row">
            <label>
              Contenido ({{ paragraphs.length }}/5 p√°rrafos)
            </label>

            <button type="button" class="link-btn" *ngIf="paragraphs.length < 5" (click)="addParagraph()">
              <ion-icon name="add-outline"></ion-icon>
              <span>Agregar P√°rrafo</span>
            </button>
          </div>

          <!-- Lista de p√°rrafos -->
          <div class="paragraph-list" *ngIf="paragraphs.length > 0">
            <div class="paragraph-item" *ngFor="let par of paragraphs; let i = index; trackBy: trackByParagraph">
              <ion-textarea [(ngModel)]="par.text" [autoGrow]="true"
                [placeholder]="'P√°rrafo ' + (i + 1) + '...'"></ion-textarea>

              <button type="button" class="icon-btn danger" (click)="removeParagraph(i)" *ngIf="paragraphs.length > 1">
                <ion-icon name="close-outline"></ion-icon>
              </button>
            </div>
          </div>

          <!-- Estado sin p√°rrafos -->
          <div class="empty-paragraph-state" *ngIf="paragraphs.length === 0">
            <p class="empty-title">A√∫n no has agregado p√°rrafos</p>
            <p class="empty-text">
              Agrega contenido para que los vecinos entiendan mejor la noticia.
            </p>
            <button type="button" class="btn-primary" (click)="addParagraph()">
              <ion-icon name="add-outline"></ion-icon>
              <span>Agregar Primer P√°rrafo</span>
            </button>
          </div>
        </div>

        <!-- IM√ÅGENES -->
        <div class="form-group">
          <div class="label-row">
            <label>
              Imagen de Portada <span class="required">*</span> + Im√°genes
              adicionales ({{ images.length }}/5)
            </label>

            <!-- Input de archivos REAL (oculto) -->
            <input #fileInput type="file" accept="image/*" multiple hidden (change)="onFilesSelected($event)" />

            <button type="button" class="link-btn warn" *ngIf="images.length < 5" (click)="fileInput.click()">
              <ion-icon name="image-outline"></ion-icon>
              <span>Agregar Imagen</span>
            </button>
          </div>

          <!-- Con im√°genes -->
          <div *ngIf="images.length > 0">
            <!-- Portada -->
            <div class="cover-image-card">
              <img [src]="images[0]" alt="Portada" />
              <div class="cover-badge">üì∏ Portada</div>

              <button type="button" class="icon-btn danger cover-remove" (click)="removeImage(0)">
                <ion-icon name="close-outline"></ion-icon>
              </button>
            </div>

            <!-- Im√°genes adicionales -->
            <div class="extra-images-grid" *ngIf="images.length > 1">
              <div class="extra-image-card" *ngFor="let img of images.slice(1); let idx = index">
                <img [src]="img" [alt]="'Imagen ' + (idx + 2)" />
                <button type="button" class="icon-btn danger small" (click)="removeImage(idx + 1)">
                  <ion-icon name="close-outline"></ion-icon>
                </button>
              </div>
            </div>
          </div>

          <!-- Sin im√°genes -->
          <div class="empty-image-state" *ngIf="images.length === 0">
            <ion-icon name="image-outline" class="empty-icon"></ion-icon>
            <p class="empty-title">Imagen de Portada Requerida</p>
            <p class="empty-text">
              La primera imagen ser√° la portada de la noticia.
            </p>
            <button type="button" class="btn-primary warn" (click)="fileInput.click()">
              <ion-icon name="image-outline"></ion-icon>
              <span>Agregar Imagen de Portada</span>
            </button>
          </div>
        </div>

        <!-- Categor√≠a -->
        <div class="form-group">
          <label>Categor√≠a</label>
          <ion-select [(ngModel)]="category" interface="popover">
            <ion-select-option value="urgent">üö® Urgente</ion-select-option>
            <ion-select-option value="event">üì¢ Evento</ion-select-option>
            <ion-select-option value="info">‚ÑπÔ∏è Informaci√≥n</ion-select-option>
            <ion-select-option value="success">‚úÖ Anuncio</ion-select-option>
          </ion-select>
        </div>

        <!-- Bot√≥n publicar -->
        <div class="form-actions">
          <button type="button" class="btn-publish" [class.disabled]="!canPublish" (click)="handlePublish()">
            <ion-icon name="send-outline"></ion-icon>
            <span>Publicar Noticia</span>
          </button>

          <p class="publish-hint" *ngIf="!canPublish">
            * Debes agregar un t√≠tulo, al menos un p√°rrafo y una imagen de
            portada
          </p>
        </div>
      </section>
    </div>
  </div>
</ion-content>