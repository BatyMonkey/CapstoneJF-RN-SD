<ion-header [translucent]="true" class="rb-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <!-- Debe coincidir con menuId="mainMenu" del app.component.html -->
      <ion-menu-button menu="mainMenu" autoHide="false"></ion-menu-button>
    </ion-buttons>
    <ion-title>Generar publicación</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen>
  <div class="page-wrap ion-padding">

    <ion-card class="card hero">
      <ion-card-header>
        <ion-card-title>Nuevo {{ isActividad ? 'Actividad' : 'Proyecto' }}</ion-card-title>
        <ion-card-subtitle>
          Completa la información básica de la {{ isActividad ? 'actividad' : 'proyecto' }}.
        </ion-card-subtitle>
      </ion-card-header>
    </ion-card>

    <form [formGroup]="proyectoForm" (ngSubmit)="generarProyecto()">
      <!-- Tipo de publicación -->
      <ion-item class="tipo-publicacion" lines="none">
        <ion-label>Tipo de publicación</ion-label>
        <ion-segment formControlName="tipo" (ionChange)="onTipoChange()">
          <ion-segment-button value="proyecto">
            <ion-label>Proyecto</ion-label>
          </ion-segment-button>
          <ion-segment-button value="actividad">
            <ion-label>Actividad</ion-label>
          </ion-segment-button>
        </ion-segment>
      </ion-item>

      <!-- Título -->
      <ion-item class="field" lines="none">
        <ion-label position="stacked">
          {{ isActividad ? 'Título de la actividad' : 'Título del proyecto' }}
        </ion-label>
        <ion-input
          formControlName="titulo"
          placeholder="{{ isActividad ? 'Ej: Taller de reciclaje' : 'Ej: Plaza comunitaria' }}"
          maxlength="80">
        </ion-input>
        <ion-note class="char-counter">{{ proyectoForm.value.titulo?.length || 0 }}/80</ion-note>
      </ion-item>

      <!-- Descripción -->
      <ion-item class="field" lines="none">
        <ion-label position="stacked">
          {{ isActividad ? 'Descripción de la actividad' : 'Descripción del proyecto' }}
        </ion-label>
        <ion-textarea
          formControlName="descripcion"
          placeholder="{{ isActividad ? 'Ej: Actividad comunitaria de limpieza y reciclaje en el parque central.' : 'Describe el propósito, etapas y beneficios del proyecto.' }}"
          autoGrow="true">
        </ion-textarea>
      </ion-item>

      <!-- Imagen -->
      <div class="image-upload">
        <label class="upload-label">Imagen de referencia</label>
        <input type="file" accept="image/*" (change)="onFileSelected($event)" />
        <div class="preview-card" *ngIf="previewUrl">
          <img [src]="previewUrl" alt="Vista previa" class="preview-img" />
        </div>
      </div>

      <!-- Campos adicionales (solo actividad) -->
      <ion-item class="field" *ngIf="isActividad" lines="none">
        <ion-label position="stacked">Cupos disponibles</ion-label>
        <ion-input formControlName="cupos_total" type="number" placeholder="Ej: 20"></ion-input>
      </ion-item>

      <ion-item class="field" *ngIf="isActividad" lines="none">
        <ion-label position="stacked">Fecha de inicio</ion-label>
        <ion-datetime
          formControlName="fecha_inicio"
          presentation="date-time"
          (ionChange)="onDateChange('fecha_inicio', $event)">
        </ion-datetime>
      </ion-item>

      <ion-item class="field" *ngIf="isActividad" lines="none">
        <ion-label position="stacked">Fecha de término</ion-label>
        <ion-datetime
          formControlName="fecha_fin"
          presentation="date-time"
          (ionChange)="onDateChange('fecha_fin', $event)">
        </ion-datetime>
      </ion-item>

      <!-- Botones -->
      <div class="buttons-container">
        <ion-button type="button" color="medium" fill="outline" (click)="limpiarFormulario()">
          Limpiar
        </ion-button>
        <ion-button expand="block" type="submit" [disabled]="proyectoForm.invalid">
          {{ isActividad ? 'Crear Actividad' : 'Crear Proyecto' }}
        </ion-button>
      </div>
    </form>

  </div>
</ion-content>