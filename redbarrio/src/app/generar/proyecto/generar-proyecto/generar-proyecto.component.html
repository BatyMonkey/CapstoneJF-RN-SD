<ion-header [translucent]="true" class="rb-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <!-- Debe coincidir con menuId="mainMenu" del app.component.html -->
      <ion-menu-button menu="mainMenu" autoHide="false"></ion-menu-button>
    </ion-buttons>
    <ion-title>Generar publicaci칩n</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen>
  <div class="page-wrap ion-padding">

    <!-- 游댳 Tarjeta principal -->
    <ion-card class="card hero">
      <ion-card-header>
        <ion-card-title>Nuevo {{ isActividad ? 'Actividad' : 'Proyecto' }}</ion-card-title>
        <ion-card-subtitle>
          Completa la informaci칩n b치sica de la {{ isActividad ? 'actividad' : 'proyecto' }}.
        </ion-card-subtitle>
      </ion-card-header>

      <!-- 游댳 Mensaje din치mico seg칰n rol -->
      <ion-card-content *ngIf="perfil?.rol">
        <ion-note color="medium" *ngIf="perfil?.rol === 'administrador'">
          Est치s creando una {{ isActividad ? 'actividad' : 'proyecto' }} como <strong>administrador</strong>.
          El estado quedar치 autom치ticamente como <strong>publicada</strong>.
        </ion-note>

        <ion-note color="warning" *ngIf="perfil?.rol === 'vecino'">
          Est치s creando una {{ isActividad ? 'actividad' : 'proyecto' }} como <strong>vecino</strong>.
          Tu publicaci칩n quedar치 con estado <strong>pendiente</strong> hasta ser aprobada por un administrador.
        </ion-note>
      </ion-card-content>
    </ion-card>

    <!-- 游댳 Formulario -->
    <form [formGroup]="proyectoForm" (ngSubmit)="generarProyecto()">
      <!-- Tipo de publicaci칩n -->
      <ion-item class="tipo-publicacion" lines="none">
        <ion-label>Tipo de publicaci칩n</ion-label>
        <ion-segment formControlName="tipo" (ionChange)="onTipoChange()">
          <ion-segment-button value="proyecto">
            <ion-label>Proyecto</ion-label>
          </ion-segment-button>
          <ion-segment-button value="actividad">
            <ion-label>Actividad</ion-label>
          </ion-segment-button>
        </ion-segment>
      </ion-item>

      <!-- T칤tulo -->
      <ion-item class="field" lines="none">
        <ion-label position="stacked">
          {{ isActividad ? 'T칤tulo de la actividad' : 'T칤tulo del proyecto' }}
        </ion-label>
        <ion-input
          formControlName="titulo"
          placeholder="{{ isActividad ? 'Ej: Taller de reciclaje' : 'Ej: Plaza comunitaria' }}"
          maxlength="80">
        </ion-input>
        <ion-note class="char-counter">{{ proyectoForm.value.titulo?.length || 0 }}/80</ion-note>
      </ion-item>

      <!-- Descripci칩n -->
      <ion-item class="field" lines="none">
        <ion-label position="stacked">
          {{ isActividad ? 'Descripci칩n de la actividad' : 'Descripci칩n del proyecto' }}
        </ion-label>
        <ion-textarea
          formControlName="descripcion"
          placeholder="{{ isActividad ? 'Ej: Actividad comunitaria de limpieza y reciclaje en el parque central.' : 'Describe el prop칩sito, etapas y beneficios del proyecto.' }}"
          autoGrow="true">
        </ion-textarea>
      </ion-item>

      <!-- Imagen -->
      <div class="image-upload">
        <label class="upload-label">Imagen de referencia</label>
        <input type="file" accept="image/*" (change)="onFileSelected($event)" />
        <div class="preview-card" *ngIf="previewUrl">
          <img [src]="previewUrl" alt="Vista previa" class="preview-img" />
        </div>
      </div>

      <!-- Campos adicionales (solo actividad) -->
      <ion-item class="field" *ngIf="isActividad" lines="none">
        <ion-label position="stacked">Cupos disponibles</ion-label>
        <ion-input formControlName="cupos_total" type="number" placeholder="Ej: 20"></ion-input>
      </ion-item>

      <ion-item class="field" *ngIf="isActividad" lines="none">
        <ion-label position="stacked">Fecha de inicio</ion-label>
        <ion-datetime
          formControlName="fecha_inicio"
          presentation="date-time"
          (ionChange)="onDateChange('fecha_inicio', $event)">
        </ion-datetime>
      </ion-item>

      <ion-item class="field" *ngIf="isActividad" lines="none">
        <ion-label position="stacked">Fecha de t칠rmino</ion-label>
        <ion-datetime
          formControlName="fecha_fin"
          presentation="date-time"
          (ionChange)="onDateChange('fecha_fin', $event)">
        </ion-datetime>
      </ion-item>

      <!-- Botones -->
      <div class="buttons-container">
        <ion-button type="button" color="medium" fill="outline" (click)="limpiarFormulario()">
          Limpiar
        </ion-button>
        <ion-button expand="block" type="submit" [disabled]="proyectoForm.invalid">
          {{ isActividad ? 'Crear Actividad' : 'Crear Proyecto' }}
        </ion-button>
      </div>
    </form>

  </div>
</ion-content>
