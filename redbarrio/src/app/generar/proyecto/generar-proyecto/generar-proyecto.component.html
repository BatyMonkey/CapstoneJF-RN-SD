<ion-header [translucent]="true" class="rb-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <!-- Debe coincidir con menuId="mainMenu" del app.component.html -->
      <ion-menu-button menu="mainMenu" autoHide="false"></ion-menu-button>
    </ion-buttons>
    <ion-title>Generar publicaci칩n</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen>
  <div class="page-wrap ion-padding">

    <!-- 游댳 Tarjeta principal tipo header -->
    <ion-card class="card hero">
      <ion-card-header>
        <ion-card-title>Nuevo Proyecto</ion-card-title>
        <ion-card-subtitle>
          Completa la informaci칩n b치sica del proyecto que quieres publicar.
        </ion-card-subtitle>
      </ion-card-header>

      <!-- 游댳 Mensaje din치mico seg칰n rol -->
      <ion-card-content *ngIf="perfil?.rol">
        <ion-note color="medium" *ngIf="perfil?.rol === 'administrador'">
          Est치s creando un proyecto como <strong>administrador</strong>.
          El estado quedar치 autom치ticamente como <strong>publicada</strong>.
        </ion-note>

        <ion-note color="warning" *ngIf="perfil?.rol === 'vecino'">
          Est치s creando un proyecto como <strong>vecino</strong>.
          Tu publicaci칩n quedar치 con estado <strong>pendiente</strong> hasta ser aprobada por un administrador.
        </ion-note>
      </ion-card-content>
    </ion-card>

    <!-- 游댳 Formulario "solo proyecto" con estilo del mockup -->
    <form [formGroup]="proyectoForm" (ngSubmit)="generarProyecto()" class="create-form">

      <!-- Si tu form tiene control 'tipo', d칠jalo fijo a 'proyecto' en el .ts -->
      <!-- <input type="hidden" [formControl]="proyectoForm.get('tipo')" /> -->

      <!-- Nombre del Proyecto -->
      <div class="field-group">
        <label class="field-label">
          Nombre del Proyecto <span class="required">*</span>
        </label>
        <ion-input
          formControlName="titulo"
          placeholder="Ej: Mejoramiento Plaza Central"
          maxlength="80"
          class="field-input">
        </ion-input>
        <p class="field-helper">
          {{ proyectoForm.value.titulo?.length || 0 }}/80
        </p>
      </div>

      <!-- Descripci칩n -->
      <div class="field-group">
        <label class="field-label">
          Descripci칩n <span class="required">*</span>
        </label>
        <ion-textarea
          formControlName="descripcion"
          placeholder="Describe el proyecto en detalle..."
          autoGrow="true"
          class="field-textarea">
        </ion-textarea>
      </div>

      <!-- Imagen del proyecto -->
      <div class="field-group">
        <label class="field-label">Imagen del Proyecto</label>

        <div class="image-upload-box" [class.has-image]="previewUrl">
          <!-- Estado sin imagen (como el cuadro amarillo del mockup) -->
          <ng-container *ngIf="!previewUrl; else previewTpl">
            <div class="image-icon-wrap">
              <ion-icon name="image-outline"></ion-icon>
            </div>
            <p class="image-title">Agregar imagen del proyecto</p>
            <p class="image-subtitle">
              Selecciona una imagen desde tu dispositivo
            </p>

            <button
              type="button"
              class="image-select-btn"
              (click)="fileInput.click()">
              <ion-icon name="cloud-upload-outline"></ion-icon>
              <span>Seleccionar Imagen</span>
            </button>

            <input
              #fileInput
              type="file"
              accept="image/*"
              (change)="onFileSelected($event)"
              hidden />
          </ng-container>

          <!-- Estado con imagen cargada -->
          <ng-template #previewTpl>
            <div class="preview-card">
              <img
                [src]="previewUrl"
                alt="Vista previa"
                class="preview-img" />
            </div>
          </ng-template>
        </div>
      </div>

      <!-- (Opcional) Si m치s adelante agregas responsable/presupuesto/fechas/estado,
           se pueden insertar aqu칤 manteniendo este mismo estilo. -->

      <!-- Bot칩n Crear -->
      <div class="buttons-container">
        <ion-button
          expand="block"
          type="submit"
          [disabled]="proyectoForm.invalid"
          class="btn-create">
          Crear Proyecto
        </ion-button>

        <p class="submit-hint" *ngIf="proyectoForm.invalid">
          * Completa todos los campos obligatorios
        </p>
      </div>
    </form>

  </div>
</ion-content>
