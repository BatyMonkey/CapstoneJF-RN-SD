<ion-header class="rb-hero-header">
  <div class="rb-hero-container">
    <!-- Logo y texto -->
    <div class="rb-hero-info">
      <div class="rb-hero-logo">
        <img src="assets/icon/redbarrio.png" alt="Logo RedBarrio" />
      </div>
      <div class="rb-hero-text">
        <h1>RedBarrio</h1>
        <p>Tu comunidad conectada</p>
      </div>
    </div>

    <!-- Bot√≥n chat oculto (placeholder) -->
    <div class="rb-hero-chat-wrapper">
      <!-- vac√≠o -->
    </div>
  </div>
</ion-header>

<ion-content class="sugerir-page" [fullscreen]="true">
  <!-- HEADER INTERIOR: ADMIN vs VECINO -->
  <ng-container *ngIf="esAdmin; else vecinoHeader">
    <div class="page-subheader">
      <button class="back-btn" (click)="goBack()">
        <ion-icon name="chevron-back-outline"></ion-icon>
      </button>

      <div class="page-subheader-main">
        <div class="page-subheader-text">
          <h2>Gestionar Proyectos</h2>
          <p>Crear y administrar proyectos del barrio</p>
        </div>

        <!-- Tabs: Ver Proyectos / Crear Nuevo -->
        <div class="tabs-row">
          <button class="tab tab-secondary" type="button" (click)="irAAdminProyectos()">
            <ion-icon name="eye-outline"></ion-icon>
            Ver Proyectos
          </button>

          <button class="tab tab-primary" type="button">
            <ion-icon name="add-outline"></ion-icon>
            Crear Nuevo
          </button>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- Header para vecino (sin tabs) -->
  <ng-template #vecinoHeader>
    <div class="page-subheader">
      <button class="back-btn" (click)="goBack()">
        <ion-icon name="chevron-back-outline"></ion-icon>
      </button>
      <div class="page-subheader-text">
        <h2>Sugerir Proyecto</h2>
        <p>Prop√≥n mejoras para el barrio</p>
      </div>
    </div>
  </ng-template>

  <div class="page-body">
    <!-- ================== FORMULARIO ================== -->
    <ng-container *ngIf="!submitted; else enviadoTpl">
      <!-- Banner informativo (solo vecinos) -->
      <div class="info-banner" *ngIf="!esAdmin">
        <div class="banner-icon">
          <ion-icon name="bulb-outline"></ion-icon>
        </div>
        <div class="banner-text">
          <h3>¬°Tu opini√≥n es importante!</h3>
          <p>
            Comparte tus ideas para mejorar nuestro barrio. La directiva evaluar√° tu
            propuesta y podr√≠a convertirse en un proyecto real.
          </p>
        </div>
      </div>

      <form [formGroup]="form" class="form-section">
        <!-- Nombre del proyecto -->
        <div class="form-group">
          <label class="label">
            Nombre del Proyecto <span class="req">*</span>
          </label>
          <ion-input formControlName="titulo" class="input" placeholder="Ej: Instalaci√≥n de paneles solares">
          </ion-input>
        </div>

        <!-- Descripci√≥n -->
        <div class="form-group">
          <label class="label">
            Descripci√≥n del Proyecto <span class="req">*</span>
          </label>
          <ion-textarea formControlName="descripcion" class="textarea" rows="6"
            placeholder="Describe tu proyecto, sus beneficios y c√≥mo mejorar√≠a el barrio...">
          </ion-textarea>

          <p class="counter">
            {{ form.get('descripcion')?.value?.length || 0 }}/500 caracteres
          </p>
        </div>

        <!-- Responsable -->
        <div class="form-group">
          <label class="label">Responsable</label>
          <ion-input formControlName="responsable" class="input" placeholder="Nombre del responsable del proyecto">
          </ion-input>
        </div>

        <!-- Presupuesto (num√©rico) -->
        <div class="form-group">
          <label class="label">Presupuesto</label>
          <ion-input type="number" formControlName="presupuesto" class="input" placeholder="Ej: $5.000.000">
          </ion-input>
        </div>

        <!-- Fechas -->
        <div class="form-row">
          <div class="form-group form-half">
            <label class="label">
              Fecha Inicio <span class="req" *ngIf="esAdmin">*</span>
            </label>
            <ion-input type="date" formControlName="fecha_inicio" class="input" placeholder="dd-mm-aaaa">
            </ion-input>
          </div>

          <div class="form-group form-half">
            <label class="label">
              Fecha T√©rmino <span class="req" *ngIf="esAdmin">*</span>
            </label>
            <ion-input type="date" formControlName="fecha_fin" class="input" placeholder="dd-mm-aaaa">
            </ion-input>
          </div>
        </div>

        <!-- Estado del proyecto -->
        <div class="form-group">
          <label class="label">Estado del Proyecto</label>
          <select class="native-select" formControlName="estado_proyecto">
            <option value="Planificaci√≥n">Planificaci√≥n</option>
            <option value="En Progreso">En Progreso</option>
            <option value="Completado">Completado</option>
            <option value="Pausado">Pausado</option>
          </select>
        </div>

        <!-- Imagen del proyecto -->
        <div class="form-group">
          <label class="label">Imagen del Proyecto</label>

          <div class="image-upload-card">
            <ng-container *ngIf="!previewUrl; else previewTpl">
              <div class="upload-placeholder">
                <ion-icon name="image-outline"></ion-icon>
                <p>Agregar imagen del proyecto</p>
                <button type="button" class="upload-btn" (click)="fileInput.click()">
                  <ion-icon name="image-outline"></ion-icon>
                  Seleccionar Imagen
                </button>
              </div>
            </ng-container>

            <ng-template #previewTpl>
              <div class="upload-preview">
                <img [src]="previewUrl" alt="Preview" class="preview-img" />
                <button type="button" class="upload-btn secondary" (click)="fileInput.click()">
                  Cambiar imagen
                </button>
              </div>
            </ng-template>

            <input type="file" #fileInput accept="image/*" (change)="onFileSelected($event)" hidden />
          </div>
        </div>

        <!-- Bot√≥n enviar -->
        <button type="button" class="submit-btn" [disabled]="form.invalid || cargando" (click)="enviar()">
          <ion-icon name="paper-plane-outline"></ion-icon>
          {{ esAdmin ? 'Crear Proyecto' : 'Enviar Propuesta' }}
        </button>
      </form>

      <!-- Ejemplos de proyectos -->
      <div class="examples-card">
        <h4>Ejemplos de Proyectos:</h4>
        <ul>
          <li>üí° Instalaci√≥n de luminarias LED en calles principales</li>
          <li>üå≥ Creaci√≥n de √°rea verde con juegos infantiles</li>
          <li>üìπ Sistema de c√°maras de seguridad en entradas</li>
          <li>‚ôªÔ∏è Punto de reciclaje comunitario</li>
          <li>üèÉ Circuito de ejercicios al aire libre</li>
        </ul>
      </div>
    </ng-container>

    <!-- ================== ESTADO ENVIADO ================== -->
    <ng-template #enviadoTpl>
      <div class="success-wrapper">
        <div class="success-card">
          <div class="success-icon">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
          </div>
          <h3>¬°Propuesta Enviada!</h3>
          <p>
            Tu proyecto "<strong>{{ form.get('titulo')?.value }}</strong>"
            ha sido enviado exitosamente a la directiva para su evaluaci√≥n.
          </p>

          <div class="success-detail">
            <h4>¬øQu√© sigue?</h4>
            <ul>
              <li>‚Ä¢ La directiva revisar√° tu propuesta en los pr√≥ximos 7 d√≠as</li>
              <li>‚Ä¢ Recibir√°s una notificaci√≥n con la decisi√≥n</li>
              <li>‚Ä¢ Si es aprobada, podr√° pasar a votaci√≥n vecinal</li>
            </ul>
          </div>
        </div>

        <div class="success-actions">
          <button class="new-btn" (click)="nuevaPropuesta()">Nueva Propuesta</button>
          <button class="back-main-btn" (click)="volverAlInicio()">Volver al Inicio</button>
        </div>
      </div>
    </ng-template>
  </div>
</ion-content>